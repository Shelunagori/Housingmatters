;(function(require,define,_,Backbone,ActiveXObject,require){ActiveXObject=window.ActiveXObject;;!function e(t,n,i){function o(r,s){if(!n[r]){if(!t[r]){var _="function"==typeof require&&require;if(!s&&_)return _(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+r+"'")}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){var n=t[r][1][e];return o(n?n:e)},l,l.exports,e,t,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,t,n){(function(e){(function(){function i(e,t){function n(e){if(n[e]!==g)return n[e];var i;if("bug-string-char-index"==e)i="a"!="a"[0];else if("json"==e)i=n("json-stringify")&&n("json-parse");else{var a,s='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var _=t.stringify,c="function"==typeof _&&b;if(c){(a=function(){return 1}).toJSON=a;try{c="0"===_(0)&&"0"===_(new o)&&'""'==_(new r)&&_(v)===g&&_(g)===g&&_()===g&&"1"===_(a)&&"[1]"==_([a])&&"[null]"==_([g])&&"null"==_(null)&&"[null,null,null]"==_([g,v,null])&&_({a:[a,!0,!1,null,"\x00\b\n\f\r	"]})==s&&"1"===_(null,a)&&"[\n 1,\n 2\n]"==_([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==_(new l(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==_(new l(864e13))&&'"-000001-01-01T00:00:00.000Z"'==_(new l(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==_(new l(-1))}catch(d){c=!1}}i=c}if("json-parse"==e){var h=t.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){a=h(s);var u=5==a.a.length&&1===a.a[0];if(u){try{u=!h('"	"')}catch(d){}if(u)try{u=1!==h("01")}catch(d){}if(u)try{u=1!==h("1.")}catch(d){}}}}catch(d){u=!1}i=u}}return n[e]=!!i}e||(e=s.Object()),t||(t=s.Object());var o=e.Number||s.Number,r=e.String||s.String,_=e.Object||s.Object,l=e.Date||s.Date,c=e.SyntaxError||s.SyntaxError,d=e.TypeError||s.TypeError,h=e.Math||s.Math,u=e.JSON||s.JSON;"object"==typeof u&&u&&(t.stringify=u.stringify,t.parse=u.parse);var p,f,g,m=_.prototype,v=m.toString,b=new l(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(y){}if(!n("json")){var w="[object Function]",k="[object Date]",x="[object Number]",S="[object String]",I="[object Array]",C="[object Boolean]",T=n("bug-string-char-index");if(!b)var P=h.floor,M=[0,31,59,90,120,151,181,212,243,273,304,334],A=function(e,t){return M[t]+365*(e-1970)+P((e-1969+(t=+(t>1)))/4)-P((e-1901+t)/100)+P((e-1601+t)/400)};if((p=m.hasOwnProperty)||(p=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=v?p=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,p=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,p.call(this,e)}),f=function(e,t){var n,i,o,r=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n;for(o in i)p.call(i,o)&&r++;return n=i=null,r?f=2==r?function(e,t){var n,i={},o=v.call(e)==w;for(n in e)o&&"prototype"==n||p.call(i,n)||!(i[n]=1)||!p.call(e,n)||t(n)}:function(e,t){var n,i,o=v.call(e)==w;for(n in e)o&&"prototype"==n||!p.call(e,n)||(i="constructor"===n)||t(n);(i||p.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],f=function(e,t){var n,o,r=v.call(e)==w,s=!r&&"function"!=typeof e.constructor&&a[typeof e.hasOwnProperty]&&e.hasOwnProperty||p;for(n in e)r&&"prototype"==n||!s.call(e,n)||t(n);for(o=i.length;n=i[--o];s.call(e,n)&&t(n));}),f(e,t)},!n("json-stringify")){var E={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},O="000000",N=function(e,t){return(O+(t||0)).slice(-e)},j="\\u00",V=function(e){for(var t='"',n=0,i=e.length,o=!T||i>10,a=o&&(T?e.split(""):e);i>n;n++){var r=e.charCodeAt(n);switch(r){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=E[r];break;default:if(32>r){t+=j+N(2,r.toString(16));break}t+=o?a[n]:e.charAt(n)}}return t+'"'},F=function(e,t,n,i,o,a,r){var s,_,l,c,h,u,m,b,y,w,T,M,E,O,j,B;try{s=t[e]}catch(R){}if("object"==typeof s&&s)if(_=v.call(s),_!=k||p.call(s,"toJSON"))"function"==typeof s.toJSON&&(_!=x&&_!=S&&_!=I||p.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&1/0>s){if(A){for(h=P(s/864e5),l=P(h/365.2425)+1970-1;A(l+1,0)<=h;l++);for(c=P((h-A(l,0))/30.42);A(l,c+1)<=h;c++);h=1+h-A(l,c),u=(s%864e5+864e5)%864e5,m=P(u/36e5)%24,b=P(u/6e4)%60,y=P(u/1e3)%60,w=u%1e3}else l=s.getUTCFullYear(),c=s.getUTCMonth(),h=s.getUTCDate(),m=s.getUTCHours(),b=s.getUTCMinutes(),y=s.getUTCSeconds(),w=s.getUTCMilliseconds();s=(0>=l||l>=1e4?(0>l?"-":"+")+N(6,0>l?-l:l):N(4,l))+"-"+N(2,c+1)+"-"+N(2,h)+"T"+N(2,m)+":"+N(2,b)+":"+N(2,y)+"."+N(3,w)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if(_=v.call(s),_==C)return""+s;if(_==x)return s>-1/0&&1/0>s?""+s:"null";if(_==S)return V(""+s);if("object"==typeof s){for(O=r.length;O--;)if(r[O]===s)throw d();if(r.push(s),T=[],j=a,a+=o,_==I){for(E=0,O=s.length;O>E;E++)M=F(E,s,n,i,o,a,r),T.push(M===g?"null":M);B=T.length?o?"[\n"+a+T.join(",\n"+a)+"\n"+j+"]":"["+T.join(",")+"]":"[]"}else f(i||s,function(e){var t=F(e,s,n,i,o,a,r);t!==g&&T.push(V(e)+":"+(o?" ":"")+t)}),B=T.length?o?"{\n"+a+T.join(",\n"+a)+"\n"+j+"}":"{"+T.join(",")+"}":"{}";return r.pop(),B}};t.stringify=function(e,t,n){var i,o,r,s;if(a[typeof t]&&t)if((s=v.call(t))==w)o=t;else if(s==I){r={};for(var _,l=0,c=t.length;c>l;_=t[l++],s=v.call(_),(s==S||s==x)&&(r[_]=1));}if(n)if((s=v.call(n))==x){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else s==S&&(i=n.length<=10?n:n.slice(0,10));return F("",(_={},_[""]=e,_),o,r,i,"",[])}}if(!n("json-parse")){var B,R,D=r.fromCharCode,q={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},L=function(){throw B=R=null,c()},H=function(){for(var e,t,n,i,o,a=R,r=a.length;r>B;)switch(o=a.charCodeAt(B)){case 9:case 10:case 13:case 32:B++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=T?a.charAt(B):a[B],B++,e;case 34:for(e="@",B++;r>B;)if(o=a.charCodeAt(B),32>o)L();else if(92==o)switch(o=a.charCodeAt(++B)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=q[o],B++;break;case 117:for(t=++B,n=B+4;n>B;B++)o=a.charCodeAt(B),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||L();e+=D("0x"+a.slice(t,B));break;default:L()}else{if(34==o)break;for(o=a.charCodeAt(B),t=B;o>=32&&92!=o&&34!=o;)o=a.charCodeAt(++B);e+=a.slice(t,B)}if(34==a.charCodeAt(B))return B++,e;L();default:if(t=B,45==o&&(i=!0,o=a.charCodeAt(++B)),o>=48&&57>=o){for(48==o&&(o=a.charCodeAt(B+1),o>=48&&57>=o)&&L(),i=!1;r>B&&(o=a.charCodeAt(B),o>=48&&57>=o);B++);if(46==a.charCodeAt(B)){for(n=++B;r>n&&(o=a.charCodeAt(n),o>=48&&57>=o);n++);n==B&&L(),B=n}if(o=a.charCodeAt(B),101==o||69==o){for(o=a.charCodeAt(++B),(43==o||45==o)&&B++,n=B;r>n&&(o=a.charCodeAt(n),o>=48&&57>=o);n++);n==B&&L(),B=n}return+a.slice(t,B)}if(i&&L(),"true"==a.slice(B,B+4))return B+=4,!0;if("false"==a.slice(B,B+5))return B+=5,!1;if("null"==a.slice(B,B+4))return B+=4,null;L()}return"$"},U=function(e){var t,n;if("$"==e&&L(),"string"==typeof e){if("@"==(T?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=H(),"]"!=e;n||(n=!0))n&&(","==e?(e=H(),"]"==e&&L()):L()),","==e&&L(),t.push(U(e));return t}if("{"==e){for(t={};e=H(),"}"!=e;n||(n=!0))n&&(","==e?(e=H(),"}"==e&&L()):L()),(","==e||"string"!=typeof e||"@"!=(T?e.charAt(0):e[0])||":"!=H())&&L(),t[e.slice(1)]=U(H());return t}L()}return e},z=function(e,t,n){var i=W(e,t,n);i===g?delete e[t]:e[t]=i},W=function(e,t,n){var i,o=e[t];if("object"==typeof o&&o)if(v.call(o)==I)for(i=o.length;i--;)z(o,i,n);else f(o,function(e){z(o,e,n)});return n.call(e,t,o)};t.parse=function(e,t){var n,i;return B=0,R=""+e,n=U(H()),"$"!=H()&&L(),B=R=null,t&&v.call(t)==w?W((i={},i[""]=n,i),"",t):n}}}return t.runInContext=i,t}var o="function"==typeof define&&define.amd,a={"function":!0,object:!0},r=a[typeof n]&&n&&!n.nodeType&&n,s=a[typeof window]&&window||this,_=r&&a[typeof t]&&t&&!t.nodeType&&"object"==typeof e&&e;if(!_||_.global!==_&&_.window!==_&&_.self!==_||(s=_),r&&!o)i(s,r);else{var l=s.JSON,c=s.JSON3,d=!1,h=i(s,s.JSON3={noConflict:function(){return d||(d=!0,s.JSON=l,s.JSON3=c,l=c=null),h}});s.JSON={parse:h.parse,stringify:h.stringify}}o&&define(function(){return h})}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t){t.exports={RE_EMAIL_PATTERN:"\\b[\\w.-]+\\+*[\\w.-]+@(?:(?:[\\w-]+\\.)+[A-Za-z]{2,6}|(?:\\d{1,3}\\.){3}\\d{1,3})",RE_URL_SCHEME:"(?:[\\w-]{2,}):/{1,3}",RE_TLD:"(?:aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|fi|fj|fk|fm|fo|fr|ga|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|si|sj|sk|sl|sm|sn|so|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)",RE_URL_MIDCHAR:"(?:[^\\s()]+|\\((\\S+)\\))",RE_URL_ENDCHAR:"(?:\\((\\S+)\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’])",add_wbrs:!0,truncate_length:null,link_target:"_blank",link_titles:!0,init:function(){this.RE_URL_ENDING||(this.RE_URL_ENDING="(?:"+this.RE_URL_MIDCHAR+"*"+this.RE_URL_ENDCHAR+")?",this.RE_FULL_URL=this.RE_URL_SCHEME+"\\w+(?:.\\w+)"+this.RE_URL_ENDING,this.RE_OTHER_URL="\\w[\\w_-]*(?:\\.\\w[\\w_-]*)*\\."+this.RE_TLD+"(?:[\\/\\?#]"+this.RE_URL_ENDING+")?\\b")},linkify:function(e,t){return this.init(),e=this.match_and_replace(this.RE_EMAIL_PATTERN,e,!0,!1,t),e=this.match_and_replace(this.RE_FULL_URL,e,!1,!1,t),e=this.match_and_replace(this.RE_OTHER_URL,e,!1,!0,t)},match_and_replace:function(e,t,n,i,o){for(var a=0,r=0,s=0,_=0,l=/<\/[aA]>/,c=new RegExp(e,"g"),d={},h=20,u=0;(d=c.exec(t))&&(u++,!(u>h));){a=d.index,s=d[0].length;var p=t.substring(r,a);if(p.search(/<[aA]/)>=0){l.lastIndex=r;var f=t.substring(r,t.length).search(l);if(0>f)return t;_=f+r,c.lastIndex=_+4,r=_+4}else{var g=t.substr(a,s),m=g;i&&(m="http://"+m);var v="<a";if(this.link_target&&(v+=' target="'+this.link_target+'"'),v+=' href="',n&&(v+="mailto:"),m=m.replace(/"/g,"%22"),v+=m+'"',this.link_titles){var b=n?"Email "+m:m;v+=' title="'+b+'"'}this.truncate_length&&g.length>this.truncate_length&&(g=g.substr(0,this.truncate_length)+"..."),this.add_wbrs&&(g=g.replace(new RegExp("([/=])","g"),"<wbr>$1")),v+=">"+g+"</a>",o&&o.push(m),t=t.slice(0,a)+v+t.slice(a+s,t.length),c.lastIndex=a+v.length,r=a+v.length}}return t}}},{}],3:[function(e,t,n){(function(){var e=this,i=e._,o={},a=Array.prototype,r=Object.prototype,s=Function.prototype,_=a.push,l=a.slice,c=a.concat,d=r.toString,h=r.hasOwnProperty,u=a.forEach,p=a.map,f=a.reduce,g=a.reduceRight,m=a.filter,v=a.every,b=a.some,y=a.indexOf,w=a.lastIndexOf,k=Array.isArray,x=Object.keys,S=s.bind,I=function(e){return e instanceof I?e:this instanceof I?void(this._wrapped=e):new I(e)};"undefined"!=typeof n?("undefined"!=typeof t&&t.exports&&(n=t.exports=I),n._=I):e._=I,I.VERSION="1.6.0";var C=I.each=I.forEach=function(e,t,n){if(null==e)return e;if(u&&e.forEach===u)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,a=e.length;a>i;i++)if(t.call(n,e[i],i,e)===o)return}else for(var r=I.keys(e),i=0,a=r.length;a>i;i++)if(t.call(n,e[r[i]],r[i],e)===o)return;return e};I.map=I.collect=function(e,t,n){var i=[];return null==e?i:p&&e.map===p?e.map(t,n):(C(e,function(e,o,a){i.push(t.call(n,e,o,a))}),i)};var T="Reduce of empty array with no initial value";I.reduce=I.foldl=I.inject=function(e,t,n,i){var o=arguments.length>2;if(null==e&&(e=[]),f&&e.reduce===f)return i&&(t=I.bind(t,i)),o?e.reduce(t,n):e.reduce(t);if(C(e,function(e,a,r){o?n=t.call(i,n,e,a,r):(n=e,o=!0)}),!o)throw new TypeError(T);return n},I.reduceRight=I.foldr=function(e,t,n,i){var o=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return i&&(t=I.bind(t,i)),o?e.reduceRight(t,n):e.reduceRight(t);var a=e.length;if(a!==+a){var r=I.keys(e);a=r.length}if(C(e,function(s,_,l){_=r?r[--a]:--a,o?n=t.call(i,n,e[_],_,l):(n=e[_],o=!0)}),!o)throw new TypeError(T);return n},I.find=I.detect=function(e,t,n){var i;return P(e,function(e,o,a){return t.call(n,e,o,a)?(i=e,!0):void 0}),i},I.filter=I.select=function(e,t,n){var i=[];return null==e?i:m&&e.filter===m?e.filter(t,n):(C(e,function(e,o,a){t.call(n,e,o,a)&&i.push(e)}),i)},I.reject=function(e,t,n){return I.filter(e,function(e,i,o){return!t.call(n,e,i,o)},n)},I.every=I.all=function(e,t,n){t||(t=I.identity);var i=!0;return null==e?i:v&&e.every===v?e.every(t,n):(C(e,function(e,a,r){return(i=i&&t.call(n,e,a,r))?void 0:o}),!!i)};var P=I.some=I.any=function(e,t,n){t||(t=I.identity);var i=!1;return null==e?i:b&&e.some===b?e.some(t,n):(C(e,function(e,a,r){return i||(i=t.call(n,e,a,r))?o:void 0}),!!i)};I.contains=I.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):P(e,function(e){return e===t})},I.invoke=function(e,t){var n=l.call(arguments,2),i=I.isFunction(t);return I.map(e,function(e){return(i?t:e[t]).apply(e,n)})},I.pluck=function(e,t){return I.map(e,I.property(t))},I.where=function(e,t){return I.filter(e,I.matches(t))},I.findWhere=function(e,t){return I.find(e,I.matches(t))},I.max=function(e,t,n){if(!t&&I.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var i=-1/0,o=-1/0;return C(e,function(e,a,r){var s=t?t.call(n,e,a,r):e;s>o&&(i=e,o=s)}),i},I.min=function(e,t,n){if(!t&&I.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var i=1/0,o=1/0;return C(e,function(e,a,r){var s=t?t.call(n,e,a,r):e;o>s&&(i=e,o=s)}),i},I.shuffle=function(e){var t,n=0,i=[];return C(e,function(e){t=I.random(n++),i[n-1]=i[t],i[t]=e}),i},I.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=I.values(e)),e[I.random(e.length-1)]):I.shuffle(e).slice(0,Math.max(0,t))};var M=function(e){return null==e?I.identity:I.isFunction(e)?e:I.property(e)};I.sortBy=function(e,t,n){return t=M(t),I.pluck(I.map(e,function(e,i,o){return{value:e,index:i,criteria:t.call(n,e,i,o)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var A=function(e){return function(t,n,i){var o={};return n=M(n),C(t,function(a,r){var s=n.call(i,a,r,t);e(o,s,a)}),o}};I.groupBy=A(function(e,t,n){I.has(e,t)?e[t].push(n):e[t]=[n]}),I.indexBy=A(function(e,t,n){e[t]=n}),I.countBy=A(function(e,t){I.has(e,t)?e[t]++:e[t]=1}),I.sortedIndex=function(e,t,n,i){n=M(n);for(var o=n.call(i,t),a=0,r=e.length;r>a;){var s=a+r>>>1;n.call(i,e[s])<o?a=s+1:r=s}return a},I.toArray=function(e){return e?I.isArray(e)?l.call(e):e.length===+e.length?I.map(e,I.identity):I.values(e):[]},I.size=function(e){return null==e?0:e.length===+e.length?e.length:I.keys(e).length},I.first=I.head=I.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:l.call(e,0,t)},I.initial=function(e,t,n){return l.call(e,0,e.length-(null==t||n?1:t))},I.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:l.call(e,Math.max(e.length-t,0))},I.rest=I.tail=I.drop=function(e,t,n){return l.call(e,null==t||n?1:t)},I.compact=function(e){return I.filter(e,I.identity)};var E=function(e,t,n){return t&&I.every(e,I.isArray)?c.apply(n,e):(C(e,function(e){I.isArray(e)||I.isArguments(e)?t?_.apply(n,e):E(e,t,n):n.push(e)}),n)};I.flatten=function(e,t){return E(e,t,[])},I.without=function(e){return I.difference(e,l.call(arguments,1))},I.partition=function(e,t){var n=[],i=[];return C(e,function(e){(t(e)?n:i).push(e)}),[n,i]},I.uniq=I.unique=function(e,t,n,i){I.isFunction(t)&&(i=n,n=t,t=!1);var o=n?I.map(e,n,i):e,a=[],r=[];return C(o,function(n,i){(t?i&&r[r.length-1]===n:I.contains(r,n))||(r.push(n),a.push(e[i]))}),a},I.union=function(){return I.uniq(I.flatten(arguments,!0))},I.intersection=function(e){var t=l.call(arguments,1);return I.filter(I.uniq(e),function(e){return I.every(t,function(t){return I.contains(t,e)})})},I.difference=function(e){var t=c.apply(a,l.call(arguments,1));return I.filter(e,function(e){return!I.contains(t,e)})},I.zip=function(){for(var e=I.max(I.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=I.pluck(arguments,""+n);return t},I.object=function(e,t){if(null==e)return{};for(var n={},i=0,o=e.length;o>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},I.indexOf=function(e,t,n){if(null==e)return-1;var i=0,o=e.length;if(n){if("number"!=typeof n)return i=I.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,o+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;o>i;i++)if(e[i]===t)return i;return-1},I.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(w&&e.lastIndexOf===w)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var o=i?n:e.length;o--;)if(e[o]===t)return o;return-1},I.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),o=0,a=new Array(i);i>o;)a[o++]=e,e+=n;return a};var O=function(){};I.bind=function(e,t){var n,i;if(S&&e.bind===S)return S.apply(e,l.call(arguments,1));if(!I.isFunction(e))throw new TypeError;return n=l.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(l.call(arguments)));O.prototype=e.prototype;var o=new O;O.prototype=null;var a=e.apply(o,n.concat(l.call(arguments)));return Object(a)===a?a:o}},I.partial=function(e){var t=l.call(arguments,1);return function(){for(var n=0,i=t.slice(),o=0,a=i.length;a>o;o++)i[o]===I&&(i[o]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return e.apply(this,i)}},I.bindAll=function(e){var t=l.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return C(t,function(t){e[t]=I.bind(e[t],e)}),e},I.memoize=function(e,t){var n={};return t||(t=I.identity),function(){var i=t.apply(this,arguments);return I.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},I.delay=function(e,t){var n=l.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},I.defer=function(e){return I.delay.apply(I,[e,1].concat(l.call(arguments,1)))},I.throttle=function(e,t,n){var i,o,a,r=null,s=0;n||(n={});var _=function(){s=n.leading===!1?0:I.now(),r=null,a=e.apply(i,o),i=o=null};return function(){var l=I.now();s||n.leading!==!1||(s=l);var c=t-(l-s);return i=this,o=arguments,0>=c?(clearTimeout(r),r=null,s=l,a=e.apply(i,o),i=o=null):r||n.trailing===!1||(r=setTimeout(_,c)),a}},I.debounce=function(e,t,n){var i,o,a,r,s,_=function(){var l=I.now()-r;t>l?i=setTimeout(_,t-l):(i=null,n||(s=e.apply(a,o),a=o=null))};return function(){a=this,o=arguments,r=I.now();var l=n&&!i;return i||(i=setTimeout(_,t)),l&&(s=e.apply(a,o),a=o=null),s}},I.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},I.wrap=function(e,t){return I.partial(t,e)},I.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},I.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},I.keys=function(e){if(!I.isObject(e))return[];if(x)return x(e);var t=[];for(var n in e)I.has(e,n)&&t.push(n);return t},I.values=function(e){for(var t=I.keys(e),n=t.length,i=new Array(n),o=0;n>o;o++)i[o]=e[t[o]];return i},I.pairs=function(e){for(var t=I.keys(e),n=t.length,i=new Array(n),o=0;n>o;o++)i[o]=[t[o],e[t[o]]];return i},I.invert=function(e){for(var t={},n=I.keys(e),i=0,o=n.length;o>i;i++)t[e[n[i]]]=n[i];return t},I.functions=I.methods=function(e){var t=[];for(var n in e)I.isFunction(e[n])&&t.push(n);return t.sort()},I.extend=function(e){return C(l.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},I.pick=function(e){var t={},n=c.apply(a,l.call(arguments,1));return C(n,function(n){n in e&&(t[n]=e[n])}),t},I.omit=function(e){var t={},n=c.apply(a,l.call(arguments,1));for(var i in e)I.contains(n,i)||(t[i]=e[i]);return t},I.defaults=function(e){return C(l.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},I.clone=function(e){return I.isObject(e)?I.isArray(e)?e.slice():I.extend({},e):e},I.tap=function(e,t){return t(e),e};var N=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof I&&(e=e._wrapped),t instanceof I&&(t=t._wrapped);var o=d.call(e);if(o!=d.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var a=n.length;a--;)if(n[a]==e)return i[a]==t;var r=e.constructor,s=t.constructor;if(r!==s&&!(I.isFunction(r)&&r instanceof r&&I.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),i.push(t);var _=0,l=!0;if("[object Array]"==o){if(_=e.length,l=_==t.length)for(;_--&&(l=N(e[_],t[_],n,i)););}else{for(var c in e)if(I.has(e,c)&&(_++,!(l=I.has(t,c)&&N(e[c],t[c],n,i))))break;if(l){for(c in t)if(I.has(t,c)&&!_--)break;l=!_}}return n.pop(),i.pop(),l};I.isEqual=function(e,t){return N(e,t,[],[])},I.isEmpty=function(e){if(null==e)return!0;if(I.isArray(e)||I.isString(e))return 0===e.length;for(var t in e)if(I.has(e,t))return!1;return!0},I.isElement=function(e){return!(!e||1!==e.nodeType)},I.isArray=k||function(e){return"[object Array]"==d.call(e)},I.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){I["is"+e]=function(t){return d.call(t)=="[object "+e+"]"}}),I.isArguments(arguments)||(I.isArguments=function(e){return!(!e||!I.has(e,"callee"))}),"function"!=typeof/./&&(I.isFunction=function(e){return"function"==typeof e}),I.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},I.isNaN=function(e){return I.isNumber(e)&&e!=+e},I.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==d.call(e)},I.isNull=function(e){return null===e},I.isUndefined=function(e){return void 0===e},I.has=function(e,t){return h.call(e,t)},I.noConflict=function(){return e._=i,this},I.identity=function(e){return e},I.constant=function(e){return function(){return e}},I.property=function(e){return function(t){return t[e]}},I.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},I.times=function(e,t,n){for(var i=Array(Math.max(0,e)),o=0;e>o;o++)i[o]=t.call(n,o);return i},I.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},I.now=Date.now||function(){return(new Date).getTime()};var j={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};j.unescape=I.invert(j.escape);var V={escape:new RegExp("["+I.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+I.keys(j.unescape).join("|")+")","g")};I.each(["escape","unescape"],function(e){I[e]=function(t){return null==t?"":(""+t).replace(V[e],function(t){return j[e][t]})}}),I.result=function(e,t){if(null==e)return void 0;var n=e[t];return I.isFunction(n)?n.call(e):n},I.mixin=function(e){C(I.functions(e),function(t){var n=I[t]=e[t];I.prototype[t]=function(){var e=[this._wrapped];return _.apply(e,arguments),q.call(this,n.apply(I,e))}})};var F=0;I.uniqueId=function(e){var t=++F+"";return e?e+t:t},I.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;I.template=function(e,t,n){var i;n=I.defaults({},n,I.templateSettings);var o=new RegExp([(n.escape||B).source,(n.interpolate||B).source,(n.evaluate||B).source].join("|")+"|$","g"),a=0,r="__p+='";e.replace(o,function(t,n,i,o,s){return r+=e.slice(a,s).replace(D,function(e){return"\\"+R[e]}),n&&(r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(r+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),o&&(r+="';\n"+o+"\n__p+='"),a=s+t.length,t}),r+="';\n",n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{i=new Function(n.variable||"obj","_",r)}catch(s){throw s.source=r,s}if(t)return i(t,I);var _=function(e){return i.call(this,e,I)};return _.source="function("+(n.variable||"obj")+"){\n"+r+"}",_},I.chain=function(e){return I(e).chain()};var q=function(e){return this._chain?I(e).chain():e};I.mixin(I),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];I.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],q.call(this,n)}}),C(["concat","join","slice"],function(e){var t=a[e];I.prototype[e]=function(){return q.call(this,t.apply(this._wrapped,arguments))}}),I.extend(I.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return I})}).call(this)},{}],4:[function(e,t){var n,i;i=e("underscore"),n=function(){function e(e){this._client=e.client,this._visitorName=this._client.myname}return e.prototype.didBegin=function(){return this._client.chatting||this.hasMessages()},e.prototype.hasMessages=function(){return this._client.buffer.length>0},e.prototype.hasMessagesFromVisitor=function(){var e,t=this;return e=i.any(this._client.buffer,function(e){var n;return n=e[0],n===t._visitorName})},e.prototype.hasMessagesFromOperator=function(){var e,t=this;return e=i.any(this._client.buffer,function(e){var n;return n=e[0],n!==t._visitorName})},e.prototype.needsPrechat=function(){return(!this.didBegin()||this.hasMessagesFromOperator())&&!this.hasMessagesFromVisitor()},e}(),t.exports=n},{underscore:3}],5:[function(e,t){var n,i,o,a=function(e,t){return function(){return e.apply(t,arguments)}};i=900,n=18e5,o=function(){function e(e,t,n,i,o,r){this.poll=a(this.poll,this);var s=this;this._options=r||{},this._localWindow=e,this._localDocument=t,this._localOlark=n,this._localHabla=i,this._localNavigator=o,this._hlog=this._options._hlog||this._localOlark._.hlog,this.secondsToKeepPollingAsOnline=this._options.secondsToKeepPollingAsOnline||60,this.minDelayWhenLongPolling=this._options.minDelayWhenLongPolling||0,this.activeIntervals={tier_1:{threshold:180,frequency:void 0},tier_2:{threshold:300,frequency:1e4},tier_3:{threshold:1800,frequency:2e4}},this.inactiveIntervals={opIsAvailable:{tier_1:{threshold:120,frequency:4e3},tier_2:{threshold:300,frequency:1e4},tier_3:{threshold:1800,frequency:2e4},tier_4:{threshold:7200,frequency:3e4}},opIsRecentlyOffline:15e3,opIsUnavailable:{tier_1:{threshold:180,frequency:15e3},tier_2:{threshold:300,frequency:45e3},tier_3:{threshold:7200,frequency:9e5}}},this.currentRate=1,this.longPoll=!0,this.running=!1,this.waitingForPollToFinish=!1,this.operatorAvailable=!1,this.nextPollTimer=void 0,this.lastPollStartedTimestamp=void 0,this.lastPollEndedTimestamp=void 0,this.expectedNextPollTime=void 0,this.lastSeenOnline=void 0,this.allowedDelayWhenSlow=this._options.allowedDelayWhenSlow||15,this.minAvailablePollTime=this._options.minAvailablePollTime||0,this.booted=this._options.booted||(new Date).getTime(),this._localOlark("api.chat.onOperatorsAvailable",function(){return s.operatorAvailable=!0,s.lastSeenOnline=(new Date).getTime()}),this._localOlark("api.chat.onOperatorsAway",function(){return s.operatorAvailable=!1}),/irefox/.test(this._localNavigator.userAgent)&&this._localWindow.addEventListener&&this._localWindow.addEventListener("unload",function(){return s.running&&s.waitingForPollToFinish?s._localHabla.client.sendcommand("return_long_poll_now",""):void 0},!1)}return e.prototype.getMinAvailablePollTime=function(){return this.minAvailablePollTime},e.prototype.setMinAvailablePollTime=function(e){return this.minAvailablePollTime=e},e.prototype.reset=function(e){return void 0===e&&(e=(new Date).getTime()),this.booted=e},e.prototype.setLongPoll=function(e){return this.longPoll=e},e.prototype.startNextPollNow=function(){return this.waitingForPollToFinish?void 0:this._startPollWithDelay()},e.prototype.isRunning=function(){return this.running},e.prototype.finishLastPoll=function(){return this.waitingForPollToFinish&&(this.waitingForPollToFinish=!1),this.expectedNextPollTime=void 0},e.prototype._getSecondsSinceLastAction=function(e){var t,n,i;return i=e.secondsSinceLastNotificationToOperator,n=e.secondsSinceLastMessage,t=n,i&&(void 0===n||n>i)&&(t=i),t},e.prototype.getNextPollTime=function(e){var t,n,i=this;return n=void 0,t=function(t){return n=t,e?e(t):void 0},this._localOlark("api.visitor.getDetails",function(e){var n,o;return n={secondsSinceLastAction:i._getSecondsSinceLastAction(e),secondsOnPage:i._timeOnPage(),secondsSinceOnline:i._secondsSinceOnline()},o=i.calculateNextPollTime(n),t(o)}),n},e.prototype.calculateNextPollTime=function(e){var t,n;return n=e.secondsSinceLastAction,t=void 0!==n,t?n<this.activeIntervals.tier_1.threshold?this.activeIntervals.tier_1.frequency:n<this.activeIntervals.tier_2.threshold?this.activeIntervals.tier_2.frequency:n<this.activeIntervals.tier_3.threshold?this.activeIntervals.tier_3.frequency:this._calculateInactivePollTime(e):this._calculateInactivePollTime(e)},e.prototype.scheduleNextPoll=function(){var e=this;return this.waitingForPollToFinish?void 0:this.getNextPollTime(function(t){return e._shouldRunScheduledPoll(t)?t>n?e.stop():e._startPollWithDelay(t):void 0})},e.prototype.stop=function(){return this.running?(this.nextPollTimer=void 0,this.nextPollTimer&&this._localWindow.clearTimeout(this.nextPollTimer),this._localHabla.client.sendcommand("return_long_poll_now","")):void 0},e.prototype.poll=function(){var e;return this.waitingForPollToFinish=!0,e=(new Date).getTime(),this.currentRate===this.minDelayWhenLongPolling&&this.longPoll?this._localHabla.client.proxy2.getmessages(this._localOlark._.identityManager.getConversationId(),this._localHabla.client.last_poll_index,this._localHabla.client.callbacks.getmessages):this._localHabla.client.proxy3.pollmessages(this._localOlark._.identityManager.getConversationId(),this._localHabla.client.last_poll_index,this._localHabla.client.callbacks.pollmessages)},e.prototype._shouldPollImmediately=function(e){return void 0===e},e.prototype._shouldRunScheduledPoll=function(e){var t;return t=this._shouldPollImmediately(e),!this.expectedNextPollTime||t||this.expectedNextPollTime>(new Date).getTime()+e},e.prototype._startPollWithDelay=function(e){return this.running=!0,this.nextPollTimer&&this._localWindow.clearTimeout(this.nextPollTimer),this.nextPollTimer=void 0,void 0===e&&(e=this.longPoll?this.minDelayWhenLongPolling:i),this.nextPollTimer=this._localWindow.setTimeout(this.poll,e),this.expectedNextPollTime=(new Date).getTime()+e,this.currentRate=e},e.prototype._isOperatorAvailable=function(){return this.operatorAvailable},e.prototype._operatorRecentlyWentOffline=function(e){return e&&e<this.secondsToKeepPollingAsOnline},e.prototype._calculateInactivePollTime=function(e){var t,n,i,o,a,r,s;return r=e.secondsOnPage,s=e.secondsSinceOnline,a=this._operatorRecentlyWentOffline(s),this._isOperatorAvailable()?(o=0,n=this.inactiveIntervals.opIsAvailable,o=r<n.tier_1.threshold?n.tier_1.frequency:r<n.tier_2.threshold?n.tier_2.frequency:r<n.tier_3.threshold?n.tier_3.frequency:r<n.tier_4.threshold?n.tier_4.frequency:r/20*1e3,Math.max.apply(this,[o,this.minAvailablePollTime])):a?this.inactiveIntervals.opIsRecentlyOffline:(i=this.inactiveIntervals.opIsUnavailable,r<i.tier_1.threshold?i.tier_1.frequency:r<i.tier_2.threshold?i.tier_2.frequency:r<i.tier_3.threshold?i.tier_3.frequency:(t=r/2*1.3*1e3,Math.max.apply(this,[t,i.tier_3.frequency])))},e.prototype._timeOnPage=function(e){return void 0===e&&(e=(new Date).getTime()),(e-this.booted)/1e3},e.prototype._secondsSinceOnline=function(){return this.lastSeenOnline?((new Date).getTime()-this.lastSeenOnline)/1e3:void 0
},e}(),t.exports=o},{}],6:[function(e,t){var n,i,o;o=e("underscore"),i=e("linklink"),n=function(){function e(e){this._urlFormatter=e.urlFormatter}return e.prototype.formatAsHtml=function(e){var t,n,a,r,s=this;return n="__junk_placeholder_workaround__ ",e=e.replace(/\%3C/gi,n),r="__plus_placeholder__",e=e.replace(/\+/g,r),a=[],t=i.linkify(e,a),o.each(a,function(e){var n,i;return s._urlFormatter.refersToLocalDomain(e)?(n='target="_blank" href="'+e,i='href="'+e,t=t.replace(n,i)):void 0}),o.each(a,function(e){var n,i,o;return i=0===(null!=(o=e.split(/https?:\/\//)[1])?o.indexOf(r):void 0),i=i||0===e.indexOf(r),i?(n=e.replace(r,""),t=t.replace(e,n),t=t.replace(""+e+'">'+r,""+e+'">')):t=t.replace(e,s._urlFormatter.getSmartUrl(e))}),t=t.replace(new RegExp(n,"g"),"%3C"),t=t.replace(new RegExp(r,"g"),"+")},e}(),t.exports=n},{linklink:2,underscore:3}],7:[function(e,t){function n(e){this._window=e.window||window,this._identityManager=e.identityManager||olark._.identityManager,this._cookieManager=e.cookieManager||olark._.cookieManager,this._util=e.util||hbl.util,this._config=e.config||hbl.config.vars,this._wrapNonLocalUrls=!0,"undefined"!=typeof this._config.chat_does_not_follow_external_links&&(this._wrapNonLocalUrls=!this._config.chat_does_not_follow_external_links)}n.prototype.refersToLocalDomain=function(e,t){function n(e){return e.replace(/^(?:https?\:\/\/)?(?:www\.)?/,"").split("/")[0]}return t=t||this._window.location.host,n(t)===n(e)},n.prototype.getSmartUrl=function(e){var t=this,n=/^\s*(ftp|file|telnet|ldap|irc|nntp|news|irc|mailto).*/,i=/^\s*(\/).*/,o=/^\s*(https?)\:\/\/.+/,a=function(e){if(t._config.url_handler&&t._wrapNonLocalUrls){for(var n,i=t._window.location.search.replace(/^\?/,""),o={},a=i.split(/&/),r=a.length-1;r>=0;r--)n=a[r].split(/=/),o[n[0]]=n[1];return t._config.url_handler+"?_ok="+t._identityManager.getSiteId()+"&wcsid="+t._identityManager.getConversationId()+"&_oklv="+t._identityManager.getOklvValueForPopout()+"&hblid="+t._identityManager.getVisitorId()+"&_okgid="+t._cookieManager.get("_okgid")+"&olfsk="+t._cookieManager.get("olfsk")+"&url="+t._util.encode_base64(e)+"&host="+t._window.location.host}return e};if(n.test(e))return e;if(i.test(e))return t._window.document.location.protocol+"//"+t._window.document.domain+e;var r=null;return r=o.test(e)?e:this.refersToLocalDomain(e)?t._window.document.location.protocol+"//"+e:"http://"+e,this._wrapNonLocalUrls&&!this.refersToLocalDomain(r)?a(r):r},t.exports=n},{}],8:[function(e,t){var n;n=e("json3"),t.exports={encode:function(){return n.stringify.apply(n,arguments)},decode:function(){return n.parse.apply(n,arguments)}}},{json3:1}],9:[function(e){function t(){return new u.hconfig}function n(e,t){if(!(hblHasinit||document.URL.search("hblNoInit")>-1)&&(hblHasinit=1,u.util.BrowserDetect.init(),u.util.BrowserDetect.supported||!m)){if(e=e||window.__get_olark_key(),"undefined"==typeof e||!e){var n=document.getElementById("hbl_code");if(n){var o=n.href.split("#");e=o[1],n.style.display="none"}else e="missing-site-id"}if(olark._.identityManager.setSiteId(e),u.config=t,t&&t.palette)for(var a in t.palette)"string"==typeof t.palette[a]&&(u.need_ugly_backwards_palette_hack=!0);u.started=0,u.prev_onload=window.onload,window.onload=function(){i(u.prev_onload)},window.setTimeout(function(){i(u.prev_onload)},2500)}}function i(e){if(!u.started){if(u.started=1,e&&"function"==typeof e)try{e()}catch(t){}y||u.util.simple_load_js_async(hblPostStub),u.eventmgr.handle("habla_called_wc_init")}}function o(){if(!u.post_started){if(u.post_started=1,olark._.identityManager.getSiteId()?"missing-site-id"==olark._.identityManager.getSiteId()&&olark._.identityManager.setSiteId(window.__get_olark_key()):olark._.identityManager.setSiteId(window.__get_olark_key()),window.habla_window||(habla_window=new u._hwindow(u.client,u.config,u.eventmgr),u.eventmgr.setWindow(habla_window),habla_window.register_handlers()),u.config.vars.local_mode)return u.client.start(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),u.eventmgr,u.config),habla_window.setTheme(u.config.vars.theme_obj),habla_window.config.vars.welcome_msg="Hab.la is in testing mode. set <em>config.vars['local_mode'] = false;</em> to go back to normal.",habla_window.config.vars.in_chat_text="Hab.la Local Mode",habla_window.config.vars.before_chat_text="Hab.la Local Mode",habla_window.config.vars.not_available_text="Hab.la Local Mode",habla_window.setHeader(habla_window.config.vars.not_available_text),void habla_window.show(1);var e=olark._.identityManager.getSiteId();if(e&&(e.match(/(olark|\@)/i)||!e.match(/\d\d*\-\d/))&&u.config.vars.theme_obj)return void a({etype:"invalid_site_id"});if(!e&&u.config.vars.theme_obj)return void a({etype:"invalid_site_link"});u.eventmgr.register("habla_error",a,10),u.client.start(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),u.eventmgr,u.config),u.eventmgr.handle("habla_started")}}function a(e){"invalid_site_id"==e.etype?(u.client.eventmgr=new u.util.eventmanager,habla_window.setTheme(u.config.vars.theme_obj),habla_window.config.vars.offline_message="<em>"+olark._.identityManager.getSiteId()+"</em> is not a valid <a href='"+hblInstallUrl+"'>"+hblName+"</a> site ID.<p> Your "+hblName+" Site ID is in the format '###-##-###-##' and can be found on your <a href='"+hblInstallUrl+"' target='_blank'>Dashboard</a>.</p>",habla_window.config.vars.not_available_text=hblName+": Site ID Error",habla_window.setHeader(habla_window.config.vars.not_available_text),habla_window.show(1),habla_window.theme.habla_conversation_div.scrollTop=0):"invalid_site_link"==e.etype?(u.client.eventmgr=new u.util.eventmanager,habla_window.setTheme(u.config.vars.theme_obj),habla_window.config.vars.offline_message="Unable to determine your site-id.  Please make sure you have copied and pasted all the code as it appears on your <a href='"+hblInstallUrl+"' target='_blank'>"+hblName+" Dashboard</a>.",habla_window.config.vars.not_available_text=hblName+": Site ID Error",habla_window.setHeader(habla_window.config.vars.not_available_text),habla_window.show(1),habla_window.theme.habla_conversation_div.scrollTop=0):"operator_is_busy"==e.etype&&(u.client.opbusy=!0,habla_window.opbusy=!0,habla_window.setWindowText())}function r(e){if(window.olark&&window.olark.__legacy_shim&&u.util.BrowserDetect.init(),u.config=u.config||new u.hconfig,!u.config.merge){var t=u.config;u.config=new u.hconfig,u.config.merge(t,!0)}(u.config.vars.disable_get_cookies||u.config.vars.wcsid)&&(u.config.vars.wcsid&&olark._.identityManager.setConversationId(u.config.vars.wcsid),u.config.vars.hblid&&olark._.identityManager.setVisitorId(u.config.vars.hblid)),u.config.plugins||(u.config.plugins=new u.util.pluginlist),e=e||["incoming_notification","away_div_handler","expand_on_receive_message","google_translate","auto_initiate"];for(var n=0;n<e.length;n++){var i=e[n],a=new u.plugins[i];u.config.plugins.add(a)}u.eventmgr.handle("habla_preload_done"),o()}function s(e,t){window[e]=t}var _=e("underscore"),l=e("../../chatbox/PollingManager"),c=e("../../chatbox/Conversation"),d=e("../../chatbox/TextFormatter"),h=e("../../chatbox/UrlFormatter");!function(){function e(e){switch(e){case"api.chat.getVisitorNickname":case"api.chat.getVisitorStatus":case"api.chat.operatorsAreAvailable":case"api.chat.operatorsAreBusy":case"api.chat.operatorsAreAway":case"api.chat.onNotificationToVisitor":case"api.chat.getVisitorNickname":case"api.chat.getVisitorNickname":return!0;default:return!1}}function t(e){return function(){var t=function(){},n={};window.console?(n=window.console,t=window.console[e]||window.console.info||t):window.opera&&(n=window.opera,t=window.opera.postError||t);try{t.apply(n,arguments)}catch(i){try{t(arguments.join(" "))}catch(i){}}}}function n(e){function t(){n._releaseActive()}var n=this;e=e||{},this._win=e.window||window,this._doc=e.document||this._win.document,this._prefixes=["webkit","moz","ms","o"],this._localStorage=e.localStorage||this._win.localStorage,this._idStorageKey=e.idStorageKey||"_BrowserTabIDStorageKey",this._id=(""+Math.random()+Math.random()).replace(/\./g,""),this._listen(this._win,"unload",t),this._listen(this._win,"beforeunload",t),this._supportsVisibility()?this._initializeWithVisibility():this._initializeWithBlurring(),this.hidden()&&this._anyTabsActive()||this._makeActive()}olark._.P("application"),olark("api.chat.onBeginConversation",function(){olark._.hlog("started chatting #begin_conversation #begin_conversation."+olark._.chatboxBucket)});var i=(olark._?olark._.versions:null,/^\s*(__Extension0\..+|__ChatApiHelper|__BoxApiHelper|[A-Z]\w+)\s*$/),o=/^\s*(api|box|browser|chat|data|extensions|system|olark|.*olark.*)\s*$/,a=6,r=6,s={GoogleAnalytics:null,VisitorInsight:null,VisitorImportance:null,OfflineWarning:null,EndConversation:null},_="3a36a58c72d4661d9a9ac484606f012e",l="bf177f47611e55d4707c4d9942b696e0",c="423092e252ccbf364ff4b006e43a1b3b",d="a019e45d1183d9dd0d80ab0b3c283982",h="f06d866d2e973c62cf196ca6cc010eac",u={Shopify:_,WelcomeAssist:l,CalloutBubble:c,OfflineWarning:d,Cobrowse:h},p=/.*YOUR-SITE-ID-HERE.*/,f="0000-0000-0000-0000",g=5,m=50;olark.extend("VisitorInsight"),olark.extend("VisitorImportance"),olark.extend("OfflineWarning"),olark.extend("EndConversation"),function(){window.olark.__buildinfo=window.olark.__buildinfo||{olarkfile:"/javascript/olark.js",corefile:"/javascript/application2.js",jshost:window.olark.__version?"static.olark.com":"olarkdev:8001",dev:!0}}();var v;if(window.olark.__buildinfo.dev)v={log:t("log"),info:t("info"),warn:t("warn"),error:t("error"),debug:t("debug"),showErrorBacktrace:t("error")};else{v={log:function(){},info:function(){},warn:t("warn"),error:t("error"),debug:function(){},showErrorBacktrace:function(){}};var b=v.error,y=v.warn,w=null;try{w=navigator.appName+" - "+navigator.appVersion}catch(k){}v.error=function(){try{var e=Array.prototype.slice.call(arguments||[]);olark._.hlog(e.join(" "),"#error")}catch(t){}try{b.apply(v,arguments)}catch(t){}},v.warn=function(){try{var e=Array.prototype.slice.call(arguments||[]);olark._.hlog(e.join(" "),"#warn")}catch(t){}try{y.apply(v,arguments)}catch(t){}}}window.olark.__legacy_shim=window.olark.__legacy_shim||{},document.hbl_ssl=/.*https:.*/.test(document.location.protocol)?!0:!1;var x=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n};!function(e){e.active=function(){if(arguments.length>0)throw new Error("'active' property is not settable");return this._localStorage||window.console&&window.console.warn&&window.console.warn("localStorage is required to use the active() property"),this._localStorage.getItem(this._idStorageKey)===this._id},e.hidden=function(){if(arguments.length>0)throw new Error("'hidden' property is not settable");return this._supportsVisibility()?this._getProperty(this._doc,"hidden"):this._blurred},e.on=function(e,t){e=e.split(/\s+/);for(var n=0;n<e.length;n++){var i=e[n];switch(i){case"change:hidden":this._listenForVisibilityChange(t);break;case"change:active":this._listenForActiveChange(t);break;default:throw new Error("invalid event '"+i+"'")}}},e._getProperty=function(e,t){var n=t.charAt(0).toString().toUpperCase()+t.slice(1);if(t in e)return e[t];var i;return this._eachBrowserPrefix(function(t){var o=t+n;o in e&&(i=e[o])}),i},e._supportsVisibility=function(){var e=this._getProperty(this._doc,"visibilityState");return"undefined"!==e},e._eachBrowserPrefix=function(e){for(var t=0;t<this._prefixes.length;t++)e(this._prefixes[t])},e._listen=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},e._listenForVisibilityChange=function(e){var t=this;this._listen(this._doc,"visibilitychange",e),this._eachBrowserPrefix(function(n){t._listen(t._doc,n+"visibilitychange",e)}),this._blurChangeCallbacks&&this._blurChangeCallbacks.push(e)},e._listenForActiveChange=function(e){var t=this;this._localStorage&&this._listen(this._win,"storage",function(n){n=n||window.event,n.key===t._idStorageKey&&e()})},e._makeActive=function(){this._localStorage&&this._localStorage.setItem(this._idStorageKey,this._id)},e._releaseActive=function(){if(this._localStorage){var e=this._localStorage.getItem(this._idStorageKey);e===this._id&&this._localStorage.removeItem(this._idStorageKey)}},e._anyTabsActive=function(){if(this._localStorage){var e=this._localStorage.getItem(this._idStorageKey);return"undefined"!==e}return!1},e._initializeWithVisibility=function(){function e(){t._blurred=t.hidden(),t.hidden()||t._makeActive()}var t=this;this._blurred=this.hidden(),this._uncertain=!1,e(),this._listenForVisibilityChange(e)},e._initializeWithBlurring=function(){function e(){for(var e=0;e<i.length;e++)setTimeout(i[e],0)}function t(){o._blurred=!0,o._uncertain=!1,e()}function n(){o._blurred=!1,o._uncertain=!1,o._makeActive(),e()}var i,o=this;this._blurred=!1,this._uncertain=!0,this._blurChangeCallbacks=i=[],this._listen(this._doc,"focusin",n),this._listen(this._doc,"focusout",t),this._listen(this._win,"focus",n),this._listen(this._win,"blur",t),this._listen(this._doc,"scroll",n),this._listen(this._doc,"keydown",n),this._listen(this._doc,"mousemove",n),this._listen(this._doc,"select",n),this._listen(this._win,"scroll",n),this._listen(this._win,"keydown",n),this._listen(this._win,"mousemove",n),this._listen(this._win,"select",n),this._listenForActiveChange(function(){o.active()||t()})}}(n.prototype);var S=null,I=null;!function(){var e={};S=function(t){var n=t.namespace,i=t.type,o=t.callback;if(!n)throw new Error("[olark] namespace required");if(!i)throw new Error("[olark] type required");if(!o)throw new Error("[olark] callback required");e[n]=e[n]||{},e[n][i]=e[n][i]||[],e[n][i].push(o)},I=function(t){var n=t.namespace,i=t.type,o=t.after||null,a=t;if(!n)throw new Error("[olark] namespace required");if(!i)throw new Error("[olark] type required");try{a.namespace=void 0,a.type=void 0,delete a.namespace,delete a.type,delete a.after}catch(r){}e[n]=e[n]||{};for(var s=e[n][i]||[],_=0;_<s.length;){var l=s[_++];l&&B(function(){l(a)},function(e){v.error("[olark] event handler for '"+n+"."+i+"' failed: "+e.toString()),v.showErrorBacktrace(e)})}o&&o()}}();var C=null,T=null,P=null,M=null,A=null,E=null,O=null,N=null,j=null,V=null,F=null,B=null;!function(){var e=[];A=function(t,n){var i=t.delay,o=setTimeout(n,i);return e.push(o),o},E=function(){for(var t=e.length;t--;)clearTimeout(e[t])},C=function(e){var t=!1;return function(){return t?void 0:(t=!0,e.apply(e,arguments))}},T=function(e){for(var t=e.length,n="\n";t--;){var i=e[t];n+=0===t?"- "+i:"- "+i+"\n"}return n},V=function(e){var t=e.url;if("string"!=typeof t)throw new Error("[olark] string 'url' is required");var n=-1!=t.indexOf("http://"),i=-1!=t.indexOf("https://"),o=0!==t.split("/")[0].indexOf(".");return!n&&!i&&!o};var t={};P=function(e){var n=e.url;if("string"!=typeof n)throw new Error("[olark] string 'url' is required");var i="https:"==document.location.protocol?!0:!1,o=-1==n.indexOf("http://")?!1:!0,a=-1==n.indexOf("https://")?!1:!0,r=o||a,s=null;if(s=V({url:n})?n:r?n:(i?"https://":"http://")+n,i&&r&&!a&&v.warn("[olark] you cannot load from ",s," when you are on an SSL page, you will probably get mixed-content warnings"),!t[s]){t[s]=!0;var _=document.createElement("script"),l=document.getElementsByTagName("script")[0];_.setAttribute("async",""),_.setAttribute("defer","true"),_.src=s,l.parentNode.insertBefore(_,l)}},M=function(e,t){var n=!1,i=function(){n||(n=!0,t())},o=function(){e()?i():n||A({delay:m},o)};o()},O=function(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=O(e[n]));return t},N=function(e,t){if(e==t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t))return!0;if("object"==typeof e&&"object"==typeof t&&null!==e&&null!==t){for(var n in e)if(!N(e[n],t[n]))return!1;for(var i in t)if(!N(e[i],t[i]))return!1;return!0}return!1},j=function(e){return e.replace(/\s+$/,"").replace(/^\s+/,"")},F=function(e){if("undefined"==typeof e.list)throw new Error("[olark] 'list' required");if("undefined"==typeof e.separator)throw new Error("[olark] 'separator' required");for(var t=e.list,n=e.separator,i=!0,o="",a=0;a<t.length;a++){var r=t[a];i?(i=!1,o+=r):o+=n+r}return o},B=function(e,t){if(window.olark.__buildinfo.strict)return e();try{return e()}catch(n){return t(n)}}}();var R=function(e,t){var n=window[e];if(!n)throw new Error("[lightloader] stub library not defined: "+e);var i=n.__lightload,o={publicMethods:{}},a=[],r=[];o.getLightloaderVersion=function(){return i.V},o.isDocumentReady=function(){return i.A||0},o.isWindowLoaded=function(){return i.B||0},o.whenDocumentReady=function(e){o.isDocumentReady()?e():a.push(e)},o.whenWindowLoaded=function(e){o.isWindowLoaded()?e():r.push(e)},o.reloadLibrary=function(){i.D=[],i.l()};var s=function(e){for(var t=e.length>0?e.shift():void 0;t;)t(),t=e.shift()},_=function(){var e=i.D;e.reverse();for(var t=e.length;t-->0;){var o=e[t],a=o[0],r=o[1],s=n[a];s?s.apply(n,r):window.console&&window.console.error&&window.console.error("[lightloader] missing method '"+a+"'")}e.reverse()};i.a=function(){i.A=!0,s(a)},i.b=function(){i.B=!0,s(r)},t(n,o),olark.extend=o.publicMethods.extend,olark.declare=o.publicMethods.declare,olark.configure=o.publicMethods.configure,olark.ready=o.publicMethods.ready,_()},D=function(t,n){function i(e,t){s.push([e,t]),_()}function o(){for(var t,n,o,s,_,l=a.callstack;l.length;)if(t=l.shift(),t&&t.length)try{o=Array.prototype.slice.call(t||[]),n=o.length?o.shift():void 0,_=/api\.[a-zA-Z]+\.(__SPI_)?[a-zA-Z]+/.test(n),"debug"==n?!function(){var e=document.createElement("script");e.src="https://static.olark.com/record.js",document.getElementsByTagName("head")[0].appendChild(e)}():_?e(n)?v.warn("[olark] the API call '"+n+"' is deprecated"):i(n,o):r.publicMethods.hasOwnProperty(n)?(s=r.publicMethods[n],s.apply(s,o)):v.warn("[olark] unknown method 'olark."+n+"'")}catch(c){v.error("[olark] unknown exception in dequeueCallbacks: method: "+n+" ",c.message)}else v.warn("[olark] empty method call in dequeueCallbacks #empty_dequeue_call")}var a=olark._,r=(a.P,{publicMethods:{}});r.getLightloaderVersion=function(){return a.v},r.whenDocumentReady=function(e){e()},r.reloadLibrary=function(){olark._=null,olark=null,a.i()};var s=[],_=function(){};olark.extend(function(e){_=function(){for(var t;s.length;){t=s.shift();var n=t[0],i=t[1],o=n.split("."),a=o[1],r=o[2];if(e[a]&&e[a][r])try{e[a][r].apply(e[a],i)}catch(_){v.error(_.toString())}else v.warn("[olark] unknown API call '"+n+"'")}},s.length>0&&_()}),n(olark,r),r.publicMethods.call=function(e,t){var n=r.publicMethods[e];n?n.apply(n,t):v.warn("[olark] unknown method 'olark."+e+"'")},olark._.s={push:function(e){a.callstack.push(e),o()}},o()};!function(){var e=window.olark;if(e.__v){v.warn("[olark] you are using an old version of the Olark Code on your page, please check your dashboard to get the new code.");var t=olark.__v[0],n=olark.__v[1],i=olark.__v[2],o=olark.__v[3];for(var a in t)"function"!=typeof t[a]&&e.configure.apply(e,t[a]);for(var r in n)"function"!=typeof n[r]&&e.extend.apply(e,n[r]);for(var s in i)"function"!=typeof i[s]&&e.declare.apply(e,i[s]);for(var _ in o)"function"!=typeof o[_]&&e.ready.apply(e,o[_]);e.__lightload.A=!0}}();var q=function(e,t){olark._?D(e,t):R(e,t)};q("olark",function(e,t){var _=function(e){var t=this;if(t.__name=e.name,t.__startup=e.startup,"undefined"==typeof t.__name)throw new Error("[olark] 'name' required");if("undefined"==typeof t.__startup)throw new Error("[olark] 'startup' required");t.__version=e.version||null,t.__source=e.source||null};!function(t){t.get_name=function(){var e=this;return e.__name},t.get_version=function(){var e=this;return e.__version},t.get_source=function(){var e=this;return e.__source},t.get_pretty_string=function(){var e=this,t=e.__name;return e.__version&&e.__source?t+=" (version "+e.__version+", from "+e.__source+")":e.__version&&(t+=" (version "+e.__version+")"),t},t.activate=function(t){var n=this,i=t.configuration;if("undefined"==typeof i)throw new Error("[olark] 'configuration' required");var o=/__.+/.test(n.__name),a=o?"__inline":n.__name;if(i[a]&&i[a].enabled===!1);else{var r=new e.__core.api.ApiInstance({conf:i,namespace:a,extension_name:n.__name});n.__startup(r,i),I({namespace:"Extension",type:"extensionActivated"})}}}(_.prototype);var l=function(e){var t=this;if(t.__name=e.name,"undefined"==typeof t.__name)throw new Error("[olark] 'name' required");t.__version=e.version||null,t.__source=e.source||c.get_instance().get_expected_source_for_extension({name:t.__name})};!function(e){e.get_name=function(){var e=this;return e.__name},e.get_version=function(){var e=this;return e.__version},e.get_source=function(){var e=this;return e.__source},e.get_pretty_string=function(){var e=this;return e.__name&&e.__version&&e.__source?e.__name+" (version "+e.__version+", from "+e.__source+")":e.__name&&e.__version?e.__name+" (version "+e.__version+")":e.__name&&e.__source?e.__name+" (from "+e.__source+")":e.__name},e.begin_download=function(){var e=this;e.__source&&P({url:e.__source})},e.is_downloaded=function(){var e=this,t=c.get_instance().search_for_extension({extension_spec:e});return t.length>0?!0:!1},e.when_downloaded=function(e){var t=this,n=!1,i=function(){t.is_downloaded()&&!n&&(n=!0,e())};i(),S({namespace:"ExtensionManager",type:"registeredExtension",callback:i})}}(l.prototype);var c=function(){var e=this;e.__extension_specs=[],e.__extension_specs_by_name={},e.__extensions_by_name={},e.__extensions_by_source={},e.__extensions_by_name_and_version={},e.__extensions_by_name_and_source={},e.__extensions_by_name_and_version_and_source={}};!function(t){var n=null;c.get_instance=function(){return n=n||new c};var a=0;c.get_next_extension_name=function(){return a+=1,"__Extension0."+a},t.__lazy_load_data_structures=function(e){var t=this,n=e.name,i=e.version,o=e.source;t.__extensions_by_name[n]=t.__extensions_by_name[n]||[],t.__extensions_by_source[o]=t.__extensions_by_name[o]||[],t.__extensions_by_name_and_version[n]=t.__extensions_by_name_and_version[n]||{},t.__extensions_by_name_and_version[n][i]=t.__extensions_by_name_and_version[n][i]||[],t.__extensions_by_name_and_source[n]=t.__extensions_by_name_and_source[n]||{},t.__extensions_by_name_and_source[n][o]=t.__extensions_by_name_and_source[n][o]||[],t.__extensions_by_name_and_version_and_source[n]=t.__extensions_by_name_and_version_and_source[n]||{},t.__extensions_by_name_and_version_and_source[n][i]=t.__extensions_by_name_and_version_and_source[n][i]||{},t.__extensions_by_name_and_version_and_source[n][i][o]=t.__extensions_by_name_and_version_and_source[n][i][o]||[]},t.get_expected_source_for_extension=function(t){if("undefined"==typeof t.name)throw new Error("[olark] 'name' required for extension source lookup");var n=t.name,a=i.test(n)?!1:!0;if(a=a||o.test(n.toLowerCase()),a=a||/.*_.*/.test(n),"undefined"!=typeof s[n])return s[n];if(a)return null;for(var r="",_=0;_<n.length;_++){var l=n[_]||n.slice(_,_+1);/[ABCDEFGHIJKLMNOPQRSTUVWXYZ]/.test(l)?(r.length>0&&(r+="-"),r+=l.toLowerCase()):r+=l}var c=e._&&e._.plugins?e._.plugins:window.olark.__buildinfo.jshost+"/javascript/plugins",d=u[n]||"1",h=c+"/"+r+".js?v="+d;return h},t.register_declared_extension=function(e){var t=this,n=e.extension;if("undefined"==typeof n)throw new Error("[olark] 'extension' required");var i=n.get_name(),o=n.get_version(),a=n.get_source();a&&V({url:a})&&(a=null),t.__lazy_load_data_structures({name:i,version:o,source:a}),t.__extensions_by_name[i].push(n),t.__extensions_by_source[a].push(n),t.__extensions_by_name_and_version[i][o].push(n),t.__extensions_by_name_and_source[i][a].push(n),t.__extensions_by_name_and_version_and_source[i][o][a].push(n),I({namespace:"ExtensionManager",type:"registeredExtension"})},t.for_each_extension_spec=function(e){for(var t=this,n=t.__extension_specs.length,i=t.__extension_specs,o=0;n>o;)!function(t){B(function(){e(t,i)},function(e){v.error("[olark] error while iterating over required extension spec:",t,"error was: "+e.toString()),v.showErrorBacktrace(e)})}(t.__extension_specs[o]),o++},t.register_extension_spec=function(e){var t=this,n=e.extension_spec;if("undefined"==typeof n)throw new Error("[olark] 'extension_spec' required");var i=n.get_name(),o=n.get_version(),a=n.get_source();a&&V({url:a})&&(a=null);var r=t.__extension_specs_by_name[i];if(!r||r.get_source()!==n.get_source()){if(r){var s=r.get_version(),_=r.get_source();o&&a&&s&&_?(o!=s||a!=_)&&v.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",r.get_pretty_string()):o&&s?o!=s&&v.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",r.get_pretty_string()):a&&_&&a!=_&&v.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",r.get_pretty_string())}n.begin_download(),t.__extension_specs.unshift(n),t.__extension_specs_by_name[i]=n,I({namespace:"ExtensionManager",type:"registeredExtensionSpec"})}},t.search_for_extension=function(e){var t=this,n=e.name,i=e.version,o=e.source,a=e.extension_spec;if(a&&(n=a.get_name(),i=a.get_version(),o=a.get_source()),o&&V({url:o})&&(o=null),o=null,t.__lazy_load_data_structures({name:n,version:i,source:o}),n&&i&&o)return t.__extensions_by_name_and_version_and_source[n][i][o];if(n&&i)return t.__extensions_by_name_and_version[n][i];if(n&&o)return t.__extensions_by_name_and_source[n][o];if(i&&o)throw new Error("[olark] cannot search by version and source");if(n)return t.__extensions_by_name[n];if(o)return t.__extensions_by_source[o];throw new Error(i?"[olark] cannot search by version":"[olark] missing search criteria")}}(c.prototype);var d=function(){var e=this;e.__configuration_callbacks=[],S({namespace:"ExtensionManager",type:"registeredExtensionSpec",callback:function(){e.__check_for_olark_key()}})};!function(t){function n(t){var n,i,o=e._?e._.defaults:null;if(o)for(n in o)if(o.hasOwnProperty(n)){t[n]||(t[n]={});for(i in o[n])o[n].hasOwnProperty(i)&&(t[n][i]=o[n][i])}return t}var i=null;d.get_instance=function(){return i=i||new d},t.register_configure_callback=function(e){var t=this,n=e.callback;if("undefined"==typeof n)throw new Error("[olark] 'callback' required");t.__configuration_callbacks.push(n),t.__check_for_olark_key()},t.read_configuration=function(){var e=this,t=e.__read_configuration({ignore_errors:!1});return t.system.olark_key=e.get_olark_key(),t},t.get_olark_key=function(){var e=this,t=e.__read_configuration({ignore_errors:!0});t.chat.legacy_site_id&&(t.system.legacy_site_id=t.system.legacy_site_id||t.chat.legacy_site_id,v.warn("[olark] conf.chat.legacy_site_id is deprecated, please use conf.system.legacy_site_id instead"));var n=e.__parse_olark_site_id_from_dom(),i=t.system.site_id||t.system.olark_key||t.system.legacy_site_id||window.olark.__k||n;return i&&(i=i.replace(/^\s*/,"").replace(/\s*$/,""),p.test(i)&&(i=f)),i},t.__parse_olark_site_id_from_dom=function(){var e=document.getElementById("olark-key");if(e&&e.className)return j(e.className.replace("site-",""));var t=document.getElementsByTagName("a");for(var n in t)if("function"!=typeof t[n]){var i=t[n];if(i&&"olark-key"==i.className)return i.style.display="none",i.id.replace("olark-","")}return null},t.__read_configuration=function(e){var t=this;e=e||{};var i=e.ignore_errors?!0:!1,o={box:{},chat:{},data:{},browser:{},extensions:{},system:{},locale:{}};o=n(o),c.get_instance().for_each_extension_spec(function(e){o[e.get_name()]=o[e.get_name()]||{}});for(var a=0;a<t.__configuration_callbacks.length;){if("function"==typeof t.__configuration_callbacks[a]){var r=t.__configuration_callbacks[a];if(i)try{r(o)}catch(s){}else B(function(){r(o)},function(e){v.error("[olark] error with your configuration, overall configuration may be incomplete now: "+e.toString()),v.showErrorBacktrace(e)})}a++}return o},t.__check_for_olark_key=function(){var e=this;e.get_olark_key()&&I({namespace:"ConfigurationManager",type:"olarkKeyAvailable"})}}(d.prototype);var h=function(e){if(e.length<a)throw new Error("[olark] extensions cannot be named '"+e+"', names must be more than "+a+" letters long");if(!i.test(e))throw new Error("[olark] extensions cannot be named '"+e+"', names must start with a capital alphabetic letter and contain only alpha characters");if(o.test(e.toLowerCase()))throw new Error("[olark] extensions cannot be named '"+e+"', that name is protected for internal use")},m=function(e){var t=e.extension_name;if("undefined"==typeof t)throw new Error("[olark] 'extension_name' required");var n=!1;return c.get_instance().for_each_extension_spec(function(e){e.get_name()==t&&(n=!0)}),n},b=function(e){var t=!1,n=function(){var n=!0;c.get_instance().for_each_extension_spec(function(e){e.is_downloaded()||(n=!1)}),n&&!t&&(t=!0,e())};n(),S({namespace:"ExtensionManager",type:"registeredExtension",callback:n}),A({delay:1e3*r},function(){if(!t){t=!0,e();var n=[];c.get_instance().for_each_extension_spec(function(e){e.is_downloaded()||n.push(e.get_pretty_string())}),v.warn("[olark] unable to download some extensions:",n.join(","))}})},y=function(e){var t=!1;M(function(){return window.olark&&window.olark.__core&&window.olark.__core.api&&window.olark.__core.box&&window.olark.__core.chat&&window.olark.__core.data&&window.olark.__core.extensions&&window.olark.__core.framestorewithjson&&window.olark.__legacy_shim&&window.olark.__legacy_shim.legacy_stub_is_loaded&&window.olark.__legacy_shim.legacy_post_stub_is_loaded},function(){t||(t=!0,e())}),A({delay:1e3*g},function(){t||(t=!0,e(),v.warn("[olark] unable to download core libraries."))})},w=function(e){var t={};c.get_instance().for_each_extension_spec(function(n,i){var o=c.get_instance().search_for_extension({extension_spec:n}),a=null;if(0===o.length)v.error("[olark] no loaded extensions matched:"+n.get_pretty_string(),i);else if(1==o.length)a=o[0];else{a=o[0];for(var r=o.slice(1),s=[],_=r.length;_--;){var l=r[_].get_pretty_string();s.push(l)}v.warn("[olark] more than one extension matched for "+n.get_pretty_string(),", so we used the first one:",a.get_pretty_string(),"\nYou might want to be more specific. These extensions were also found:",T(s))}var d=t[n.get_name()];d?v.warn("[olark] we already loaded an extension by the name of "+n.get_name(),"(",d.get_pretty_string(),")",i):a&&(a.activate({configuration:e}),t[n.get_name()]=a)}),I({namespace:"core",type:"extensionsActivated"})},k=function(){t.publicMethods.extend=function(e){v.warn("[olark] you cannot do olark.extend() once Olark is already starting up (dropping extension:"+e+")")},t.publicMethods.configure=function(){v.warn("[olark] you cannot do olark.configure() once Olark is already starting up.")}},E=function(e){var t=d.get_instance().get_olark_key(),n=C(e);t?n():S({namespace:"ConfigurationManager",type:"olarkKeyAvailable",callback:n})},R=function(e){/Chrome/.test(navigator.userAgent)&&e.chat.onReady(function(){try{for(var e=document.styleSheets,t=e.length-1;t>=0;t--){var n=e[t].cssRules;if(n){var i=n[0],o=i.selectorText;i.selectorText="#olark-workaround",i.selectorText=o;break}}}catch(a){v.warn("[olark] Chrome stylesheet workaround not active")}})},D=function(t,n){var i="olark-targeting-plugin";e._.opm.install([i],function(o,a){if(o)v.warn("[olark] unable to install '"+i+"' due to",o);else{try{a(i).activate(e,n)}catch(r){v.warn("[olark] unable to activate plugin '"+i+"'"),v.error(r)}q(t,n)}})},q=function(t,n){R(t),n.system.force_ssl&&(window.hbl_ext="https",window.hblStaticPath=window.hblStaticPath.replace("http:","https:"),window.hblPostURL=window.hblPostURL.replace("http:","https:"));var i=n.system.deferred_chat_connection!==!0||t.chat.__SPI_hasConnectedAlready();1!=e._.preventBoot&&i&&n.system.disable_event_connection!==!0&&t.chat.connect()},L=function(){var e="#habla_beta_container_do_not_rely_on_div_classes_or_names",t="@media print {"+e+" {display: none !important}}",n=document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),n.appendChild(i)
},H=function(){e._.P("bootstart"),y(function(){t.whenDocumentReady(function(){e._.P("domready"),E(function(){e._.P("keyready");var t=d.get_instance().get_olark_key(),n=d.get_instance().read_configuration();e._.P("getstorage"),window.olark.__core.data.prepare(t,n.system.force_localstorage_fallback,function(){e._.P("storage");var t=new window.olark.__core.data.StorejsKeyStore;e._.isNewConversation&&(t.clearConversationData(),window.olark.__legacy_shim.isNewConversation=!0),k(),b(function(){e._.P("extready");var t=d.get_instance().read_configuration();if(t.system.allow_end_conversation&&(e.__legacy_shim.allowEndConversation=!0),t.system.domain)try{window.olark.__core.data.forceDomain(t.system.domain),window.olark.__legacy_shim.forced_cookie_domain=t.system.domain}catch(n){v.warn("[olark] unable to use domain '"+t.system.domain+"' ("+n+")")}if(t.system.path)try{window.olark.__core.data.forcePath(t.system.path)}catch(n){v.warn("[olark] unable to use path '"+t.system.path+"' ("+n+")")}w(t);var i=new e.__core.api.ApiInstance({conf:t,namespace:"__bootprocessplugin",extension_name:"__bootprocessplugin"});i.chat.onReady(L);for(var o=t.system.rules||[],a=e._.rulesLookup={},r=!1,s=0;s<o.length;s++){var _=o[s];_.enabled&&(r=!0,a[_.id]=_)}r?D(i,t):q(i,t)})})})})})},U=function(e){c.get_instance().for_each_extension_spec(function(t){e(t.get_name())})},z=function(e){S({namespace:"core",type:"extensionsActivated",callback:e})},W=function(e){return e(window)};e.__core={listen_for_event:S,trigger_event:I,async_script_load:P,logger:v,format_bulleted_list_for_logger:T,wait_for:M,is_extension_required:m,create_idempotent_callback:C,trigger_olark_boot_process:H,when_document_is_ready:function(e){t.whenDocumentReady(e)},when_corelib_is_available:y,do_async_call:A,run_legacy_code:W,clone_object:O,deep_equals:N,join_string_list:F,for_each_extension_name_starting_with_most_recent:U,after_extensions_are_activated:z,try_and_optionally_catch:B,listen_for_browser_event:x,ConfigurationManager:d,BrowserTab:n},t.publicMethods.extend=function(t,n){B(function(){var i=null,o=null,a=null;if("function"==typeof t){i=c.get_next_extension_name();var r=t;e.declare({name:i,startup:r})}else{if("string"!=typeof t)throw new Error("[olark] extend requires either an extension name or an inline startup function");i=t,o=n?n.version:null,a=n?n.source:null,h(i)}var s=new l({name:i,version:o,source:a});c.get_instance().register_extension_spec({extension_spec:s})},function(e){v.error("[olark] failed in olark.extend: "+e.toString()),v.showErrorBacktrace(e)})},t.publicMethods.declare=function(e,t){B(function(){var n=null,i=null,o=null;if("string"==typeof e){v.warn("[olark] old-style extension declarations are no longer supported");var a=e.split("@");n=a[0],i=2==a.length?a[1]:null,o=t}else n=e.name,i=e.version,o=e.startup;h(n);var r=new _({name:n,version:i,startup:o});c.get_instance().register_declared_extension({extension:r})},function(e){v.error("[olark] failed in olark.declare: "+e.toString()),v.showErrorBacktrace(e)})},t.publicMethods.configure=function(e,t){var n,i;"string"==typeof e?(i=e.split("."),n=function(e){var n=i[0],o=e[i[0]];if(o){var a=i[1];o[a]=t,"_"==a[0]&&v.warn("[olark] cannot configure private key:",a)}else v.warn("[olark] unknown configuration namespace:",n)}):n=e,d.get_instance().register_configure_callback({callback:n})},t.publicMethods.ready=function(e){e()},t.publicMethods.identify=function(){},t.publicMethods.load=function(){}});try{window.olark.__core.trigger_olark_boot_process()}catch(k){P({url:""})}}(),window.hbl_ssl="https:"==document.location.protocol?!0:!1,hbl_ext=window.hbl_ssl?"https":"http",hblCacheConstant="application",hbl_hostname="olark.com/nrpc",hbl_static_hostname="static.olark.com",hblStaticPath=hbl_ext+"://static.olark.com/js",hblPostURL=hbl_ext+"://www.olark.com/emails/create",hblPopupURL=olark&&olark._&&olark._.popout?olark._.popout:hblStaticPath+"/html/popout.html",hblUrlHandler=olark&&olark._&&olark._.follow?olark._.follow:hblStaticPath+"/html/url_handler.html",hblPostStub=hblStaticPath+"/wc_post.js?"+hblCacheConstant,y=!0,hblName="Olark Chat",hblInstallUrl="http://www.olark.com/dashboard/install";var u={util:{},pipelines:{},themes:{},hwindow_util:{},plugins:{},hwindow:{config:function(){this.vars={},this.palette={},this.style_id={},this.style={},this.style_classes={},this.style_classes_map={}}},jsoncallback_norv:function(){}};u.util.eventmanager=function(){this.registered_events={},this.register=function(e,t,n){void 0==this.registered_events[e]&&(this.registered_events[e]=[]),void 0==n&&(n=999),this.registered_events[e].push({handler:t,priority:n}),this.registered_events[e]=this.registered_events[e].sort(function(e,t){return e.priority-t.priority})},this.handle=function(e,t){if(void 0!=this.registered_events[e]){void 0==t&&(t={}),t.window=this.win,t.event_name=e;var n="";for(var i in t)t.hasOwnProperty(i)&&(n+=i+"="+t[i]+"|");for(var o in this.registered_events[e])this.registered_events[e].hasOwnProperty(o)&&this.registered_events[e][o]&&"function"==typeof this.registered_events[e][o].handler&&this.registered_events[e][o].handler(t)}},this.unregister_all=function(e){this.registered_events[e]=[]},this.setWindow=function(e){this.win=e}};var p=1,f=0,g=1,m=1,v="0.5m",b="begin_2",y=!0,w=1e3,k=".";u.eventmgr=new u.util.eventmanager,habla_window=void 0,u.get_current_page=function(){return document.URL},u.get_current_referrer=function(){return document.referrer},u.hconfig=function(){this.vars={input_width_offset_normal:16,input_width_offset_ie:16,input_width_offset_compat:8,theme_url:"../theme.js"},this.palette={},this.style={},this.plugins=new u.util.pluginlist,this.style_id={},this.style_classes={},this.style_classes_map={}},u.hconfig.prototype.setMargin=function(e){this.setMargins(e,e,e,e)},u.hconfig.prototype.setMargins=function(e,t,n,i){this.vars.bottom_margin=i,this.vars.right_margin=n,this.vars.left_margin=e,this.vars.top_margin=t},u.hconfig.prototype.setPosition=function(e){this.vars.corner_position=e},u.hconfig.prototype.setDirectionRtl=function(e){this.vars.rtl=e,this.style_classes.habla_conversation_div='height: $vars["convo_height_px"]; overflow: auto; border-bottom: 1px dotted $palette["control"]; background: transparent; line-height: 1.5em; padding: 3px 23px 3px 3px; border: 1px solid',this.style_classes.habla_window_div="z-index:3000; direction: rtl",this.style_classes.habla_conversation_message_off="margin: 0; padding: 3px 23px 3px 3px;",this.style_classes.habla_conversation_p_item='color: $palette["main_fg"]; margin: 0; padding: 0; text-indent: -20px; background: transparent; text-align: right;',this.style_classes.habla_conversation_person1='color: $palette["local"]; padding-left: 5px; float: right;',this.style_classes.habla_conversation_person2='color: $palette["remote"]; padding-left: 5px; float: right;'},u.hconfig.prototype.setInline=function(e){e?(this.vars.is_inline=1,this.vars.disableFocus=1):(this.vars.is_inline=0,this.vars.disableFocus=0)},u.hconfig.prototype.setHeight=function(e){this.vars.convo_height=e},u.hconfig.prototype.setWidth=function(e){this.vars.width=e},u.util.pluginlist=function(){this.todo=[],this.defined={},this.add=function(e,t){void 0==t&&(t=999),void 0!=e&&(this.defined[e.name]||(this.defined[e.name]=1,this.todo.push({handler:e,priority:t}),this.todo=this.todo.sort(function(e,t){return e.priority-t.priority})))}},u.util.get_body=function(){var e=document.getElementsByTagName("html"),t=null;e.length<1?(t=document.createElement("html"),document.appendChild(t)):t=e[0],e=document.getElementsByTagName("body");var n=null;return e.length>0?n=document.getElementsByTagName("body").item(0):(n=document.createElement("body"),t.appendChild(n)),n},u.util.get_head=function(){var e=document.getElementsByTagName("html"),t=null;e.length<1?(t=document.createElement("html"),document.appendChild(t)):t=e[0],e=document.getElementsByTagName("head");var n=null;return e.length>0?n=document.getElementsByTagName("head").item(0):(n=document.createElement("head"),t.appendChild(n)),n},u.util.generate_script_js_pollid=function(){return"undefined"==typeof u.util.last_js_pollid&&(olark.__core.logger.error("[olark] 'get_polling_script_id' requires hbl.util.last_js_pollid to be defined"),u.util.last_js_pollid=0),"olark-"+u.util.last_js_pollid+(new Date).getTime()},u.util.simple_load_js_async=function(e){var t=u.util.get_body(),n=document.createElement("script");n.setAttribute("language","javascript"),n.setAttribute("type","text/javascript"),n.setAttribute("data-cfasync","false"),n.setAttribute("async",""),n.setAttribute("defer","true"),n.setAttribute("src",e),t.appendChild(n)},u.util.BrowserDetect={_initialized:!1,init:function(){if(!this._initialized){if(this.browser=this.searchString(this.dataBrowser,1)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.use_position_absolute_on_ie=!1,this.backwards_dimension=!1,this.need_submit_button=!1,"BackCompat"==document.compatMode&&(this.backwards_dimension=!0),"Explorer"==this.browser){var e=0,t=navigator.userAgent.match(/Trident\/(\d+)/);t&&(e=t[1]),this.version>=10||e>=6?this.use_position_absolute_on_ie=!1:(this.use_position_absolute_on_ie=!0,(this.version>=7||document.body&&"undefined"!=typeof document.body.style.maxHeight)&&"BackCompat"!=document.compatMode&&(this.use_position_absolute_on_ie=!1))}navigator.userAgent&&navigator.userAgent.toLowerCase().indexOf("wii")>-1&&(this.need_submit_button=!0),this._initialized=!0}},searchString:function(e,t){for(var n=0;n<e.length;n++){var i=e[n].string,o=e[n].prop;if(this.versionSearchString=e[n].versionSearch||e[n].identity,i){if(-1!=i.indexOf(e[n].subString))return void 0!=t&&(this.supported=e[n].supported),e[n].identity}else if(o)return e[n].identity&&(this.supported=e[n].supported),e[n].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.vendor,subString:"Apple",identity:"Safari",supported:"1"},{prop:window.opera,identity:"Opera",supported:"1"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox",supported:"1"},{string:navigator.vendor,subString:"Camino",identity:"Camino",supported:"1"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape",supported:"1"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE",supported:"1"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv",supported:"1"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla",supported:"1"},{string:navigator.userAgent,subString:"iPad",identity:"iPad",supported:"1"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone",supported:"1"}]},hblHasinit=void 0,window.__olark_external_start&&window.__olark_external_start();var x=document.getElementById("hbl_code");x&&(x.style.display="none"),function(){try{var e=".olark-key,#hbl_code,#olark-data{display: none !important;}",t=document.getElementsByTagName("head")[0],n=document.createElement("style"),i=document.createTextNode(e);n.type="text/css",n.styleSheet?n.styleSheet.cssText=i.nodeValue:n.appendChild(i),t.appendChild(n)}catch(o){}}(),window.__get_olark_key=function(){var e=function(e,t){var n=e.className||"";return-1!=n.indexOf(t)},t=document.getElementById("olark-data");if(t&&t.childNodes)for(var n=t.childNodes.length;n--;){var i=t.childNodes[n];if(e(i,"olark-key"))return i.id.replace("olark-","")}for(var o=document.getElementsByTagName("a"),a=o.length;a--;){var r=o[a];if(e(r,"olark-key"))return r.id.replace("olark-","")}return null},window.olark&&window.olark.__legacy_shim&&(window.olark.__legacy_shim.legacy_stub_is_loaded=!0),u.hconfig.prototype.merge=function(e,t){if(this.copy_hash(this.vars,e.vars,t),this.copy_hash(this.style,e.style,t),this.copy_hash(this.palette,e.palette,t),this.copy_hash(this.style_id,e.style_id,t),this.copy_hash(this.style_classes,e.style_classes,t),this.copy_hash(this.style_classes_map,e.style_classes_map,t),e.plugins&&e.plugins.todo)for(var n in e.plugins.todo)e.plugins.todo.hasOwnProperty(n)&&this.plugins.add(e.plugins.todo.handler,e.plugins.todo.priority)},u.hconfig.prototype.copy_hash=function(e,t,n){if(t)for(var i in t)t.hasOwnProperty(i)&&(n||void 0==e[i])&&(e[i]=t[i])},u.hconfig.prototype.up=function(e){this.merge(e,!0)},u.hconfig.prototype.render_all_styles=function(e){for(var t in this.style_classes_map)this.style_classes_map.hasOwnProperty(t)&&"string"==typeof t&&e[t]&&this.render_element_classes(e,t)},u.hconfig.prototype.render_stylesheet=function(){u.util.css.create_css_class("div#habla_window_div p","padding:0;");for(var e in this.style_classes)if(this.style_classes.hasOwnProperty(e)){var t=this.render_part(this.style_classes[e]);u.util.css.create_css_class("."+e,t)}},u.hconfig.prototype.smart_join=function(e,t){var n="";for(var i in e)e.hasOwnProperty(i)&&"string"==typeof e[i]&&(n+=e[i]+t);return n},u.hconfig.prototype.render_element_classes=function(e,t){this.set_element_classes(e[t],t)},u.hconfig.prototype.set_element_classes=function(e,t){e&&this.style_classes_map[t]&&this.style_classes_map[t].join&&(e.className=this.smart_join(this.style_classes_map[t]," "))},u.hconfig.prototype.render_element=function(e,t){this.render_element_classes(e,t)},u.hconfig.prototype.render_class=function(e,t,n){if(e&&e.className){var i=e.className.split(" "),o=[];for(var a in i)i.hasOwnProperty(a)&&"string"==typeof a&&i[a]!=n&&i[a]!=t&&o.push(i[a]);o.push(t),e.className=this.smart_join(o," ")}},u.hconfig.prototype.render_ie_hacks=function(){(u.util.BrowserDetect.use_position_absolute_on_ie&&this.vars.disableJSStyles&&!this.vars.is_inline||this.vars.yahoo_ui)&&(window.hbl.__ie6_floating_div_monitor||(window.hbl.__ie6_floating_div_monitor=new window.__ie6_float_hack))},u.hconfig.prototype.remap_palette=function(){var e={mainbg:"main_bg",mainfg:"main_fg",titlebg:"title_bg",titlefg:"title_fg",buttonbg:"button_bg",buttonfg:"button_fg",buttonhi:"button_bg_highlight",titlebg_highlight:"title_bg_highlight",titlefg_highlight:"title_fg_highlight",control:"control_border",control_highlight:"control_highlight_border",local:"local_fg",remote:"remote_fg",border:"panel_border"};for(var t in e)if(e.hasOwnProperty(t)){if("string"!=typeof t)continue;this.palette[t]&&(this.palette[e[t]]=this.palette[t])}this.palette.buttonfg&&(this.palette.button_fg_highlight=this.palette.buttonfg)},u.hconfig.prototype.init_from_config=function(e){e.setWidth(this.vars.width),e.setHeight(this.vars.height),this.vars.is_inline?e.setInline(this.vars.is_inline):e.setPosition(this.vars.corner_position),e.setMargins(this.vars.left_margin,this.vars.top_margin,this.vars.right_margin,this.vars.bottom_margin),e.setInputHeight(this.vars.input_height),e.setFormInputHeight(this.vars.input_height),"Opera"==u.util.BrowserDetect.browser&&(this.vars.poll=!0)},u.hconfig.prototype.load_defaults=function(){this.plugins=new u.util.pluginlist,this.vars=[],this.palette={},this.palette.link="#e75917",this.vars.line_length=21,this.vars.bottom_margin=10,this.vars.right_margin=10,this.vars.left_margin=10,this.vars.top_margin=10,this.vars.width=260,this.vars.height=155,this.vars.panel_offset=20,this.vars.resize_input_height=60,this.vars.input_height=20,this.vars.corner_position="BR",this.vars.offline_msg_mode=!0,this.vars.rtl=!1,this.vars.resize_length=25,this.vars.myname="you",this.vars.say_text="Type here and hit enter to chat",this.vars.send_text="Send",this.vars.check_for_status=hblName+" (startup)",this.vars.disable_expand_text_input=!1,this.vars.disable_set_cookies=!1,this.vars.disable_get_cookies=!1,this.vars.cookie_path="/",this.vars.hbl_cookie_path="/",this.vars.session_expire=void 0,this.vars.local_user_display_name="&rarr;",this.vars.disableGoogleAnalytics=0,this.vars.expandOnMessageReceived=0,this.vars.enable_google_analytics=!1,this.vars.google_analytics_domain="auto",this.vars.language="en",this.vars.enableLanguageTranslation=!1,this.vars.expandOnFirstMessageReceived=1,this.vars.close_hides_window=!1,this.vars.plugin_path=hblStaticPath+"/plugins/",this.vars.divid="habla_window_div",this.vars.poll=!1,"Opera"==u.util.BrowserDetect.browser&&(this.vars.poll=!0),this.vars.habla_name_input_text="click here and type your Name",this.vars.habla_offline_email_text="click here and type your Email",this.vars.habla_offline_phone_text="click here and type your Phone",this.vars.habla_offline_body_text="We're not around but we still want to hear from you!  Leave us a note:",this.vars.habla_offline_submit_value="Send",this.vars.habla_offline_sent_text="Thanks for your message!  We'll get back to you shortly.",this.vars.in_chat_text="Now Chatting",this.vars.before_chat_text="Chat with us!",this.vars.not_available_text="Contact us!",this.vars.busy_text="Contact us",this.vars.away_text="Contact us",this.vars.offline_message="We're not around, but we'd love to chat another time.",this.vars.welcome_msg="Questions? We'd love to chat!",this.vars.busy_message="All of our representatives are with other customers at this time. We will be with you shortly.",this.vars.enable_buttons=1,this.vars.hide_min_max_buttons=0,this.vars.local_name_override=void 0,this.vars.url_handler_target_window="_top",this.vars.url_handler=hblUrlHandler,this.vars.parse_links=1,this.vars.is_inline=0,this.vars.start_expanded=0,this.vars.start_hidden=0,this.vars.hide_not_available=0,this.vars.append_to_body=1,this.vars.show_away=0,this.vars.hide_when_away=0,this.vars.show_away_as_header=0,this.vars.habla_sizebutton_text_expanded="_",this.vars.habla_sizebutton_text_compressed="^",this.vars.habla_closebutton_text="x",this.vars.habla_popout_text=">",this.vars.habla_end_popout_text="<<",this.vars.start_visible=!1,this.vars.start_habla_window_visible=!1,this.vars.pre_chat_message="Hi, I am around, click 'start chatting' to contact me.",this.vars.pre_chat_submit="Click here to start chatting",this.vars.pre_chat_error_text="Please enter your name and email in case we get disconnected.",this.vars.show_pre_chat=0,this.vars.require_name=2,this.vars.require_email=1,this.vars.require_phone=0,this.vars.require_offline_phone=0,this.vars.show_end_popout=0,this.vars.show_popout=0,this.vars.is_popup=0,this.vars.sending_text="sending",this.vars.email_body_error_text="You must complete all fields and specify a valid email address",this.vars.habla_special_div_show_type="block",this.vars.operator_has_stopped_typing_text="has stopped typing",this.vars.operator_is_typing_text="is typing...",this.vars.flash_icons=1,this.vars.flash_titlebar=1,this.vars.default_flash_off_icon=hblStaticPath+"/images/white.ico",this.vars.default_flash_on_icon=hblStaticPath+"/images/orange.ico",this.vars.ended_chat_message="This chat has ended, start typing below if you need anything else!",this.style_classes_map={},this.style_id={},this.style_classes={}},window.hbl||(window.hbl={}),window.hbl.__ie6_floating_div_monitor=void 0,window.__ie6_float_hack=function(){var e=this;e.__moving=!1,e.__need_to_move=function(){var t=e.__with_complete_habla_window(function(e){var t=e.config.vars,n=S({dom_element:e.theme.habla_window_div,top:t.top_margin,bottom:t.bottom_margin,left:t.left_margin,right:t.right_margin,corner:t.corner_position});if(e.theme){var i={x:e.theme.getX(),y:e.theme.getY()},o=n.x-i.x,a=n.y-i.y,r=Math.max(Math.abs(o),Math.abs(a));return{x:o,y:a,max_diff:r}}return{x:0,y:0,max_diff:0}});return t?t:{x:0,y:0,max_diff:0}},e.__with_complete_habla_window=function(e){var t=window.habla_window;return t&&t.config&&t.config.vars&&t.config.vars.corner_position?e(t):void 0},e.__move_window=function(t,n){e.__with_complete_habla_window(function(e){var i=e.config.vars,o=S({dom_element:e.theme.habla_window_div,top:i.top_margin,bottom:i.bottom_margin,left:i.left_margin,right:i.right_margin,corner:i.corner_position});e.theme.setXY(o.x-t,o.y-n)})},e.__check_location=function(){e.__move_to_correct_location(),setTimeout(function(){e.__check_location()},500)},e.__move_to_correct_location=function(t){var n=e.__need_to_move();!t&&n.max_diff<2||(t||n.max_diff<15?e.__move_window(0,0):(e.__move_window(0,.5*n.y),setTimeout(function(){e.__move_to_correct_location()},40)))},e.stop=function(){e.__timeout&&clearTimeout(e.__timeout),e.__timeout=void 0},e.start=function(){e.stop(),e.__timeout=setTimeout(function(){e.__check_location()},500)},e.__move_to_correct_location(!0),e.start()};var S=function(e){var t=0,n=0,i=e.dom_element.offsetWidth,o=e.dom_element.offsetHeight,a=window.innerWidth||(document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth),r=window.innerHeight||(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight),s=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,_=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;return t=e.corner.match("R")?a+s-e.right-i:e.left+s,n=e.corner.match("B")?r+_-e.bottom-o:e.top+_,{x:t,y:n}};u.util.pluginlist.prototype.load=function(e){for(var t=e,n=0;n<this.todo.length;n++)this.todo[n]&&this.todo[n].handler&&"function"==typeof this.todo[n].handler.load&&1==this.defined[this.todo[n].handler.name]&&(this.todo[n].handler.load(e),this.defined[this.todo[n].handler.name]=2);return t},u.util.last_js_id=0,u.util.last_js_pollid=0,u.util.pipeline=function(e){this.todo=[],this.host_obj=e,this.add=function(e,t){void 0==t&&(t=999),this.todo.push({handler:e,priority:t}),this.todo=this.todo.sort(function(e,t){return e.priority-t.priority})},this.run=function(e){for(var t=e,n=0;n<this.todo.length;n++)if(this.todo[n]&&"function"==typeof this.todo[n].handler){if(t=this.todo[n].handler(e,this.host_obj),void 0==t)return void 0;e=t}return t},this.setTarget=function(e){this.host_obj=e}},u.util.listenForEvent=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):(e["on"+t]=n,n)},u.util.pluginloader=function(e,t,n){u.pluginArgs={conf:e,client:t,hwindow:n},e.plugins.load({conf:e,client:t,hwindow:n})},u.util.timestamp=function(){var e=new Date;return e.toUTCString()},u.util.reportException=function(e){olark._.hlog("exception:",e,"#error")},u.util.urlencode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=n+"="+encodeURIComponent(e[n])+"&");return t},u.util.load_js_async=function(e){u.util.last_js_id+=1,u.util.last_js_pollid+=1;var t="jscript"+u.util.last_js_id;if(e+=e.indexOf("?")>-1?"&"+t:"?"+t,u.util.last_js_id>1900){if(!e.match(/sendmessage/i)&&!e.match(/begin/i))return;u.util.last_js_id=1}var n=u.util.get_body(),i=document.createElement("script");i.setAttribute("language","javascript"),i.setAttribute("id",t),i.setAttribute("type","text/javascript"),i.setAttribute("data-cfasync","false"),i.setAttribute("async",""),i.setAttribute("defer","true"),i.setAttribute("src",e),n.appendChild(i)},u.util.remove_element=function(e){var t=document.getElementById(e);void 0!=t&&void 0!=t.parentNode&&t.parentNode.removeChild(t)},u.util.calculate_retry_delay=function(e,t,n){var i=e*(1+t);return i>n?n:i},u.util.append_script=function(e,t,n){var i=u.util.append_script,o=n.scriptid,a=n.url,r=n.tries,s=n.previous_tries||0,_=n.timeout,l=n.error_callback,c=n.success_callback,d=n.cache,h=n.retryid?n.retryid:"",p=100,f=1200,g=15e3;e.opera&&!_&&(_=200);var m=function(n){var p=t.getElementById(o+h);p?(p.loaded=!0,void 0!=p.parentNode&&p.parentNode.removeChild(p),l&&l({status:n}),r>0?e.setTimeout(function(){i(e,t,{scriptid:o,retryid:"r"+r,url:a,tries:r,previous_tries:s+1,timeout:_,error_callback:l,cache:d})},u.util.calculate_retry_delay(f,s,g)):window.olark&&window.olark._.hlog&&olark._.hlog("#rpc_call_error-"+n+" url:"+a)):c&&c()},v=a;if(!d){var b=v.length>0&&"&"!=v.charAt(v.length-1)&&"?"!=v.charAt(v.length-1);v.match(/\?/)?b&&(v+="&"):v+="?",v+="_rnd="+Math.random()}v=v.replace("?","?j="+o+h+"&");var y=t.createElement("script");y.setAttribute("language","javascript"),y.setAttribute("id",o+h),y.setAttribute("type","text/javascript"),y.setAttribute("data-cfasync","false"),y.setAttribute("async",""),y.setAttribute("defer","true"),y.setAttribute("src",v),y.loaded=!1,r&&(r-=1),_&&(y.timeout=e.setTimeout(function(){m("timeout")},_)),y.readyState?y.onreadystatechange=function(){"loaded"!=y.readyState&&"complete"!=y.readyState||y.loaded||(y.onreadystatechange=function(){},y.loaded=!0,y.timeout&&e.clearTimeout(y.timeout),e.setTimeout(function(){m("error")},p))}:(y.onload=function(){y.loaded||(y.loaded=!0,y.timeout&&e.clearTimeout(y.timeout),e.setTimeout(function(){m("error")},p))},y.onerror=function(){y.loaded||(y.loaded=!0,y.timeout&&e.clearTimeout(y.timeout),e.setTimeout(function(){m("error")},p))});var w=t.getElementsByTagName("script")[0];w.parentNode.insertBefore(y,w),olark._.internalLog&&olark._.internalLog.logHttpRequest(v)},u.util.as_dom=function(e){var t;return"object"==typeof e?e:(t=document.createElement("span"),t.innerHTML=e,t)},u.util.getCommonTextFormatter=function(){return u.util._commonTextFormatter||(u.util._commonTextFormatter=new d({urlFormatter:u.util.getCommonUrlFormatter()})),u.util._commonTextFormatter},u.util.getCommonUrlFormatter=function(){return u.util._commonUrlFormatter||(u.util._commonUrlFormatter=new h({window:window,identityManager:olark._.identityManager,cookieManager:olark._.cookieManager,util:u.util,config:u.config.vars})),u.util._commonUrlFormatter},u.util.set_inner_text=function(e,t){null!==e.textContent&&void 0!==e.textContent?e.textContent=t:e.innerText=t},u.util.encode_html_entities=function(e,t){t||(t=[]);var n={ampersand:{regex:/&/gi,replaceValue:"&amp;"},lessThan:{regex:/\</gi,replaceValue:"&lt;"},greaterThan:{regex:/\>/gi,replaceValue:"&gt;"},doubleQuote:{regex:/\"/gi,replaceValue:"&quot;"},singleQuote:{regex:/\'/gi,replaceValue:"&#x27;"},slash:{regex:/\//gi,replaceValue:"&#x2F;"}};for(var i in n)n.hasOwnProperty(i)&&_.indexOf(t,i)<=-1&&(e=e.replace(n[i].regex,n[i].replaceValue));return e},u.util.decode_html_entities=function(e){try{var t=u.util.encode_html_entities(e,["ampersand"]),n=document.createElement("div");n.innerHTML=t;var i=0===n.childNodes.length?"":n.childNodes[0].nodeValue;return i&&!/^\s*$/.test(i)?i:e}catch(n){return e}},u.util.find_or_create_el=function(e,t,n){var i=document.getElementById(e);return(!i||i.length<0)&&(void 0==t&&(t="div"),i=document.createElement(t),i.setAttribute("id",e),void 0!=n&&n.appendChild(i)),("input"==t||"textarea"==t)&&(i.name=e),i},u.util.find_or_create_div=function(e,t){return u.util.find_or_create_el(e,"div",t)},u.util.hide_div=function(e){return"object"!=typeof e&&(e=document.getElementById(e)),void 0!=e?(e.style.display="none",!0):!1},u.util.show_div=function(e,t){return void 0==t&&(t="block"),"object"!=typeof e&&(e=document.getElementById(e)),void 0!=e?(e.style.display=t,!0):!1},u.util.clean_whitespace=function(e){return e=e.replace(/^\s*/,""),e=e.replace(/\s*$/,""),e=e.replace("'","")},u.util.decode_base64=function(e){var t="";try{t=window.atob(e)}catch(n){var i,o,a,r,s,_,l,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=c.indexOf(e.charAt(d++)),s=c.indexOf(e.charAt(d++)),_=c.indexOf(e.charAt(d++)),l=c.indexOf(e.charAt(d++)),i=r<<2|s>>4,o=(15&s)<<4|_>>2,a=(3&_)<<6|l,t+=String.fromCharCode(i),64!=_&&(t+=String.fromCharCode(o)),64!=l&&(t+=String.fromCharCode(a));while(d<e.length)}return t},u.util.encode_base64=function(e){var t,n,i,o,a,r,s,_,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,d=0,h="",p=[];if(!e)return e;e=u.util.utf8_encode(e+"");do t=e.charCodeAt(c++),n=e.charCodeAt(c++),i=e.charCodeAt(c++),_=t<<16|n<<8|i,o=_>>18&63,a=_>>12&63,r=_>>6&63,s=63&_,p[d++]=l.charAt(o)+l.charAt(a)+l.charAt(r)+l.charAt(s);while(c<e.length);switch(h=p.join(""),e.length%3){case 1:h=h.slice(0,-2)+"==";break;case 2:h=h.slice(0,-1)+"="}return h},u.util.strip_whitespace=function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},u.util.is_valid_email=function(e){if(!e)return!1;var t=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,22}$/i;return t.test(e)},u.util.is_valid_phone=function(e){if(!e)return!1;var t=e.replace(/[^\+\d]/g,""),n=/[\+01]{0,4}(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\d{0,14}(x\d{1,5})?$/;return n.test(t)},u.util.utf8_encode=function(e){e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var t,n,i="",o=0;t=n=0,o=e.length;for(var a=0;o>a;a++){var r=e.charCodeAt(a),s=null;128>r?n++:s=r>127&&2048>r?String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128),null!==s&&(n>t&&(i+=e.substring(t,n)),i+=s,t=n=a+1)}return n>t&&(i+=e.substring(t,e.length)),i},u.util.css={},u.util.getElementsByClass=function(e,t){e||(e=document.getElementsByTagName("body")[0]);for(var n=[],i=new RegExp("\\b"+t+"\\b"),o=e.getElementsByTagName("*"),a=0,r=o.length;r>a;a++)i.test(o[a].className)&&n.push(o[a]);return n},u._pollevents_errors=0,u.client={SENDMESSAGE_DELAY:100,incoming_pipeline:new u.util.pipeline,first_time:!0,recorded_ssl_ip:!1,op_nickname_map:{},_seen_unique_ids:[],pollingmanager:new l(window,document,olark,u,navigator),_hasSeenID:function(e){if(e.unique_id)for(var t=0;t<this._seen_unique_ids.length;t++)if(this._seen_unique_ids[t]===e.unique_id)return!0;return!1},addLineIfUnique:function(e){return this._hasSeenID(e)?!1:(this._seen_unique_ids.push(e.unique_id),!0)},is_conversation:function(){for(var e=!1,t=!1,n=0;n<u.client.buffer.length;++n)u.client.buffer[n]&&("you"==u.client.buffer[n][0]&&(e=!0),"you"!=u.client.buffer[n][0]&&(t=!0));return e&&t},current_operator:function(){for(var e="",t=0;t<u.client.buffer.length;++t)u.client.buffer[t]&&"you"!=u.client.buffer[t][0]&&(e=u.client.buffer[t][0]);return e},noop:function(){},geolocation_ready:function(e){u.client.eventmgr.handle("geolocation_ready",e)},callbacks:{begin:function(e){u.client.jsoncallback(e,u.client.begin_call_back)},sendmessage:function(e){u.client.msg_callback(e)},sendpresence:function(){},sendcommand:function(){},pollevents:function(e){u._pollevents_errors=0,u.client.pollingmanager.finishLastPoll(),u.client.pollingmanager.isRunning()&&u.client.jsoncallback(e,u.client.callbacks.pollmessages1)},pollmessages1:function(e){var t=e;if(setTimeout(function(){u.client.eventmgr.handle("handled_nrpc_response")}),t.is_new_conversation&&u.client.eventmgr.handle("session_was_not_in_memcache",{}),t.ipaddress_lookup_needed&&u.client.record_ssl_ip(),u.client.site_is_online=t.site_is_online,u.client.conversation_has_slot=t.conversation_has_slot,e={sid:t.conversation_id,hblid:t.visitor_id,chatting:t.in_active_conversation,opstatus:t.status_state,opavailable:t.site_is_online,geoip:t.geolocation_data,ipaddress:t.ipaddress,pop_out:t.is_popup,ssl:t.ssl,box_visible:!0,opbusy:!1,operator_composing_state:e.operator_composing_state,operator_nickname:e.operator_nickname},t.operator_has_sent_message&&t.site_is_online&&(e.opstatus="available"),!t.operator_has_sent_message&&t.site_is_online&&"available"!=e.opstatus&&(e.opavailable=!1),u.client.chatting=e.chatting,e.disconnected);else{if(u.client.first_time&&(u.client.first_time=!1),"no session found"==e.exception)return;(e.opavailable!=u.client.opavailable||u.client.opmessage!=e.opmessage||u.client.opstatus!=e.opstatus||u.client.opbusy!=e.opbusy||u.client.pop_out!=e.pop_out)&&(u.client.eventmgr.handle("operator_status_change",{available:e.opavailable,opavailable:e.opavailable,status:e.opstatus,opstatus:e.opstatus,message:e.opmessage,busy:e.opbusy,pop_out:e.pop_out,pop_out_change:u.client.pop_out!=e.pop_out,chatting:u.client.chatting,box_visible:u.client.box_visible,opbusy:e.opbusy}),u.client.first_time=!1,u.client.opavailable=e.opavailable,u.client.opmessage=e.opmessage,u.client.opstatus=e.opstatus,u.client.opbusy=e.opbusy,u.client.pop_out=e.pop_out),u.client.composing!=e.operator_composing_state&&(u.client.eventmgr.handle("operator_composing",{composing_type:e.operator_composing_state,operator_nickname:e.operator_nickname}),u.client.composing=e.operator_composing_state);
for(var n,i=[],o=!1,a=t.new_events||[],r=0;r<a.length;r++){var s=a[r][0];s>u.client.last_poll_index&&(u.client.last_poll_index=s);var _=a[r][1],l=u.client.addLineIfUnique(_);_.body&&l&&"you"!=_.nickname&&(i.push([_.nickname,_.body,s]),u.client.op_nickname_map[_.nickname]=_.operator_id),"site_config_changed"==_.type&&(o=!0,n=_.md5)}u.client.append1(i),o&&(olark._.setSiteAssetHash(n),olark._.setLoaderUseAssets("1")),u.client.whenNicknameAndPresenceAreAllowed(function(){t.resend_nickname&&u.client.eventmgr.handle("resend_nickname",{}),t.resend_status&&u.client.eventmgr.handle("resend_status",{})}),u.client.pollingmanager.scheduleNextPoll()}}},siteid:"",wc_sid:"",sid:"",proxy:null,buffer:[],myname:"you",jsoncallback:function(e,t){return e.http_traffic_blocked?(olark("api.box.hide"),u.util.append_script=function(){},window.console&&window.console.warn&&window.console.warn("[olark] Olark Chat is turned off for this website, if you own this website please contact Olark via support@olark.com"),!1):(e.ended&&u.client.eventmgr.handle("conversation_ended",{next_conversation_id:e.ended.next_conversation_id}),void(e.conversation_does_not_exist?u.client.restart_session():e.retry?u.client.pollingmanager.startNextPollNow():null==t||e.duplicate_session_id||t(e)))},begin_call_back:function(e){function t(){olark._.identityManager.deleteIdentityFromCookies()}var n=olark._.hlog,i=e;if(e.error){var o=[];return"fatal_boot_exception"==e.error&&(t(),o.push("#fatal_boot_exception")),i.invalid_id_format&&(t(),o.push("#invalid_id_format")),i.conversation_does_not_exist&&(t(),o.push("#conversation_does_not_exist")),void n("stopped begin call:",e.error,"#error #begin_call_error",o.join(" "))}if(i.invalid_id_format||i.conversation_does_not_exist)return t(),void n("RPC reported no errors, but gave error flags #error #unexpected_rpc_output");i.conversation_id!=olark._.identityManager.getConversationId()&&n("RPC reported new conversationId:",i.conversation_id,"!=",olark._.identityManager.getConversationId(),"#error #new_rpc_wcsid"),i.visitor_id!=olark._.identityManager.getVisitorId()&&(n("RPC reported new visitorId, re-storing to cookie:",i.visitor_id,"!=",olark._.identityManager.getVisitorId(),"#error #new_rpc_hblid"),i.visitor_id&&olark._.identityManager.setVisitorId(i.visitor_id));var a=function(){olark("api.box.__SPI_getLegacyState",function(t){olark._.needsFirstTimeOperatorLogin=!1;var n=e;if(e.site_config_changed&&(olark._.setSiteAssetHash(e.site_md5||e.assets_config_md5),olark._.setLoaderUseAssets("1")),e={sid:n.conversation_id,hblid:n.visitor_id,chatting:n.in_active_conversation,opstatus:n.status_state,opavailable:n.site_is_online,geoip:n.geolocation_data,ipaddress:n.ipaddress,pop_out:n.is_popup,ssl:n.ssl,opbusy:!1,operator_composing_state:e.operator_composing_state,operator_nickname:e.operator_nickname,habla_message:e.habla_message,box_visible:t.box_visible,box_open:t.box_open},n.operator_has_sent_message&&n.site_is_online&&(e.opstatus="available"),!n.operator_has_sent_message&&n.site_is_online&&"available"!=e.opstatus&&(e.opavailable=!1),null==e||e.error)e&&e.error&&u.client.eventmgr.handle("habla_error",{etype:e.error});else{olark._.identityManager.setConversationId(e.sid),olark._.identityManager.setVisitorId(e.hblid),u.client.chatting=e.chatting,u.client.site_is_online=n.site_is_online,u.client.conversation_has_slot=n.conversation_has_slot,u.client.opavailable=e.opavailable,u.client.opmessage=e.opmessage,u.client.opstatus=e.opstatus,u.client.opbusy=e.opbusy,u.client.pop_out=e.pop_out,u.client.ssl=e.ssl,u.client.box_visible=e.box_visible;var i=function(e){return{available:e.opavailable,opavailable:e.opavailable,opstatus:e.opstatus,status:e.opstatus,message:e.opmessage,busy:e.opbusy,pop_out:e.pop_out,pop_out_change:u.client.pop_out!=e.pop_out,chatting:u.client.chatting,box_visible:u.client.box_visible,opbusy:e.opbusy}};if(olark._.geoip=e.geoip,olark._.ipaddress=e.ipaddress,u.client.eventmgr.handle("nrpc_data_ready",i(e)),u.client.eventmgr.handle("chat_started",{chatting:e.chatting,box_open:e.box_open,box_visible:e.box_visible,opstatus:e.opstatus,opavailable:e.opavailable,opmessage:e.opmessage,opbusy:e.opbusy,pop_out:e.pop_out,config:e.config,dconfig:e.dconfig,habla_message:e.habla_message,browser_ip:e.ipaddress,geolocation:e.geocode_ip}),u.client.last_poll_index=0,n.conversation_history){for(var o=[],a=0;a<n.conversation_history.length;a++){var r=n.conversation_history[a][0];r>u.client.last_poll_index&&(u.client.last_poll_index=r);var s=n.conversation_history[a][1],_=u.client.addLineIfUnique(s);s.body&&_&&("visitor_message"==s.type&&(r=0),o.push([s.nickname,s.body,r]),u.client.op_nickname_map[s.nickname]=s.operator_id)}u.client.setContents(o)}u.client.eventmgr.handle("operator_status_change",i(e)),u.client.opavailable=e.opavailable,u.client.opmessage=e.opmessage,u.client.opstatus=e.opstatus,u.client.opbusy=e.opbusy,u.client.pop_out=e.pop_out,u.client.eventmgr.handle("operator_composing",{composing_type:e.operator_composing_state,operator_nickname:e.operator_nickname}),u.client.composing=e.composing_type,u.client.whenNicknameAndPresenceAreAllowed(function(){n.resend_nickname&&u.client.eventmgr.handle("resend_nickname",{}),n.resend_status&&u.client.eventmgr.handle("resend_status",{})}),n.is_new_conversation&&u.client.eventmgr.handle("session_was_not_in_memcache",{}),u.client.pollingmanager.scheduleNextPoll()}})};"fatal exception"!=e.error?e.ipaddress_lookup_needed?(olark._.identityManager.setConversationId(e.conversation_id),u.client.record_ssl_ip(),u.client.eventmgr.register("geolocation_ready",function(t){e.geolocation_data=t.geolocation,e.ipaddress=t.geolocation.ipaddress,a()})):a():olark._.hlog("#boot #spoof detected")},start:function(e,t,n,i,o){olark._.identityManager.setSiteId(n),olark._.identityManager.setConversationId(e),olark._.identityManager.setVisitorId(t),u.client.eventmgr=i,u.client.config=o,u.client.opstatus=null,u.client.opavailable=null,u.client.opmessage=null,u.client.chatting=!1,u.client.pop_out=!1,u.client.buffer=[],u.client.the_count=0,u.client.newlinecount=0,u.client.lastindex=0,u.client.last_getmessages=new Date,u.client.jsondata=null,u.client.datareadycallback=null,u.client.getmsgcallback=null,u.client.first_time=!0,u.client.incoming_pipeline.setTarget(this);try{var a=new u.client.jsonproxy(olark._.nrpcBaseUrl);u.client.proxy=u.client.proxy3=u.client.proxy2=a,u.config&&u.config.vars&&!u.config.vars.local_mode&&(olark._.P("begin"),u.client.proxy.begin(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),u.get_current_page(),u.get_current_referrer(),o.vars.start_passive,o.vars.force_nickname,o.vars.no_system_messages,u.client.begin_call_back))}catch(r){throw u.client.chatting=!1,u.util.reportException(r),r}},jsoncallback_norv:function(){},jsonproxy:function(e,t){this.uri=e,this.callq=[],this.rnd=t},check_getmsg:function(){},setContents:function(e){if(!e||0==e.length){if(!(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.has_messages_in_history))return;e=[[null,"  ",.2]]}u.client.lastindex=0;for(var t=0;t<e.length;++t)u.client.buffer[u.client.buffer.length]=new Array(e[t][0],e[t][1],e[t][2]),e[t][2]>u.client.lastindex&&(u.client.lastindex=e[t][2]);u.client.newlinecount=1,window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.load_missed_messages&&window.olark.__legacy_shim.load_missed_messages(e),u.client.eventmgr.handle("receive_message",{type:"start",msg:e})},append:function(e){if(e&&e.length>0){for(var t=0;t<e.length;++t)u.client.buffer[u.client.buffer.length]=new Array(e[t][0],e[t][1],e[t][2]);u.client.newlinecount+=e.length,u.client.chatting=!0,u.client.eventmgr.handle("send_message",{type:"local_update",msg:e})}},append1:function(e){if(e&&e.length>0){for(var t=[],n=0,i=0;i<e.length;++i)if(e[i][2]>u.client.lastindex){u.client.lastindex=e[i][2];var o=u.client.incoming_pipeline.run(e[i]);void 0!=o&&(u.client.buffer[u.client.buffer.length]=o,t.push(o)),e[i]&&(n+=1)}u.client.newlinecount+=e.length,n>0&&(u.client.chatting=!0),t.length>0&&u.client.eventmgr.handle("receive_message",{type:"remote_update",msg:t})}},msg_callback:function(e){"operator_is_busy"==e.error&&u.eventmgr.handle("habla_error",{etype:"operator_is_busy"})},sendmessage:function(e,t,n,i,o,a){u.client.lastNickname=o,u.client.lastStatusMessage=a;var r=!t,s=new Array(new Array(u.client.myname,e,r,n));if(r&&u.client.append(s),i){var _="chat";u.client.proxy.setnickname(olark._.identityManager.getConversationId(),o),u.client.proxy.sendpresence(olark._.identityManager.getConversationId(),a,_)}setTimeout(function(){u.client.proxy.sendmessage(olark._.identityManager.getConversationId(),e,r,n,u.client.msg_callback)},u.client.SENDMESSAGE_DELAY),u.client.pollingmanager.startNextPollNow()},sendofflinemessage:function(e,t){var n="chat";u.client.proxy.setnickname(olark._.identityManager.getConversationId(),u.client.lastNickname),u.client.proxy.sendpresence(olark._.identityManager.getConversationId(),u.client.lastStatusMessage,n),setTimeout(function(){u.client.proxy.sendofflinemessage(olark._.identityManager.getConversationId(),e,t)},u.client.SENDMESSAGE_DELAY)},setnickname:function(e){u.client.lastNickname=e,u.client.whenNicknameAndPresenceAreAllowed(function(){u.client.proxy.setnickname(olark._.identityManager.getConversationId(),e)})},sendcommand:function(e,t){u.client.proxy.sendcommand(olark._.identityManager.getConversationId(),e,t)},record_ssl_ip:function(){u.client.recorded_ssl_ip||(u.client.proxy.geolocation(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId()),u.client.recorded_ssl_ip=!0)},restart_session:function(){u.client.proxy.noop(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId())},setvcard:function(){},sendpresence:function(e,t){u.client.lastStatusMessage=e,u.client.whenNicknameAndPresenceAreAllowed(function(){u.client.proxy.sendpresence(olark._.identityManager.getConversationId(),e,t)})},log_event:function(e,t){u.client.proxy&&u.client.proxy.log_event(olark._.identityManager.getConversationId(),e,t)},sendexpand:function(){},sendcompress:function(){},sendend:function(){},sendhide:function(){},sendshow:function(){},popout:function(){u.client.proxy&&u.client.proxy.popout(olark._.identityManager.getConversationId())},end_popout:function(){u.client.proxy&&u.client.proxy.end_popout(olark._.identityManager.getConversationId())},whenNicknameAndPresenceAreAllowed:function(e){olark("api.visitor.getDetails",function(t){var n=void 0!=t.secondsSinceLastMessage||void 0!=t.secondsSinceLastNotificationToOperator;if(n)e();else if("chatting"==u.config.vars.show_in_buddy_list);else{var i=u.client.conversation_has_slot,o=u.client.site_is_online;i&&o&&e()}})}},u.client.map={command:"c",callback:"cb",group_id:"g",group_idstring:"g",conversation_id:"i",script_id:"j",site_idstring:"s",sequence_id:"q",status_message:"m",status_state:"p",current_url:"u",visitor_id:"v",referrer_url:"r"},u.client.jsonproxy.prototype.__build_nrpc_arguments=function(e){var t="";e.command&&(t+="&c="+encodeURIComponent(e.command+"")),e.sequence_id&&(t+="&q="+e.sequence_id);var n=u.client.map,i=[];for(var o in e)if(i.push(o),e.hasOwnProperty(o)&&e[o]&&"append_settings"!=o&&"throttle"!=o&&"sequence_id"!=o&&"command"!=o){var a=encodeURIComponent(e[o]+"");n[o]&&(o=n[o]),t+="&"+o+"="+a}return""==t&&(t="?command=invalid_buffer&buffer_is_empty="+escape(i.join(","))),t},u.client.jsonproxy.prototype.do_nrpc_call=function(e){var t=this,n=u.client.pollingmanager.getNextPollTime();n&&(e.next_poll_time=n);var i=u._pollevents_errors;i&&(e.num_retries=u._pollevents_errors),t.do_raw_nrpc_call(e)},u.client.jsonproxy.prototype.do_raw_nrpc_call=function(e){var t=e.command,n=e.append_settings,i="",o=hbl_ext;if(olark.__legacy_shim.allowEndConversation&&(e.end_conversation=1,olark._.identityManager.isNewConversation()&&"create"===t&&(e.is_new_conversation=1)),e.visitor_id=e.visitor_id||olark._.identityManager.getVisitorId(),("create"==t||"sendmessage"==t)&&(u.util.last_js_id=1),u.util.last_js_id+=1,u.util.last_js_id<1900){u.util.last_js_pollid+=1,this.rnd&&(i=parseInt(10*Math.random()).toString()+"-");var a="/"+t.charAt(0)+"?";"geolocation"==t&&p?(i="start-"+parseInt(3*Math.random()).toString()+"."+hbl_hostname,i+=a,o="https"):i+=this.uri+a;var r=parseInt(1e4*Math.random())+"."+ +new Date%1e5+"."+u.util.last_js_pollid;e.sequence_id=r,e.version=v,e.pretty=!0,e.throw_exceptions=window.olark.__buildinfo.strict?!0:!1,i+=this.__build_nrpc_arguments(e),u.util.append_script(window,document,{scriptid:u.util.generate_script_js_pollid(),url:o+"://"+i,tries:n.tries,timeout:n.timeout,cache:!1,error_callback:n.error_callback})}},u.client.jsonproxy.prototype.begin=function(e,t,n,i,o){(e?1:0)||olark._.hlog("missing sid #no_begin_wcsid_input"),(t?1:0)||olark._.hlog("missing hblid #no_begin_hblid_input");var a="ALL",r=olark.__legacy_shim.currentGroupIdstring||a,s=this,_=function(){s.do_nrpc_call({command:"create",conversation_id:e,visitor_id:t,site_idstring:n,current_url:i,referrer_url:o,callback:"hbl.client.callbacks.begin",group_id:r,throttle:!1,append_settings:{tries:3,timeout:2e4}})},l=function(e){e.status?_():u.client.callbacks.begin(e)},c=olark._.nrpcPrecache;c?c.response?l(c.response):c.responseCallback=l:_()},u.client.jsonproxy.prototype.sendmessage=function(e,t,n,i){var o=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendmessage",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),body:t,no_history:!n,notification:i,callback:"hbl.client.callbacks.sendmessage",group_idstring:o,version:v,append_settings:{tries:3,timeout:45e3}})},u.client.jsonproxy.prototype.sendofflinemessage=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring,o={command:"sendofflinemessage",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),body:t,callback:"hbl.client.noop",group_idstring:i,version:v,append_settings:{tries:3,timeout:45e3}};for(var a in n)n.hasOwnProperty(a)&&(o["form_"+a]=n[a]);this.do_nrpc_call(o)},u.client.jsonproxy.prototype.sendcommand=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring;if("disconnectchat"==t)this.do_nrpc_call({command:"destroy",conversation_id:e,callback:"hbl.client.noop",group_idstring:i,append_settings:{tries:3,timeout:45e3}});else if("send_compose_state"==t)this.do_nrpc_call({command:"sendcomposing",conversation_id:e,callback:"hbl.client.noop",state:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}});else if("return_long_poll_now"==t)this.do_nrpc_call({command:"finishlongpoll",conversation_id:e,callback:"hbl.client.noop",state:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}});else{if("unlock_operator"!=t)throw"Unsupported command: "+t;this.do_nrpc_call({command:"sendunlock",conversation_id:e,callback:"hbl.client.noop",message:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}})}},u.client.jsonproxy.prototype.setnickname=function(e,t){var n=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendnickname",conversation_id:e,callback:"hbl.client.noop",nickname:t,group_idstring:n,append_settings:{tries:3,timeout:45e3}})},u.client.jsonproxy.prototype.noop=function(e,t){this.do_nrpc_call({command:"noop",conversation_id:e,visitor_id:t,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})},u.client.jsonproxy.prototype.geolocation=function(e,t){this.do_nrpc_call({command:"geolocation",conversation_id:e,visitor_id:t,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.geolocation_ready",append_settings:{tries:3,timeout:45e3}})},u.client.jsonproxy.prototype.sendpresence=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendpresence",conversation_id:e,callback:"hbl.client.noop",status_message:t,status_state:n,group_idstring:i,append_settings:{tries:5,timeout:45e3}})},u._exponential_backoff_pollevents_error_handler=function(){var e=1e3*u._pollevents_errors*u._pollevents_errors,t=45e3;e>t&&(e=t),setTimeout(function(){u.client.pollingmanager.finishLastPoll(),u.client.pollingmanager.startNextPollNow()},e),u._pollevents_errors+=1},u.client.jsonproxy.prototype.getmessages=function(e,t){u.client.the_count++,u.client.last_getmessages=new Date,this.do_nrpc_call({command:"pollevents",throttle:!1,conversation_id:e,callback:"hbl.client.callbacks.pollevents",timeout:29,after:t,append_settings:{timeout:4e4,error_callback:u._exponential_backoff_pollevents_error_handler}})},u.client.jsonproxy.prototype.pollmessages=function(e,t){u.client.the_count++,this.do_nrpc_call({command:"pollevents",throttle:!1,conversation_id:e,callback:"hbl.client.callbacks.pollevents",timeout:0,after:t,append_settings:{timeout:1e4,error_callback:u._exponential_backoff_pollevents_error_handler}})},u.client.jsonproxy.prototype.popout=function(e){this.do_nrpc_call({command:"popout",conversation_id:e,callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})},u.client.jsonproxy.prototype.end_popout=function(e){this.do_nrpc_call({command:"endpopout",conversation_id:e,callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})},u.client.jsonproxy.prototype.log_event=function(e,t,n){this.do_nrpc_call({command:"logevent",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.noop",event_type:t,body:n,append_settings:{tries:3,timeout:45e3}})},u._hwindow=function(e,t,n){return this.config=t,this.client=e,this.handlers=!1,this.theme=void 0,this.eventmgr=n,this.loaded=!1,this.expanded_textbox=!1,this.has_typed=!1,this.offline_msg_started=!1,this.offline_msg_visible=!1,this.pop_out=!1,this.setTheme=function(e){this.theme&&this.theme.remove(),this.theme=e,this.theme.build(this.config,this.client,this.config.vars.start_visible,this.config.vars.start_habla_window_visible),this.check_theme_for_link_div(),u.util.pluginloader(this.config,this.client,this)},this.check_theme_for_link_div=function(){this.theme&&(this.config.vars.hkey&&(this.config.vars.special_link=u.util.decode_base64(this.config.vars.hkey).replace("href",'style="'+this.config.vars._habla_link_a+'" href')),(!this.theme.habla_link_div||this.theme.habla_link_div.style&&"none"==this.theme.habla_link_div.style.display||this.theme.habla_link_div.innerHTML.indexOf("http://hab.la")<0&&this.theme.habla_link_div.innerHTML.indexOf("http://www.olark.com")<0||!this.theme.habla_link_div.parentNode)&&(this.theme.habla_link_div=document.createElement("div"),this.config.vars.force_name_habla_link_div&&this.theme.habla_link_div.setAttribute("id","habla_link_div"),this.config.vars.special_link&&(this.theme.habla_link_div.innerHTML=this.config.vars.special_link.replace("hblink1","hblink9")),this.theme.config.vars.append_middle?this.theme.habla_middle_div.appendChild(this.theme.habla_link_div):this.theme.habla_expanded_div.appendChild(this.theme.habla_link_div)),document.getElementById("hblink9")||(this.theme.habla_link_div.innerHTML=u.util.decode_base64("RnJlZSA8YSBocmVmPSJodHRwOi8vd3d3Lm9sYXJrLmNvbS8/ZnJlZV9saXZlaGVscCIgaWQ9ImhibGluazkiIHRhcmdldD0iX2JsYW5rIj5PbGFyazwvYT4gbGl2ZWhlbHAgfCA8YSBocmVmPSJodHRwOi8vd3d3Lm9sYXJrLmNvbS8/bW9yZSIgaWQ9ImhibGluazk5IiB0YXJnZXQ9Il9ibGFuayI+R2V0IGl0ITwvYT48IS0taHR0cDovL3d3dy5vbGFyay5jb20tLT4=")),this.set_link(document.getElementById("hblink9")),this.set_link(document.getElementById("hblink99")),this.theme.habla_link_div.setAttribute("style",this.config.vars._habla_link_div),this.theme.habla_link_div.style.clear="both",document.getElementById("hblink9")&&document.getElementById("hblink9").setAttribute("style",this.config.vars._habla_link_a),document.getElementById("hblink99")&&document.getElementById("hblink99").setAttribute("style",this.config.vars._habla_link_a))},this.set_link=function(e){if(e&&e.href){var t=e.href.split(/[\?\#]/);e.href=t[0]+"?rid="+olark._.identityManager.getSiteId()+"&"+t[1],e.href=e.href.replace("olark.com/","olark.com/welcome/"),e.target="_blank",e.rel="nofollow";var n="expanded"==window.olark.__legacy_shim.box_state?!0:!1;olark("api.box.onExpand",function(){setTimeout(function(){n=!0},2e3)}),e.onclick=function(){return n?!0:!1}}},this.register_handlers=function(){this.handlers||(this.handlers=!0,this.eventmgr.register("window_focus",this.events.onWindowFocus,0),this.eventmgr.register("window_click",this.events.onWindowFocus,0),this.eventmgr.register("window_submit",this.events.onWindowSubmit,0),this.eventmgr.register("window_form_submit",this.events.onWindowFormSubmit,0),this.eventmgr.register("window_topbar_clicked",this.events.topBarClicked,0),this.eventmgr.register("habla_closebutton_a_onclick",this.events.closeClicked,0),this.eventmgr.register("habla_sizebutton_a_onclick",this.events.topBarClicked,0),this.eventmgr.register("habla_oplink_a_onclick",this.events.topBarClicked,0),this.eventmgr.register("operator_status_change",this.events.onOpstatusStatusChanged,0),this.eventmgr.register("receive_message",this.events.onChatUpdated,0),this.eventmgr.register("send_message",this.events.onChatUpdated,0),this.eventmgr.register("chat_started",this.events.onChatStarted,0),this.eventmgr.register("theme_loaded",this.events.onThemeLoaded,0))},this.get_operator_state=function(){return this.config.vars.local_mode?this.config.vars.local_operator_state||"available":this.opavailable?this.opbusy?this.config.vars.show_busy_message?"busy":"available":"chat"!=this.opstatus&&"available"!=this.opstatus&&this.opstatus&&""!=this.opstatus?"notavailable":"available":"notavailable"},this.determine_window_status=function(e){var t={};if(window.olark&&window.olark.__legacy_shim){t=window.olark.__legacy_shim,null!=t.box_state&&(e.box_open="expanded"==t.box_state?!0:!1),null!=t.box_visible&&(e.window.theme.visible=t.box_visible?!0:!1,e.box_visible=t.box_visible?!0:!1);var n=e.window.config.vars.close_hides_window;n&&"closed"==t.box_state&&(e.box_visible=!1),e.window.theme.state=t.box_state||e.window.theme.state}if(e.pop_out&&!e.window.config.vars.is_popup)return!1;if(e.pop_out_change&&!e.pop_out)return!0;if(e.chatting||u.client.buffer.length>0&&!e.window.config.vars.close_hides_window)return!0;if(e.box_open||"expanded"==e.window.theme.state)return!0;if(e.window.config.vars.start_hidden&&!e.window.theme.visible)return!1;if(e.window.config.vars.close_hides_window&&!e.box_visible)return!1;if(e.window.config.vars.hide_not_available&&!e.opavailable)return!1;var i=e.opavailable&&"chat"!=e.opstatus&&void 0!=e.opstatus&&""!=e.opstatus&&"available"!=e.opstatus;return e.window.config.vars.hide_not_available&&i?!1:!0},this.setInputBox=function(e,t,n){this.theme.setInputBox(e,t,n)},this.setWindowText=function(){var e=this.get_operator_state();if(("notavailable"==e||this.offline_msg_started)&&this.config.vars.offline_msg_mode)return this.setHeader(this.config.vars.not_available_text),void this.setOfflineWindow(this.config.vars.offline_message||" ");if(this.setOfflineWindow(!1),"notavailable"==e)return this.setHeader(this.config.vars.not_available_text),void(u.client.buffer.length<1&&this.setBody(this.config.vars.offline_message));if("away"==e)return this.config.vars.show_away_as_header&&this.opmessage?this.setHeader(this.opmessage,!0):this.setHeader(this.config.vars.busy_text||this.config.vars.away_text),void(0==this.client.buffer.length&&this.setBody(this.config.vars.away_message||this.config.vars.busy_message||this.config.vars.offline_message));if("busy"==e)return this.setHeader(this.config.vars.busy_text),void this.setBody(this.config.vars.busy_message);var t=new c({client:u.client}),n=t.needsPrechat()&&!this.theme.pre_chat_sent&&this.config.vars.show_pre_chat;n&&this.setShowPreChat(!0),t.didBegin()?this.setHeader(this.config.vars.in_chat_text):(n||this.setBody(this.config.vars.welcome_msg),this.setHeader(this.config.vars.before_chat_text))},this.appendFromBuffer=function(e){if(!this.offline_msg_started)if(this.theme)for(var t=0;t<e.length;t++)e[t]&&this.theme.appendNiceMessage(e[t][0],e[t][1],!0);else u.hwindow_last_buffer=e,this.eventmgr.register("theme_loaded",function(e){e.window.appendFromBuffer(u.hwindow_last_buffer),u.hwindow_last_buffer=""},100)},this.setHeader=function(e,t){void 0!=e&&(t&&(e=".."+e.substr(0,10)+".."),this.theme.setHeader(e))},this.events={onOpstatusStatusChanged:function(e){e.window.opstatus=e.status,e.window.opmessage=e.message,e.window.opbusy=e.busy,e.window.pop_out=e.pop_out,e.window.opavailable||!e.available||e.window.config.vars.offline_msg_mode&&e.window.offline_msg_mode||e.window.reloadBuffer(),e.window.opavailable=e.available,e.window.setWindowText();var t=e.window.determine_window_status(e),n=window.olark&&window.olark.__legacy_shim,i=!e.pop_out&&e.pop_out_change;if(n&&i&&window.olark.__legacy_shim.populate_message_history_from_chat_api){var o=document.getElementById("habla_conversation_div");o.innerHTML="",window.olark.__legacy_shim.populate_message_history_from_chat_api()}t||(e.available||!e.window.config.vars.hide_not_available)&&e.window.theme.visible?e.window.show():e.window.hide(1)},onChatUpdated:function(e){e.window.appendFromBuffer(e.msg)},onChatStarted:function(e){if(e.window.opavailable=e.opavailable,e.window.opbusy=e.busy,null==e.nick||e.nick.match(/webuser\d\d/)||e.window.setnickname(e.nick,1),u.chat_started_arg=e,e.window.theme)e.window.theme.build(e.window.config,e.window.client,!0),e.window.events.onThemeLoaded(e);else if(e.window.config.vars.theme_obj)e.window.setTheme(t.vars.theme_obj),e.window.events.onThemeLoaded(e);else{u.chat_started_arg=e;var n="";e.window.config.vars.theme_path&&(n="http://"+hbl_static_hostname+"/"+e.window.config.vars.theme_path),e.window.config.vars.theme_url&&(n=e.window.config.vars.theme_url),u.util.simple_load_js_async(n)}u.client.eventmgr.handle("chat_loaded",e)},onThemeLoaded:function(e){e.window.theme||e.window.setTheme(e.obj),u.util.BrowserDetect.use_position_absolute_on_ie&&u.config.render_ie_hacks();var t=u.chat_started_arg,n=t.window.determine_window_status(t);n?(t.window.show(1),t.pop_out&&!t.window.config.vars.is_popup||!(t.box_open||t.window.config.vars.start_expanded||window.olark&&window.olark.__legacy_shim&&"expanded"==olark.__legacy_shim.box_state)||t.window.expand()):t.window.hide(1),t.habla_message&&(t.window.config.vars.offline_message=t.habla_message.msg,t.habla_message.header&&(t.window.config.vars.not_available_text=t.habla_message.header,t.window.setHeader(habla_window.config.vars.not_available_text)),t.window.show(1),t.habla_message.expand&&t.window.expand(),t.window.theme.habla_conversation_div.scrollTop=0)},onWindowFocus:function(e){e.window.normal(),e.window.setWindowText()},topBarClicked:function(e){return e.window.normal(),e.window.expanded?(e.window.compress(),u.client.eventmgr.handle("window_compressed")):(e.window.expand(),u.client.eventmgr.handle("window_expanded")),!1},closeClicked:function(e){return e.window.close(),u.client.eventmgr.handle("window_closed"),!1},onWindowFormSubmit:function(e){e.window.send()},onWindowSubmit:function(e){e.window.send()}},this.send_pipeline=new u.util.pipeline(this),this.send_pipeline.add(u.pipelines.nickname,999),this},u._hwindow.prototype.setnickname=function(e,t){void 0==t&&this.client.setnickname(e)},u._hwindow.prototype.show=function(e){"closed"==this.theme.state&&this.theme.__set_css_window_state("compressed"),this.theme.show(),this.visible=!0,e||this.config.vars.disable_rpc_state||this.client.sendshow(),u.eventmgr.handle("habla_window_changed",{type:"show"})},u._hwindow.prototype.popout=function(e){var t=window.open(hblPopupURL+"?_ok="+olark._.identityManager.getSiteId()+"&wcsid="+olark._.identityManager.getConversationId()+"&_oklv="+olark._.identityManager.getOklvValueForPopout()+"&hblid="+olark._.identityManager.getVisitorId()+"&_okgid="+olark._.cookieManager.get("_okgid")+"&olfsk="+olark._.cookieManager.get("olfsk")+"&host="+window.location.host,"habla_popout","width=300,height=400,scrollbars=no,location=no,status=no,menubar=no,toolbar=no,directories=no,resizable=yes");t&&(e||this.client.popout(),this.pop_out=!0,u.client.pop_out=!0,t.focus(),this.hide(e),u.eventmgr.handle("habla_window_changed",{type:"popout"}))},u._hwindow.prototype.end_popout=function(e){this.pop_out=!1,e||this.client.end_popout(),u.eventmgr.handle("habla_window_changed",{type:"endpop_out"})},u._hwindow.prototype.close=function(e){this.theme.close(),e||this.config.vars.disable_rpc_state||this.client.sendend(),this.config.vars.close_hides_window&&this.hide(),u.eventmgr.handle("habla_window_changed",{type:"close"})},u._hwindow.prototype.hide=function(e){this.theme.hide(),this.visible=!1,e||this.config.vars.disable_rpc_state||this.client.sendhide(),u.eventmgr.handle("habla_window_changed",{type:"hide"})},u._hwindow.prototype.setWidth=function(e){this.theme&&this.theme.setWidth(e),u.eventmgr.handle("habla_window_changed",{type:"resize"})},u._hwindow.prototype.setInputHeight=function(e){this.theme.setInputHeight(e),u.eventmgr.handle("habla_window_changed",{type:"resize"})},u._hwindow.prototype.setHeight=function(e){this.theme&&this.theme.setHeight(e),u.eventmgr.handle("habla_window_changed",{type:"resize"})},u._hwindow.prototype.compress=function(){this.expanded=!1,this.theme.compress(),u.util.BrowserDetect.use_position_absolute_on_ie&&this.visible&&window.hbl.__ie6_floating_div_monitor&&window.hbl.__ie6_floating_div_monitor.__move_to_correct_location(),u.eventmgr.handle("habla_window_changed",{type:"compress"}),this.config.vars.disable_rpc_state||this.client.sendcompress()},u._hwindow.prototype.expand=function(){this.expanded=!0,u.util.BrowserDetect.use_position_absolute_on_ie&&"bottom"==this.config.vars.ycorner&&this.theme.setXY(this.theme.habla_window_div.style.left.match(/\d\d*/),this.theme.habla_window_div.style.top.match(/\d\d*/)-this.config.vars.convo_height-this.config.vars.panel_offset),this.theme&&this.theme.expand(),this.config.vars.disable_rpc_state||this.client.sendexpand(),u.eventmgr.handle("habla_window_changed",{type:"expand"})},u._hwindow.prototype.setPosition=function(e){this.theme.setPosition(e)},u._hwindow.prototype.setInline=function(e){this.theme.setInline(e)},u._hwindow.prototype.setMargins=function(e,t,n,i){this.theme.setMargins(e,t,n,i)},u._hwindow.prototype.getHeader=function(){return this.theme.getHeader()},u._hwindow.prototype.reloadBuffer=function(){this.theme.setBody(""),this.appendFromBuffer(this.client.buffer)},u._hwindow.prototype.setBody=function(e){this.setOfflineWindow(!1),this.theme.setBody(e||"")},u._hwindow.prototype.setOfflineWindow=function(e){this.theme.setOfflineWindow(e)},u._hwindow.prototype.setShowPreChat=function(e){this.theme.setShowPreChat(e)},u._hwindow.prototype.highlight=function(){this.theme.highlight()},u._hwindow.prototype.normal=function(){this.theme.normal()},u._hwindow.prototype.send=function(){var e=this.theme.getMessageInputField(),t=this.theme.getMessageInputFieldValue();if(t==this.config.vars.say_text)this.theme.setMessageInputFieldValue("");else if(t&&t.length>0)try{var n=t;this.theme.setMessageInputFieldValue(""),n=this.send_pipeline.run(n),n&&this.client.sendmessage(n),this.normal()}catch(i){throw i}return this.config.vars.disableFocus||(e.focus(),setTimeout(function(){habla_window.theme.getMessageInputField().focus()},10)),!1},u.pipelines.nickname=function(e,t){if("/nick "==e.substr(0,6)){var n=e.substr(6);return void t.client.setnickname(n)}return e},u.pipelines.push_url=function(e){var t=e;if(e=e[1],"!push "==e.substr(0,6)){var n="";if(e=e.replace(/&lt;/gi,"["),e=e.replace(/\/*&gt;/gi,"]"),e.match(/<a/)){var i=e.match(/src\s*=\s*"*([^\"]+)\"*/i);i.length>1&&(n=i[1])}else if(e.match(/\[(http[^\]]+)\s*\]/i)){var o=e.match(/\[(http[^\]]+)\]/i);n=o[1]}else n=e.substr(6,e.length-6);if(n=n.split(" ")[0],n=n.split("%20")[0],""!=n){var a=u.util.getCommonUrlFormatter(),r=a.getSmartUrl(n);return void setTimeout(function(){window.location=r},0)}}return t},u.client.incoming_pipeline.add(u.pipelines.push_url,999),u.plugins.incoming_notification_vars={},u.plugins.incoming_notification=function(){this.name="incoming_notification",this.load=function(e){var t=this;
u.plugins.incoming_notification_vars.freq=3e3,u.plugins.incoming_notification_vars.flashicon=!1,u.plugins.incoming_notification_vars.flashing=!1,u.plugins.incoming_notification_vars.original_favicon=!1;var n=u.util.find_or_create_el("habla_wcsend_input","textarea");u.plugins.incoming_notification_vars.windowTextCleared=!0,e.hwindow.config.vars.flash_titlebar&&(e.hwindow.eventmgr.register("receive_message",this.onReceiveMessage),e.hwindow.eventmgr.register("send_message",this.onWindowFocus),e.hwindow.eventmgr.register("window_focus",this.onWindowFocus),e.hwindow.eventmgr.register("window_click",this.onWindowFocus)),e.hwindow.config.vars.flash_icons&&(u.plugins.incoming_notification_vars.default_flash_on_icon=e.hwindow.config.vars.default_flash_off_icon,u.oldtitle||(u.oldtitle=/Message Received/i.test(document.title)?"":document.title||""),u.plugins.incoming_notification_vars.originalFavicon||(u.plugins.incoming_notification_vars.originalFavicon=u.plugins.incoming_notification_vars.remove_current_icon(!0)||e.hwindow.config.vars.default_flash_on_icon),u.plugins.incoming_notification_vars.default_flash_off_icon=u.plugins.incoming_notification_vars.originalFavicon,n.onkeypress=function(){t.onWindowFocus({window:e.hwindow}),u.plugins.incoming_notification_vars.windowTextCleared=!0})},this.onReceiveMessage=function(e){var t=e.msg[e.msg.length-1][1];/^\s*!/.test(t)||"remote_update"==e.type&&(e.window.highlight(),u.plugins.incoming_notification_vars.last_msg="",u.client.buffer&&u.client.buffer[u.client.buffer.length-1]&&(u.plugins.incoming_notification_vars.last_msg=u.client.buffer[u.client.buffer.length-1][1].substr(0,10),e.window.setHeader(".."+u.plugins.incoming_notification_vars.last_msg+"..")),u.plugins.incoming_notification_vars.windowTextCleared=!1,u.plugins.incoming_notification_vars.flashOlarkFavicon())},this.onWindowFocus=function(e){if(u.plugins.incoming_notification_vars.resetFavicon(),!u.plugins.incoming_notification_vars.windowTextCleared){e.window.setWindowText(),u.plugins.incoming_notification_vars.windowTextCleared=!0;var t=document.getElementById("habla_topbar_div");t.className=t.className.replace(/habla_topbar_div_highlighted/,"habla_topbar_div_normal")}},u.plugins.incoming_notification_vars.flashOlarkFavicon=function(){document.title="(Message Received: "+u.plugins.incoming_notification_vars.last_msg+") "+u.oldtitle,u.plugins.incoming_notification_vars.set_icon(u.plugins.incoming_notification_vars.default_flash_on_icon);var e=!0;u.plugins.incoming_notification_vars.flashingInterval=setInterval(function(){u.plugins.incoming_notification_vars.set_icon(e?u.plugins.incoming_notification_vars.originalFavicon:u.plugins.incoming_notification_vars.default_flash_on_icon),e=!e},u.plugins.incoming_notification_vars.freq)},u.plugins.incoming_notification_vars.resetFavicon=function(){document.title=u.oldtitle,clearInterval(u.plugins.incoming_notification_vars.flashingInterval);var e=u.plugins.incoming_notification_vars.originalFavicon||"";u.plugins.incoming_notification_vars.remove_current_icon(),u.plugins.incoming_notification_vars.set_icon(e),u.plugins.incoming_notification_vars.flashing=!1},u.plugins.incoming_notification_vars.remove_current_icon=function(e){if(document.getElementsByTagName("head")&&0!=document.getElementsByTagName("head").length){for(var t=document.getElementsByTagName("head")[0].getElementsByTagName("link"),n=0;n<t.length;n++){var i=t[n];if("image/x-icon"==i.type&&/favicon|favico|shortcut|icon|shortcut\s*icon/i.test(i.rel)){var o=i.href;return e||document.getElementsByTagName("head")[0].removeChild(i),o}}return void 0}},u.plugins.incoming_notification_vars.set_icon=function(e){var t=document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=e,u.plugins.incoming_notification_vars.remove_current_icon(),document.getElementsByTagName("head")&&0!=document.getElementsByTagName("head").length&&document.getElementsByTagName("head")[0].appendChild(t)}},u.plugins.messages_received=0,u.plugins.expand_on_receive_message=function(){this.name="expand_on_receive_message",this.load=function(e){e.hwindow.eventmgr.register("receive_message",this.onReceiveMessage,-1)},this.onReceiveMessage=function(e){var t=e.msg[e.msg.length-1][1];/^\s*!/.test(t)||(u.plugins.messages_received+=1,e.window.pop_out||("start"==e.type||e.window.config.vars.expandOnFirstMessageReceived&&!e.window.config.vars.expandOnMessageReceived&&1!=u.plugins.messages_received?"start"!=e.type&&e.window.theme&&"closed"==e.window.theme.state&&(e.window.theme.state="compressed",e.window.show()):(u.client.eventmgr.handle("window_expanded"),e.window.expand(),e.window.show())))}},u.plugins.away_div_handler=function(){this.name="away_div_handler",this.load=function(e){u.util.hide_div("habla_unavailable_div"),u.util.hide_div("habla_available_div"),u.util.show_div("habla_loading_div",e.hwindow.config.vars.habla_special_div_show_type)||u.util.show_div("habla_unavailable_div",e.hwindow.config.vars.habla_special_div_show_type),(void 0!=document.getElementById("habla_available_div")||void 0!=document.getElementById("habla_unavailable_div"))&&e.hwindow.eventmgr.register("operator_status_change",this.onOperatorStatusChange)},this.onOperatorStatusChange=function(e){{var t=e.available,n=e.status;e.message}!t||n&&"chat"!=n&&e.window.config.vars.hide_when_away?(u.util.hide_div("habla_available_div"),u.util.show_div("habla_unavailable_div",e.window.config.vars.habla_special_div_show_type),u.util.hide_div("habla_loading_div")):(u.util.show_div("habla_available_div",e.window.config.vars.habla_special_div_show_type),u.util.hide_div("habla_unavailable_div"),u.util.hide_div("habla_loading_div"))}},u.plugins.auto_initiate=function(){this.load=function(e){e.hwindow.config.vars.auto_initiate_allowed&&e.hwindow.config.vars.auto_initiate&&e.hwindow.eventmgr.register("chat_loaded",this.onChatLoad)},this.onChatLoad=function(e){e.session_start&&!e.opbusy&&e.opavailable&&(habla_window.auto_initiated=!1,setTimeout(function(){if(0==u.client.buffer.length&&u.client.opavailable){habla_window.show(),habla_window.expand(),habla_window.auto_initiated=!0;var t=e.window.config.vars.auto_initiate_message;habla_window.theme.appendNiceMessage(e.window.config.vars.auto_initiate_name,t[Math.floor(Math.random()*t.length)],!0,!1,!0),habla_window.highlight(),u.client.buffer=[" "],habla_window.send_pipeline.add(function(e){return habla_window.auto_initiated&&(u.client.sendmessage(habla_window.config.vars.auto_initiate_response_notify,!0),habla_window.auto_initiated=!1),e},1e4),habla_window.config.vars.auto_initiate_notify&&u.client.sendmessage(habla_window.config.vars.auto_initiate_notify_msg,!0)}},parseInt(1e3*e.window.config.vars.auto_initiate_period)))}},u.plugins.google_translate=function(){this.name="googletranslate",this.load=function(){}},u.plugins.sounds=function(){this.name="sounds",this.load=function(e){1==e.conf.vars.enableSounds&&u.util.simple_load_js_async(e.conf.vars.plugin_path+"contributed/sounds.js")}},u.plugins.smileys=function(){this.name="smileys",this.load=function(e){1==e.conf.vars.enableSmileys&&u.util.simple_load_js_async(e.conf.vars.plugin_path+"contributed/smileys.js")}},u.themes.default_theme=function(){this.appended=!0,this.last_msg=-1,this.visible=!1,this.highlighted=!1,this.state="compressed",this.message_sent=!1,this.offline_window=!1,this.pre_chat_sent=!1,this.ready=!1,this.position="BR",this.build=function(e,t,n){this.client=t,this.config=e,this.set_config(),this.load_styles(),this.div=void 0,this.divid=e.vars.divid,this.build_dom(n),this.set_dom_event_handlers(),this.config.init_from_config(this),this.palette_hack(),this.render_styles(),this.config.vars.disableJSStyles||this.config.vars.no_palette||this.render_palette(),this.set_default_text(),this.register_handlers(),this.ready=!0,this.config.vars.disableJSStyles&&!this.config.vars.start_hidden&&this.show(),u.eventmgr.handle("post_theme_loaded")},this.palette_hack=function(){if(u.need_ugly_backwards_palette_hack){var e={};for(var t in this.config.style_classes_map)if(this.config.style_classes_map.hasOwnProperty(t))for(var n in this.config.style_classes_map[t])if(this.config.style_classes_map[t].hasOwnProperty(n))for(var i in this.config.palette)this.config.palette.hasOwnProperty(i)&&"hbl_pal_"+i==this.config.style_classes_map[t][n]&&(this.config.style_classes_map[t][n]="hbl_pal_"+i+"_local",e[i+"_local"]=this.config.palette[i]);this.config.palette=e}},this.set_config=function(){var e=new u.hconfig;e.style_classes={};var t="habla_button",n="habla_button_a_normal",i="habla_wcsend_input_pre",o="habla_wcsend_field",a="hbl_pal_main_font_size",r="hbl_pal_main_font_family",s="hbl_pal_header_font_size",_="hbl_pal_control_border",l="habla_pre_chat_form_field",c="hbl_pal_button_bg",d="habla_wcsend_input_normal",h="hbl_pal_input_font_size";e.style_classes_map={habla_window_div:["habla_window_div_position","habla_window_div_base","hbl_pal_main_width"],habla_closebutton_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_sizebutton_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_popout_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_end_popout_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_button_normal:[t,n,s,c,"hbl_pal_button_fg"],habla_button_highlighted:[t,"habla_button_a_highlighted","hbl_pal_header_font_size","hbl_pal_button_bg_highlight","hbl_pal_button_fg_highlight"],habla_button_hover:[t,"habla_button_a_hover","hbl_pal_header_font_size","hbl_pal_button_bg_hover","hbl_pal_button_fg_hover"],habla_panel_div:["habla_panel_border","hbl_pal_main_bg","hbl_pal_panel_border",r,a],habla_oplink_a:["habla_oplink_a_normal","hbl_pal_header_font_size","hbl_pal_title_fg"],habla_oplink_hover:["habla_oplink_a_hover","hbl_pal_header_font_size","hbl_pal_title_fg"],habla_wcsend_input_pre:[o,i,d,"hbl_pal_input_pre_fg",r,h,_],habla_wcsend_input_post:[o,"habla_wcsend_input_post",d,"hbl_pal_main_fg",r,h],habla_wcsend_input:[o,i,d,_,r,h],habla_wcsend_input_highlighted:[o,i,"habla_wcsend_input_highlighted","hbl_pal_control_highlight_border",r,h],habla_name_input:[o,i,d,r,_,h],habla_offline_email_input:[o,i,d,r,_,h],habla_offline_phone_input:[o,i,d,r,_,h],habla_offline_body_input:[i,d,r,_,h],habla_offline_clear_div:["clear_style"],habla_chatform_form:["habla_chatform_form"],habla_input_div:["habla_input_div"],habla_pre_chat_email_input:[l,o,i,d,r,_,h],habla_pre_chat_name_input:[l,o,i,d,r,_,h],habla_pre_chat_phone_input:[l,o,i,d,r,_,h],habla_offline_message_sent_div:["hbl_panel","habla_offline_message_sent_div","hbl_pal_main_height",_,"hbl_pal_main_fg"],habla_pre_chat_div:["hbl_panel","habla_pre_chat_div","hbl_pal_main_height","hbl_pal_main_fg"],habla_offline_message_div:["hbl_panel","habla_offline_message_div",_,"hbl_pal_main_fg"],habla_conversation_div:["hbl_panel","habla_conversation_div","hbl_pal_main_height",_,"hbl_pal_main_fg","hbl_pal_main_bg"],habla_say_text_span:["habla_say_text_span","hbl_pal_main_fg"],habla_submit_button:["habla_submit_button"],habla_offline_submit_input:["habla_offline_submit_input","hbl_pal_offline_submit_fg",_,"hbl_pal_offline_submit_bg"],habla_pre_chat_submit_input:[l,"habla_offline_submit_input","hbl_pal_offline_submit_fg",_,"hbl_pal_offline_submit_bg"],habla_offline_error_span:["habla_offline_error_span"],habla_pre_chat_clear_div:["clear_style"],habla_conversation_p_item:["habla_conversation_p_item","hbl_pal_main_fg"],habla_conversation_person1:["habla_conversation_person1","hbl_pal_local_fg"],habla_conversation_person2:["habla_conversation_person2","hbl_pal_remote_fg"],habla_conversation_text_span:["habla_conversation_text_span","hbl_pal_main_fg"],habla_conversation_notification_nickname:["habla_conversation_person2","hbl_pal_remote_fg","habla_conversation_notification_nickname"],habla_conversation_notification_text_span:["habla_conversation_text_span","hbl_pal_main_fg","habla_conversation_notification"],habla_topbar_div_compressed:["habla_topbar_div_normal","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_compressed"],habla_topbar_div:["habla_topbar_div_normal","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_expanded"],habla_topbar_div_highlighted:["habla_topbar_div_highlighted","hbl_pal_title_fg_highlight","hbl_pal_title_bg_highlight","habla_topbar_div_expanded"]},e.vars={habla_sizebutton_text_expanded:"_",habla_sizebutton_text_compressed:"^",habla_closebutton_text:"x",habla_popout_text:">",habla_end_popout_text:"&lt;&lt;",_habla_link_div:"padding: 3px 0 5px 0 !important; font-family: helvetica, sans-serif; text-align: center; text-transform: uppercase; font-size: 9px; letter-spacing: 2px; font-weight: bold; color: #aaa !important;",_habla_link_a:"font-family: helvetica, sans-serif; text-transform: uppercase; font-size: 9px !important; letter-spacing: 2px; font-weight: bold; color: #e75917 !important;"},this.config.merge(e);var p=new u.hconfig;p.load_defaults(),this.config.merge(p),u.client.pollingmanager.setLongPoll(!this.config.vars.poll),this.config.remap_palette(),this.config.remap_palette(),this.config.vars.right_to_left&&(this.config.vars.local_user_display_name="&larr;"),this.config.vars.enable_buttons&&(this.config.style_classes_map.habla_topbar_div=["habla_topbar_div_normal","habla_topbar_clickable","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_expanded"]),this.config.vars.corner_position&&(this.config.vars.corner_position=this.__getAdjustedPosition(this.config.vars.corner_position))},this.build_dom=function(e,t){document.getElementById(this.divid)&&(this.appended=!1),this.habla_container=u.util.find_or_create_div(this.divid,void 0==this.config.vars.not_append?u.util.get_body():void 0),this.habla_container.id="habla_beta_container_do_not_rely_on_div_classes_or_names",this.habla_container.className=this.__get_browser_class()+" "+this.__get_mobile_class()+" "+("BackCompat"==document.compatMode?"olrk-quirks":"olrk-noquirks");var n=u.util.find_or_create_div("hbl_operator_state_div",this.habla_container);n.className="olrk-unknown",olark("api.chat.onOperatorsAvailable",function(){n.className="olrk-available"}),olark("api.chat.onOperatorsAway",function(){n.className="olrk-away"});var i=u.util.find_or_create_div("hbl_region",n);i.className=this.config.vars.right_to_left?"olrk-rtl":"olrk-normal",this.window_state_div=u.util.find_or_create_div("habla_window_state_div",i),this.window_state_div.className=this.config.vars.show_end_popout?"olrk-state-popout":" olrk-state-compressed",this.habla_window_div=u.util.find_or_create_div(this.divid,this.window_state_div),t||u.util.hide_div(this.habla_window_div);var o=this.config.vars.corner_position&&this.config.vars.corner_position.match(/B/);o&&(this.habla_compressed_div=u.util.find_or_create_div("habla_compressed_div",this.habla_window_div)),this.habla_panel_div=u.util.find_or_create_div("habla_panel_div",this.habla_window_div),this.habla_both_div=u.util.find_or_create_div("habla_both_div",this.habla_panel_div),u.util.hide_div(this.habla_panel_div),this.habla_topbar_div=u.util.find_or_create_div("habla_topbar_div",this.habla_both_div),this.config.vars.add_tab_closure_span&&(this.olrk_tab_closure_span=u.util.find_or_create_el("olrk_tab_closure_span","span"),this.habla_both_div.appendChild(this.olrk_tab_closure_span)),this.habla_expanded_div=u.util.find_or_create_div("habla_expanded_div",this.habla_panel_div),o||(this.habla_compressed_div=u.util.find_or_create_div("habla_compressed_div",this.habla_window_div)),this.config.vars.left_align_widget&&(this.habla_compressed_div.className="olrk-left-align"),this.habla_closed_div=u.util.find_or_create_div("habla_closed_div",this.habla_window_div),e||this.hide(),this.habla_oplink_a=u.util.find_or_create_el("habla_oplink_a","a"),this.config.vars.append_oplink_before_buttons&&this.habla_topbar_div.appendChild(this.habla_oplink_a),this.config.vars.show_end_popout?(this.habla_end_popout_a=u.util.find_or_create_el("habla_end_popout_a","a"),this.habla_topbar_div.appendChild(this.habla_end_popout_a)):this.config.vars.show_popout&&(this.habla_popout_a=u.util.find_or_create_el("habla_popout_a","a"),this.habla_topbar_div.appendChild(this.habla_popout_a)),this.config.vars.enable_buttons&&(this.config.vars.hide_min_max_buttons||(this.habla_closebutton_a=u.util.find_or_create_el("habla_closebutton_a","a"),this.config.vars.close_hides_window&&this.habla_topbar_div.appendChild(this.habla_closebutton_a),this.habla_sizebutton_a=u.util.find_or_create_el("habla_sizebutton_a","a"),this.habla_topbar_div.appendChild(this.habla_sizebutton_a))),this.config.vars.append_oplink_before_buttons||this.habla_topbar_div.appendChild(this.habla_oplink_a);var a=function(e){var t=document.createElement("div");return t.className="hbl_txt_wrapper",t.appendChild(e),t};this.habla_middle_div=u.util.find_or_create_div("habla_middle_div",this.habla_expanded_div);var r=u.util.find_or_create_div("habla_middle_wrapper_div",this.habla_middle_div);this.habla_conversation_div=u.util.find_or_create_div("habla_conversation_div",r),this.habla_offline_message_sent_div=u.util.find_or_create_div("habla_offline_message_sent_div",r),this.habla_offline_message_sent_div.style.display="none",this.habla_offline_message_span=u.util.find_or_create_el("habla_offline_message_span","span"),this.habla_offline_message_div=u.util.find_or_create_div("habla_offline_message_div",r),this.habla_offline_message_div.style.display="none",this.habla_name_input=u.util.find_or_create_el("habla_name_input","textarea"),this.habla_offline_phone_input=u.util.find_or_create_el("habla_offline_phone_input","textarea"),this.habla_offline_email_input=u.util.find_or_create_el("habla_offline_email_input","textarea"),this.habla_offline_body_input=u.util.find_or_create_el("habla_offline_body_input","textarea"),this.habla_offline_clear_div=u.util.find_or_create_el("habla_offline_clear_div","div"),this.habla_offline_submit_input=u.util.find_or_create_el("habla_offline_submit_input","input");try{this.habla_offline_submit_input.setAttribute("type","submit")}catch(s){}this.habla_offline_error_span=u.util.find_or_create_el("habla_offline_error_span","span"),this.habla_offline_message_div.appendChild(this.habla_offline_message_span),this.habla_offline_message_div.appendChild(a(this.habla_name_input)),this.habla_offline_message_div.appendChild(a(this.habla_offline_email_input)),u.config.vars.require_offline_phone>0&&this.habla_offline_message_div.appendChild(a(this.habla_offline_phone_input)),this.habla_offline_message_div.appendChild(a(this.habla_offline_body_input)),u.config.vars.disable_extra_br||this.habla_offline_message_div.appendChild(u.util.find_or_create_el("habla_br","br")),this.habla_offline_message_div.appendChild(this.habla_offline_error_span),this.habla_offline_message_div.appendChild(this.habla_offline_submit_input),this.habla_offline_message_div.appendChild(this.habla_offline_clear_div),this.habla_pre_chat_span=u.util.find_or_create_el("habla_pre_chat_span","span"),this.habla_pre_chat_div=u.util.find_or_create_div("habla_pre_chat_div",r),this.habla_pre_chat_div.style.display="none",this.habla_pre_chat_name_input=u.util.find_or_create_el("habla_pre_chat_name_input","textarea"),this.habla_pre_chat_clear_div=u.util.find_or_create_el("habla_pre_chat_clear_div","div"),this.habla_pre_chat_email_input=u.util.find_or_create_el("habla_pre_chat_email_input","textarea"),this.habla_pre_chat_phone_input=u.util.find_or_create_el("habla_pre_chat_phone_input","textarea"),this.habla_pre_chat_submit_input=u.util.find_or_create_el("habla_pre_chat_submit_input","input");try{this.habla_pre_chat_submit_input.setAttribute("type","submit")}catch(s){}if(this.habla_pre_chat_error_span=u.util.find_or_create_el("habla_pre_chat_error_span","span"),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_span),this.habla_pre_chat_div.appendChild(a(this.habla_pre_chat_name_input)),this.habla_pre_chat_div.appendChild(a(this.habla_pre_chat_email_input)),this.habla_pre_chat_div.appendChild(a(this.habla_pre_chat_phone_input)),u.config.vars.disable_extra_br||this.habla_pre_chat_div.appendChild(u.util.find_or_create_el("habla_br_2","br")),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_error_span),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_submit_input),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_clear_div),this.habla_chatform_form=u.util.find_or_create_el("habla_chatform_form","form"),this.habla_chatform_form.setAttribute("action","#"),this.habla_chatform_form.setAttribute("method","GET"),this.habla_chatform_form.setAttribute("autocomplete","off"),this.habla_input_div=u.util.find_or_create_el("habla_input_div","div"),this.habla_wcsend_input=u.util.find_or_create_el("habla_wcsend_input","textarea"),this.habla_wcsend_input.setAttribute("size",this.config.vars.input_box_size),this.habla_input_div.appendChild(a(this.habla_wcsend_input)),u.util.BrowserDetect.need_submit_button){this.habla_submit_button=u.util.find_or_create_el("habla_submit_button","input");try{this.habla_submit_button.setAttribute("type","button")}catch(s){}this.habla_input_div.appendChild(this.habla_submit_button)}this.habla_chatform_form.appendChild(this.habla_input_div),this.habla_middle_div.appendChild(this.habla_chatform_form)},this.set_events=function(e,t){function n(t,n,i){return function(o){var a;return o||(o=window.event),o.target?a=o.target:o.srcElement&&(a=o.srcElement),3==a.nodeType&&(a=a.parentNode),a==e&&(habla_window.eventmgr.handle(t+"_"+n,{target:a,event:o}),i&&(o.cancelBubble=!0,o.stopPropagation))?(o.stopPropagation(),!1):void 0}}"undefined"!=typeof e&&(e.onblur=n(t,"onblur"),e.onfocus=n(t,"onfocus"),e.onclick=n(t,"onclick",!0),e.onmouseover=n(t,"onmouseover"),e.onmouseout=n(t,"onmouseout"))},this.set_dom_event_handlers=function(){this.habla_submit_button&&(this.habla_submit_button.onclick=function(){habla_window.eventmgr.handle("window_form_submit",{event:void 0})}),this.set_events(this.habla_wcsend_input,"habla_wcsend_input",!0),this.set_events(this.habla_name_input,"habla_name_input"),this.set_events(this.habla_offline_email_input,"habla_offline_email_input"),this.set_events(this.habla_offline_phone_input,"habla_offline_phone_input"),this.set_events(this.habla_offline_body_input,"habla_offline_body_input"),this.set_events(this.habla_offline_submit_input,"habla_offline_submit_input"),this.set_events(this.habla_pre_chat_email_input,"habla_pre_chat_email_input"),this.set_events(this.habla_pre_chat_phone_input,"habla_pre_chat_phone_input"),this.set_events(this.habla_pre_chat_name_input,"habla_pre_chat_name_input"),this.set_events(this.habla_pre_chat_submit_input,"habla_pre_chat_submit_input"),this.habla_conversation_div.onclick=function(){return habla_window.eventmgr.handle("habla_conversation_div_onclick")},this.habla_chatform_form.onfocus=function(){habla_window.eventmgr.handle("habla_chatform_form_onfocus")},this.habla_chatform_form.onsubmit=function(e){return habla_window.eventmgr.handle("window_form_submit",{event:e}),!1},this.habla_pre_chat_phone_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_pre_chat_email_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_pre_chat_name_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_wcsend_input.onkeydown=function(e){if(e||(e=window.event),function(t){function n(e){olark.__legacy_shim.disableComposing||u.client.chatting&&u.client.sendcommand("send_compose_state",e)}function i(){t.visitorHasStartedTyping||(t.visitorHasStartedTyping=!0,n(_.COMPOSING))}function o(){clearTimeout(t.visitorHasPausedTyping),t.visitorHasPausedTyping=setTimeout(function(){a(),n(_.PAUSED)},l)}function a(){clearTimeout(t.visitorHasPausedTyping),n(_.ACTIVE),t.visitorHasStartedTyping=!1}function r(){a()}function s(){""==habla_window.theme.habla_wcsend_input.value?a():(i(),o())}var _={ACTIVE:"active",INACTIVE:"inactive",COMPOSING:"composing",PAUSED:"paused"},l=3e3;switch(t.visitorHasStartedTyping=t.visitorHasStartedTyping||!1,t.visitorHasPausedTyping=t.visitorHasPausedTyping||-1,e.keyCode){case 10:case 13:r();break;default:s()}}(this),!habla_window.theme.habla_wcsend_input.has_typed)return 13!=e.keyCode&&10!=e.keyCode?habla_window.setInputBox(habla_window.theme.habla_wcsend_input,String.fromCharCode(e.keyCode),"highlight"):habla_window.setInputBox(habla_window.theme.habla_wcsend_input,"","highlight"),habla_window.theme.habla_wcsend_input.has_typed=!0,!1;if(function(){function e(e,n){function o(){i=!1}if(i)return!1;var a=n.parentNode||document.body||document.documentElement;i=!0,setTimeout(o,600),"undefined"==typeof t&&(t=document.createElement("olark"),t.style.display="block",t.style.visibility="hidden",t.style.position="absolute",a.appendChild(t));var r=e.replace(/(\<|\>)/g,"^");t.innerHTML=r;var s=parseInt(t.offsetWidth)>=parseInt(n.offsetWidth);return a.removeChild(t),s}var t,n,i=!1;habla_window.config.vars.disable_expand_text_input||habla_window.expanded_textbox||!e(habla_window.theme.getMessageInputFieldValue(),habla_window.theme.getMessageInputField())||(habla_window.expanded_textbox=!0,habla_window.setInputHeight(habla_window.config.vars.resize_input_height),n=habla_window.theme.habla_wcsend_input.parentNode,n.className=n.className.replace("hbl_long_text_entered","")+" hbl_long_text_entered"),!habla_window.config.vars.disable_expand_text_input&&habla_window.expanded_textbox&&habla_window.theme.getMessageInputFieldValue().length<habla_window.config.vars.resize_length&&(habla_window.expanded_textbox=!1,habla_window.setInputHeight(habla_window.config.vars.input_height),n=habla_window.theme.habla_wcsend_input.parentNode,n.className=n.className.replace("hbl_long_text_entered","")+" hbl_long_text_entered")}(),13==e.keyCode||10==e.keyCode){if(""==habla_window.theme.getMessageInputFieldValue().replace(/^\s*|\s*$/g,""))return;return habla_window.expanded_textbox=!1,habla_window.setInputHeight(habla_window.config.vars.input_height),habla_window.eventmgr.handle("window_submit",{event:e}),!1}return!0},this.set_events(this.habla_oplink_a,"habla_oplink_a"),this.config.vars.show_end_popout?this.set_events(this.habla_end_popout_a,"habla_end_popout_a"):this.config.vars.show_popout&&this.set_events(this.habla_popout_a,"habla_popout_a"),this.config.vars.enable_buttons?(this.habla_topbar_div.onclick=function(e){return habla_window.eventmgr.handle("window_topbar_clicked"),e||(e=window.event),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),!1},this.config.vars.hide_min_max_buttons||(this.set_events(this.habla_closebutton_a,"habla_closebutton_a"),this.set_events(this.habla_sizebutton_a,"habla_sizebutton_a"))):this.habla_oplink_a.onclick=function(){return!1}},this.styles=[],this.set_css_style=function(e){if(e){e=e.replace("static.olark.com",hbl_static_hostname);var t=/^\s*http/i.test(e);if(t||(e=hbl_ext+"://"+e),e+="?"+hbl_ext,this.style_div){var n=u.util.find_or_create_el("habla_style_div_alternative","link");n.setAttribute("type","text/css"),n.setAttribute("rel","alternative stylesheet"),u.util.get_head().appendChild(n),n.setAttribute("href",e);var i=document.getElementById("habla_style_div"),o=document.getElementById("habla_style_div_alternative");i.setAttribute("rel","alternative stylesheet"),o.setAttribute("rel","stylesheet"),i.id="habla_style_div_alternative",o.id="habla_style_div"}else this.style_div=u.util.find_or_create_el("habla_style_div","link"),this.style_div.setAttribute("type","text/css"),this.style_div.setAttribute("rel","stylesheet"),u.util.get_head().appendChild(this.style_div),this.style_div.setAttribute("href",e)}},this.load_styles=function(){var e=this.config.vars.legacy_css_for_linkfollow;if(window.__olark_iframe_wrapper&&e)this.set_css_style(e);else if(!this.config.vars.disableJSStyles||this.config.vars.force_olark_css){var t=hbl_static_hostname+"/themes/defaults/base.css?"+hblCacheConstant,n=hbl_static_hostname+"/themes/defaults/base.ie.css?"+hblCacheConstant,i=u.util.BrowserDetect.use_position_absolute_on_ie,o="BackCompat"==document.compatMode?!0:!1,a=hbl_static_hostname+"/themes/azul_popout/preview_theme.css?"+hblCacheConstant,r=void 0;r=window.__olark_popout?this.config.vars.popout_css_url?this.config.vars.popout_css_url:a:this.config.vars.inline_css_url?i?o&&this.config.vars.inline_css_url_quirks?this.config.vars.inline_css_url_quirks:this.config.vars.inline_css_url_ie?this.config.vars.inline_css_url_ie:this.config.vars.inline_css_url:o&&this.config.vars.inline_css_url_quirks?this.config.vars.inline_css_url_quirks:this.config.vars.inline_css_url:i?n:t,this.set_css_style(r)}},this.render_styles=function(){this.config.vars.require_name||(this.habla_pre_chat_name_input.style.display="none",this.habla_pre_chat_name_input.parentNode.style.display="none"),this.config.vars.require_phone||(this.habla_pre_chat_phone_input.style.display="none",this.habla_pre_chat_phone_input.parentNode.style.display="none"),this.config.vars.require_email||(this.habla_pre_chat_email_input.style.display="none",this.habla_pre_chat_email_input.parentNode.style.display="none"),this.config.render_all_styles(this)},this.setInputBox=function(e,t,n,i){e.value=t,this.setInputBoxStyle(e,n,i)},this.setInputBoxStyle=function(e,t,n){n?this.config.set_element_classes(e,"habla_wcsend_input_post"):this.config.set_element_classes(e,"habla_wcsend_input_pre"),"normal"==t?this.config.set_element_classes(e,"habla_wcsend_input"):"highlight"==t&&this.config.set_element_classes(e,"habla_wcsend_input_highlighted")},this.set_default_text=function(){this.set_default_text_event(this.habla_name_input,"habla_name_input",this.config.vars.habla_name_input_text),this.set_default_text_event(this.habla_offline_email_input,"habla_offline_email_input",this.config.vars.habla_offline_email_text),this.set_default_text_event(this.habla_offline_phone_input,"habla_offline_phone_input",this.config.vars.habla_offline_phone_text),this.set_default_text_event(this.habla_offline_body_input,"habla_offline_body_input",this.config.vars.habla_offline_body_text),this.set_default_text_event(this.habla_pre_chat_name_input,"habla_pre_chat_name_input",this.config.vars.habla_name_input_text),this.set_default_text_event(this.habla_pre_chat_email_input,"habla_pre_chat_email_input",this.config.vars.habla_offline_email_text),this.set_default_text_event(this.habla_pre_chat_phone_input,"habla_pre_chat_phone_input",this.config.vars.habla_offline_phone_text),this.set_default_text_event(this.habla_wcsend_input,"habla_wcsend_input",this.config.vars.textbox_message||this.config.vars.say_text),this.habla_offline_submit_input.value=this.config.vars.habla_offline_submit_value,this.set_events(this.habla_wcsend_input,"habla_wcsend_input"),this.set_events(this.habla_offline_email_input,"habla_offline_email_input"),this.set_events(this.habla_offline_phone_input,"habla_offline_phone_input"),this.set_events(this.habla_offline_body_input,"habla_offline_body_input"),this.set_events(this.habla_offline_submit_input,"habla_offline_submit_input"),this.habla_offline_message_sent_div.innerHTML=this.config.vars.habla_offline_sent_text,this.habla_closebutton_a&&(this.habla_closebutton_a.innerHTML=this.config.vars.habla_closebutton_text),this.habla_sizebutton_a&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_compressed),this.habla_popout_a&&(this.habla_popout_a.innerHTML=this.config.vars.habla_popout_text),this.habla_end_popout_a&&(this.habla_end_popout_a.innerHTML=this.config.vars.habla_end_popout_text),this.habla_submit_button&&(this.habla_submit_button.value=this.config.vars.send_text),this.habla_pre_chat_submit_input&&(this.habla_pre_chat_submit_input.value=this.config.vars.pre_chat_submit),this.habla_pre_chat_span.innerHTML=this.config.vars.pre_chat_message,this.setHeader(this.config.vars.check_for_status),1!=window.olark.__legacy_shim.has_messages_in_history&&this.setBody(this.config.vars.welcome_msg)
},this.set_default_text_event=function(e,t,n){var i="placeholder"in e;if(i){this.setInputBox(e,""),e.placeholder=n,e.has_typed=!1,u.eventmgr.register(t+"_onblur",function(e){e.target.has_typed=""==e.target.value?!1:!0});var o=function(e){e.target.has_typed=!0};u.eventmgr.register(t+"_onfocus",o),u.eventmgr.register(t+"_onclick",o)}else this.setInputBox(e,n),e.default_text=n,e.has_typed=!1,u.eventmgr.register(t+"_onblur",function(e){e.window.theme.setInputBoxStyle(e.target,"normal"),""==e.target.value&&(e.target.value=e.target.default_text,e.target.has_typed=!1)},0),u.eventmgr.register(t+"_onclick",function(e){e.target.has_typed||(e.target.has_typed=!0,e.window.setInputBox(e.target,"","highlight")),e.window.theme.setInputBoxStyle(e.target,"highlight")},0),u.eventmgr.register(t+"_onfocus",function(e){e.target.has_typed||(e.target.has_typed=!0,e.window.setInputBox(e.target,"","highlight")),e.window.theme.setInputBoxStyle(e.target,"highlight")},0)},this.set_rollover_event=function(e,t,n,i){e&&(e.on_class=i,e.off_class=n,u.eventmgr.register(t+"_onmouseover",function(e){e.window.config.set_element_classes(e.target,e.target.on_class)},0),u.eventmgr.register(t+"_onmouseout",function(e){e.window.config.set_element_classes(e.target,e.target.off_class)},0),u.eventmgr.register(t+"_onclick",function(e){e.window.config.set_element_classes(e.target,e.target.off_class)},0))},this.register_handlers=function(){this.set_rollover_event(this.habla_popout_a,"habla_popout_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_end_popout_a,"habla_end_popout_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_sizebutton_a,"habla_sizebutton_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_closebutton_a,"habla_closebutton_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_oplink_a,"habla_oplink_a","habla_oplink_a","habla_oplink_hover"),u.eventmgr.register("habla_conversation_div_onclick",function(){habla_window.eventmgr.handle("window_click")},0),u.eventmgr.register("habla_chatform_form_onfocus",function(){habla_window.eventmgr.handle("window_focus")},0),u.eventmgr.register("habla_popout_a_onclick",function(e){e.window.popout()},0),u.eventmgr.register("habla_end_popout_a_onclick",function(e){e.window.end_popout(),setTimeout(function(){window.close()},2)},0),u.eventmgr.register("habla_wcsend_input_onclick",function(e){e.window.eventmgr.handle("window_focus")},0),u.eventmgr.register("habla_pre_chat_submit_input_onclick",function(e){var t=e.window.config,n=e.window.theme.habla_pre_chat_email_input,i=e.window.theme.habla_pre_chat_name_input,o=e.window.theme.habla_pre_chat_phone_input,a=n.value?u.util.strip_whitespace(n.value):void 0,r=i.value?u.util.strip_whitespace(i.value):void 0,s=o.value?u.util.strip_whitespace(o.value):void 0,_=i.has_typed?!0:!1,l=o.has_typed&&u.util.is_valid_phone(s)?!0:!1,c=n.has_typed&&u.util.is_valid_email(a)?!0:!1;if(!c&&_&&u.util.is_valid_email(r)){var d=r;r=a,a=d,c=!0,_=n.has_typed?!0:!1}(t.vars.require_name<=1||_)&&(t.vars.require_phone<=1||l)&&(t.vars.require_email<=1||c)?(e.window.theme.habla_pre_chat_error_span.innerHTML="",window.olark.__legacy_shim.send_prechat_info({name:r,email:u.util.is_valid_email(a)?a:null,phone:u.util.is_valid_phone(s)?s:null}),e.window.theme.pre_chat_sent=!0,e.window.setShowPreChat(!1)):e.window.theme.habla_pre_chat_error_span.innerHTML=e.window.config.vars.pre_chat_error_text},0),u.eventmgr.register("habla_offline_submit_input_onclick",function(e){var t=e.window.theme.habla_offline_body_input,n=e.window.theme.habla_offline_email_input,i=e.window.theme.habla_offline_phone_input,o=e.window.theme.habla_name_input,a=e.window.theme.config.vars.require_offline_phone;if(e.window.theme.message_sent)e.window.theme.setOfflineWindow(e.window.theme.config.vars.habla_offline_sent_text||" ");else{var r=u.util.strip_whitespace(n.value);if(t.has_typed&&n.has_typed&&u.util.is_valid_email(r)&&(1>=a||u.util.is_valid_phone(i.value))){e.window.theme.message_sent=!0;var s=hblPostURL+"?site_id="+olark._.identityManager.getSiteId()+"&"+u.util.urlencode({body:t.value,email:n.value,name:o.value,phone:i.value,location:document.location,referrer:document.referrer});e.window.theme.habla_offline_error_span.innerHTML=e.window.config.vars.sending_text,u.util.load_js_async(s),olark("api.visitor.updateEmailAddress",r),olark("api.visitor.updateFullName",o.value),olark("api.visitor.updatePhoneNumber",i.value),u.client.sendofflinemessage(t.value,{email:r,name:o.value,phone:i.value,location:document.location,referrer:document.referrer}),e.window.eventmgr.handle("offlineMessageToOperator",{body:t.value,nickname:o.value}),e.window.theme.setOfflineWindow(e.window.theme.config.vars.habla_offline_sent_text||" ")}else e.window.theme.habla_offline_error_span.innerHTML=e.window.config.vars.email_body_error_text}},0),u.eventmgr.register("habla_wcsend_input_onmouseover",function(e){e.window.eventmgr.handle("window_focus")},0),u.eventmgr.register("habla_wcsend_input_onfocus",function(){u.client.pollingmanager.reset()},0),u.eventmgr.register("habla_window_changed",function(e){"expand"===e.type&&(u.client.pollingmanager.reset(),u.client.pollingmanager.startNextPollNow())})},this.remove=function(){this.appended&&u.util.remove_element(this.divid)},this.setShowPreChat=function(e){window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.ignore_prechat_status||this.showOnlyThisDiv(e?this.habla_pre_chat_div:this.habla_conversation_div)},this.showOnlyThisDiv=function(e){var t=this.habla_conversation_div,n=this.habla_offline_message_div,i=this.habla_offline_message_sent_div,o=this.habla_pre_chat_div,a=this.habla_chatform_form,r=this.habla_wcsend_input;if(e==t){t.style.display="block",n.style.display="none",i.style.display="none",o.style.display="none";var s="notavailable"!=habla_window.get_operator_state();s&&(a.style.display="block",r.style.display="block",this.pre_chat_sent&&this.focus_on_the_input_box())}else e==n?(t.style.display="none",n.style.display="block",i.style.display="none",o.style.display="none",a.style.display="none",r.style.display="none"):e==i?(t.style.display="none",n.style.display="none",i.style.display="block",o.style.display="none",a.style.display="none",r.style.display="none"):e==o&&(t.style.display="none",n.style.display="none",i.style.display="none",o.style.display="block",a.style.display="none",r.style.display="none");olark._.needsFirstTimeOperatorLogin?(this.habla_name_input.style.display="none",this.habla_offline_email_input.style.display="none",this.habla_offline_phone_input.style.display="none",this.habla_offline_body_input.style.display="none",this.habla_offline_submit_input.style.display="none"):(this.habla_name_input.style.display="block",this.habla_offline_email_input.style.display="block",this.habla_offline_phone_input.style.display="block",this.habla_offline_body_input.style.display="block",this.habla_offline_submit_input.style.display="block")},this.setOfflineWindow=function(e){if(!(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.ignore_prechat_status)){var t=this.config.vars.show_pre_chat&&1!=this.config.vars.disable_offline_messaging_fallback&&"notavailable"==habla_window.get_operator_state();e||t?(this.habla_offline_message_span.innerHTML=e||this.config.vars.offline_message,this.message_sent?(this.showOnlyThisDiv(this.habla_offline_message_sent_div),this.offline_window=!1):(this.offline_window=!0,this.showOnlyThisDiv(this.habla_offline_message_div))):(this.offline_window=!1,this.showOnlyThisDiv(this.habla_conversation_div))}},this.scroll_conversation_history_to_most_recent=function(){var e=this;setTimeout(function(){e.habla_conversation_div.scrollTop=e.habla_conversation_div.scrollHeight},10)},this.setBody=function(e){u.client.buffer.length&&u.client.is_conversation()||(this.habla_conversation_div.innerHTML="",this.config.render_class(this.habla_conversation_div,"habla_conversation_message_off","habla_conversation_message_on"),""!=e&&(e=u.util.as_dom(e),this.config.render_class(this.habla_conversation_div,"habla_conversation_message_on","habla_conversation_message_off"),this.habla_conversation_div.appendChild(e),e.id="hbl_body_message"),this.scroll_conversation_history_to_most_recent())},this.disableMessageInput=function(e){this.habla_wcsend_input.disabled=!0,this.habla_wcsend_input.value=e||""},this.getBody=function(){return this.habla_conversation_div.innerHTML};var e={},t=null,n=function(e){var t=document.createElement("div");t.appendChild(document.createTextNode(e));var n=t.innerHTML;return n};this.appendNiceMessage=function(i,o,a,r){if(void 0!=o&&void 0!=i){if(o&&(o=n(o)),r||(o=this.display_pipeline.run(o)),o){o=u.util.getCommonTextFormatter().formatAsHtml(o);var s=u.client.op_nickname_map[i],_=null;u.config.vars.operators&&s&&u.config.vars.operators[s.toString()]&&(_=u.config.vars.operators[s.toString()].avatar_url),"https:"===document.location.protocol&&"string"==typeof _&&(_=_.replace("http://","https://"));var l=document.createElement("p");if(_&&!e[i]){e[i]=!0;var c=document.createElement("img");c.className="olrk_avatar",c.src=_,l.appendChild(c)}this.config.set_element_classes(l,"habla_conversation_p_item"),null!=t&&t!=i&&(l.className=l.className+" olrk_new_sender"),t=i;var d=document.createElement("span"),h=document.createElement("span");if(i===this.config.vars.myname){this.config.set_element_classes(d,"habla_conversation_person1"),this.config.set_element_classes(h,"habla_conversation_text_span");var p=this.config.vars.local_user_display_name;"&rarr;"===p||"&larr;"===p?d.innerHTML=p:u.util.set_inner_text(d,p)}else if(/^INTERNAL_NOTIFICATION/.test(i)){this.config.set_element_classes(d,"habla_conversation_notification_nickname"),this.config.set_element_classes(h,"habla_conversation_notification_text_span"),u.util.set_inner_text(d,"");var f=i.split("-"),g=f.slice(2).join("-");f=f.slice(0,2),f.push(g),3===f.length&&setTimeout(function(){olark.__core.trigger_event({namespace:"chat",type:"interfaceElementReady",extensionName:f[1],key:f[2],dom:h})},0)}else{this.config.set_element_classes(d,"habla_conversation_person2"),this.config.set_element_classes(h,"habla_conversation_text_span");var m=this.config.vars.local_name_override?this.config.vars.local_name_override:i;m&&!/^\s*$/.test(m)?u.util.set_inner_text(d,m+": "):u.util.set_inner_text(d,m)}h.innerHTML=o,l.appendChild(d),l.appendChild(h),this.appendMessage(l,a)}window.habla_window.theme.scroll_conversation_history_to_most_recent()}},this.appendMessage=function(e,t){-1==this.last_msg&&t&&this.setBody(""),e=u.util.as_dom(e),this.last_msg+=1,e.setAttribute("id","habla_msg_"+this.last_msg),this.habla_conversation_div.appendChild(e),this.scroll_conversation_history_to_most_recent()},this.setHeader=function(e){this.habla_oplink_a.innerHTML=e},this.getHeader=function(){return this.habla_oplink_a.innerHTML},this.hide=function(){this.visible=!1,this.habla_conversation_div&&(this.habla_conversation_div.style.overflow="hidden"),u.util.hide_div(this.habla_window_div),u.util.hide_div(this.habla_panel_div),u.util.hide_div(this.habla_both_div),u.util.hide_div(this.habla_closed_div),u.util.hide_div(this.habla_expanded_div),u.util.hide_div(this.habla_compressed_div)},this.focus_on_the_input_box=function(){var e=this,t=document.activeElement&&document.activeElement.tagName?document.activeElement.tagName:null;t&&/^(input|textarea|select|option|button|optgroup|form)$/i.test(t)||e.config.vars.disable_input_focusing||window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.disable_input_focusing||e.config.vars.is_inline||e.config.vars.disableFocus||!e.habla_wcsend_input||"none"==e.habla_chatform_form.style.display||setTimeout(function(){if("none"!=e.habla_chatform_form.style.display)try{e.habla_wcsend_input.focus()}catch(t){}},20)},this.expand=function(){this.__set_css_window_state("expanded"),this.habla_sizebutton_a&&this.config.vars.habla_sizebutton_text_expanded&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_expanded),this.show(),this.focus_on_the_input_box()},this.compress=function(){this.__set_css_window_state("compressed"),this.habla_sizebutton_a&&this.config.vars.habla_sizebutton_text_compressed&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_compressed),this.show()},this.show=function(){this.ready&&(this.visible=!0,this.config.vars.disableJSStyles&&u.util.show_div(this.habla_window_div),"closed"==this.state?(u.util.hide_div(this.habla_expanded_div),u.util.hide_div(this.habla_panel_div),u.util.hide_div(this.habla_compressed_div),this.habla_conversation_div.style.overflow="hidden",u.util.show_div(this.habla_closed_div)):"expanded"==this.state?(u.util.hide_div(this.habla_compressed_div),u.util.hide_div(this.habla_closed_div),u.util.show_div(this.habla_panel_div),u.util.show_div(this.habla_expanded_div),u.util.show_div(this.habla_both_div),this.habla_conversation_div.style.overflow="auto",this.scroll_conversation_history_to_most_recent(),this.habla_sizebutton_a&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_expanded),this.focus_on_the_input_box(),this.normal()):"compressed"==this.state&&(u.util.hide_div(this.habla_expanded_div),u.util.hide_div(this.habla_closed_div),u.util.show_div(this.habla_panel_div),u.util.show_div(this.habla_both_div),u.util.show_div(this.habla_compressed_div),this.habla_conversation_div.style.overflow="hidden",this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div_compressed"),this.habla_sizebutton_div&&(this.habla_sizebutton_div.innerHTML=this.config.vars.habla_sizebutton_text_compressed)))},this.close=function(){this.__set_css_window_state("closed"),this.show()},this.__set_css_window_state=function(e){this.state;this.state=e,this.window_state_div.className=(this.config.vars.show_end_popout?"olrk-state-popout":"")+"olrk-state-"+e},this.__get_browser_class=function(){return"habla-browser-"+u.util.BrowserDetect.browser.toLowerCase()},this.__get_mobile_class=function(){return navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Mobile/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?"habla-mobile":navigator.userAgent.match(/iPad/)?"habla-ipad":"habla-desktop"},this.setWidth=function(e){if(!this.config.vars.disable_width){var t=e;this.habla_panel_div.style.width=e+"px",t=u.util.BrowserDetect.backwards_dimension||"Explorer"==u.util.BrowserDetect.browser&&u.util.BrowserDetect.backwards_dimension?e-this.config.vars.input_width_offset_compat+"px":"Explorer"==u.util.BrowserDetect.browser?e-this.config.vars.input_width_offset_ie+"px":e-this.config.vars.input_width_offset_normal+"px",this.habla_wcsend_input.style.width=t,this.habla_name_input.style.width=t,this.habla_offline_body_input.style.width=t,this.habla_offline_email_input.style.width=t,this.habla_offline_phone_input.style.width=t,this.habla_pre_chat_name_input.style.width=t,this.habla_pre_chat_email_input.style.width=t,this.habla_pre_chat_phone_input.style.width=t}},this.setInputHeight=function(e){u.config.vars.disable_height||(e=e>18?e:18,u.util.BrowserDetect.backwards_dimension&&(e=e>24?e:24),"undefined"==typeof this.originalHeight&&(this.originalHeight=e,this.habla_wcsend_input.style.lineHeight=e+"px"),this.habla_wcsend_input.style.height=e+"px")},this.setFormInputHeight=function(e){u.config.vars.disable_height||(e=e>18?e:18,u.util.BrowserDetect.backwards_dimension&&(e=e>24?e:24),e+="px",this.habla_name_input.style.height=e,this.habla_offline_email_input.style.height=e,this.habla_offline_phone_input.style.height=e,this.habla_pre_chat_name_input.style.height=e,this.habla_pre_chat_name_input.style.lineHeight=e,this.habla_pre_chat_email_input.style.height=e,this.habla_pre_chat_email_input.style.lineHeight=e,this.habla_pre_chat_phone_input.style.height=e,this.habla_pre_chat_phone_input.style.lineHeight=e)},this.render_palette=function(){var e=this.config.palette;this.config.vars.limited_palette&&(e=this.config.vars.limited_palette);for(var t in e)if(e.hasOwnProperty(t)&&"string"==typeof this.config.palette[t]){var n=u.util.getElementsByClass(this.habla_window_div,"hbl_pal_"+t);for(var i in n)n.hasOwnProperty(i)&&n[i]&&n[i].style&&(t.match("_fg")?n[i].style.color=this.config.palette[t]:t.match("_bg")?n[i].style.backgroundColor=this.config.palette[t]:t.match("_border")&&(n[i].style.borderColor=this.config.palette[t]))}},this.getX=function(){return this.habla_window_div.style.left.match(/\d\d*/)},this.getY=function(){return this.habla_window_div.style.top.match(/\d\d*/)},this.setXY=function(e,t){this.habla_window_div.style.top=t,this.habla_window_div.style.left=e},this.setHeight=function(e){function t(e,t){e&&(e.style.height=t+"px")}u.config.vars.disable_height||(e=parseInt(e),t(this.habla_conversation_div,e),t(this.habla_pre_chat_div,e),t(this.habla_offline_body_input,e-85>0?e-85:0))},this.setMargins=function(e,t,n,i){this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginTop=t+"px",this.habla_window_div.style.marginLeft=e+"px",this.habla_window_div.style.marginRight=n+"px",this.habla_window_div.style.marginBottom=i+"px")},this.setInline=function(e){if(e){var t=this.habla_window_div.style.display;this.habla_window_div.setAttribute("style",""),this.config.style_classes_map.habla_window_div=["habla_window_div_position_inline","habla_window_div_base","hbl_pal_main_width"],this.habla_window_div.style.display=t,this.config.render_element_classes(this,"habla_window_div")}else this.setPosition(this.config.vars.corner_position)},this.__getAdjustedPosition=function(e){return e=e.toUpperCase(),this.config.vars.theme_requires_position&&(this.config.vars.theme_requires_position.match(/B/)?e=e.replace("T","B")+"B":this.config.vars.theme_requires_position.match(/T/)&&(e=e.replace("B","T")),this.config.vars.theme_requires_position.match(/R/)?e=e.replace("L","R")+"R":this.config.vars.theme_requires_position.match(/L/)&&(e=e.replace("R","L"))),e},this.setPosition=function(e){var t=this.habla_window_div.style.display;this.config.style_classes_map.habla_window_div=["habla_window_div_base","hbl_pal_main_width"],e=this.__getAdjustedPosition(e),this.habla_window_div.setAttribute("style",""),e.match(/B/)?(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginBottom=this.config.vars.bottom_margin+"px",this.habla_window_div.style.bottom="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-bottom")):(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginTop=this.config.vars.top_margin+"px",this.habla_window_div.style.top="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-top")),e.match(/R/)?(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginRight=this.config.vars.right_margin+"px",this.habla_window_div.style.right="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-right")):(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginLeft=this.config.vars.left_margin+"px",this.habla_window_div.style.left="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-left")),this.habla_window_div.style.display=t,this.config.vars.disable_javascript_position||(this.habla_window_div.style.position=u.util.BrowserDetect.use_position_absolute_on_ie?"absolute":"fixed"),this.config.render_element_classes(this,"habla_window_div"),this.position=e},this.highlight=function(){this.highlighted||(this.config.set_element_classes(this.habla_closebutton_a,"habla_button_highlighted"),this.config.set_element_classes(this.habla_sizebutton_a,"habla_button_highlighted"),this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div_highlighted"),this.config.set_element_classes(this.habla_wcsend_input,"habla_wcsend_input_highlighted"),this.highlighted=!0)},this.normal=function(){this.highlighted&&(this.config.set_element_classes(this.habla_closebutton_a,"habla_button_normal"),this.config.set_element_classes(this.habla_sizebutton_a,"habla_button_normal"),this.config.set_element_classes(this.habla_topbar_div,"habla_button_normal"),this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div"),this.config.set_element_classes(this.habla_wcsend_input,"habla_wcsend_input"),this.highlighted=!1)},this.getMessageInputField=function(){return this.habla_wcsend_input},this.getMessageInputFieldValue=function(){return this.habla_wcsend_input.value},this.setMessageInputFieldValue=function(e){this.habla_wcsend_input.value=e};var i=u.util.getCommonTextFormatter(),o=_.bind(i.formatAsHtml,i);this.display_pipeline=new u.util.pipeline(this),this.display_pipeline.add(o,999),this.display_pipeline.add(window.olark.__legacy_shim.pipeline_disabler,1001)},u.eventmgr.register("habla_preload_done",function(){u.config.vars.theme_path||u.config.vars.theme_obj||(u.config.vars.theme_obj=new u.themes.default_theme)},0),(!window.olark||window.olark&&!window.olark.__legacy_shim)&&(window.olark&&window.olark.__internal&&window.olark.__internal.skip_wc_init_post||(y?u.eventmgr.register("habla_called_wc_init",function(){r()}):r())),window.olark&&window.olark.__internal&&window.olark.__internal.declare("__internal.legacy",function(){}),window.olark&&window.olark.__legacy_shim&&(window.olark.__legacy_shim.legacy_post_stub_is_loaded=!0),window.olark.__core.framestorewithjson=function(t,n,i,o,a){return t=e("../../chatbox/json"),n=function(){function e(){try{return k in g&&g[k]}catch(e){return!1}}function t(){try{return x in g&&g[x]&&g[x][g.location.hostname]}catch(e){return!1}}function n(){function e(e){var t=e.key;t?o(t):a()}window.addEventListener?window.addEventListener("storage",e,!1):window.attachEvent("onstorage",e)}function i(){setInterval(a,b)}function o(e){var t=w[e],n=c(e);if(v[e]=v[e]||[],w[e]=n,t!=n)for(var i=0;i<v[e].length;i++)try{v[e][i]({newValue:n})}catch(o){window.console&&window.console.error&&window.console.error(o)}}function a(){for(var e in v)v.hasOwnProperty(e)&&o(e)}function r(e){return function(){var t=Array.prototype.slice.call(arguments||[],0);t.unshift(d),m.body.appendChild(d),d.addBehavior("#default#userData"),d.load(k);var n=e.apply(f,t);return m.body.removeChild(d),n}}function s(){var e=Array.prototype.slice.call(arguments||[],0),t=e.shift();try{return u[t].apply(u,e),p[t].apply(p,e)}catch(n){return u[t].apply(u,e)}}function _(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var n=e[t].replace(/^\s*/,"").replace(/\s*$/,"");if(0==n.indexOf(I))return f.deserialize(unescape(n.slice(I.length)))}return{}}function l(e){document.cookie=I+escape(f.serialize(e))+S,document.cookie.length>y&&(window.console&&window.console.warn&&window.console.warn("cookie is too large, clearing storejs"),l({}))}var c,d,h,u,p,f={},g=window,m=g.document,v={},b=750,y=4e3,w={},k="localStorage",x="globalStorage";if(f.set=function(){},f.get=function(){},f.remove=function(){},f.clear=function(){},f.transact=function(e,t){var n=f.get(e);"undefined"==typeof n&&(n={}),t(n),f.set(e,n)},f.listen=function(e,t){w[e]=c(e),v[e]=v[e]||[],v[e].push(t)},f.serialize=function(e){return JSON.stringify(e)},f.deserialize=function(e){return"string"!=typeof e?void 0:JSON.parse(e)},e())d=g[k],f.set=function(e,t){d.setItem(e,f.serialize(t))},f.get=function(e){return f.deserialize(d.getItem(e))},f.remove=function(e){d.removeItem(e)},f.clear=function(){d.clear()},c=function(e){return d.getItem(e)},n();else if(t())d=g[x][g.location.hostname],f.set=function(e,t){d[e]=f.serialize(t)},f.get=function(e){return f.deserialize(d[e]&&d[e].value)},f.remove=function(e){delete d[e]},f.clear=function(){for(var e in d)delete d[e]},c=function(e){return d[e]},i();else if(m.documentElement.addBehavior)d=m.createElement("div"),h={},u={},p={},p.set=r(function(e,t,n){e.setAttribute(t,f.serialize(n)),e.save(k)}),p.get=r(function(e,t){return f.deserialize(e.getAttribute(t))}),p.remove=r(function(e,t){e.removeAttribute(t),e.save(k)}),p.clear=r(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(k);for(var n,i=0;n=t[i];i++)e.removeAttribute(n.name);e.save(k)}),u.set=function(e,t){h[e]=t},u.get=function(e){return h[e]},u.remove=function(e){delete h[e]},u.clear=function(){h={}},f.set=function(e,t){return s("set",e,t)},f.get=function(e){return s("get",e)},f.remove=function(e){return s("remove",e)},f.clear=function(){return s("clear")},c=function(e){try{return r(function(e,t){return e.getAttribute(t)})(e)}catch(t){return h[e]}},i();else{var S="; path="+document.location.pathname,I="storejs=";f.set=function(e,t){{var n=_();n[e]}n[e]=t,l(n)},f.get=function(e){return _()[e]},f.remove=function(e){var t=_();try{delete t[e]}catch(n){t[e]=void 0}l(t)},f.clear=function(){l({})},c=function(e){return f.serialize(_()[e])}}return f}(),i=function(e,t){function n(){if(e.console&&e.console.error)try{e.console.error.apply(e.console,arguments)}catch(t){try{e.console.error(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function i(){if(e.console&&e.console.warn)try{e.console.warn.apply(e.console.warn,arguments)}catch(t){try{e.console.warn(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function o(e){return e.contentWindow?e.contentWindow:e.contentDocument.window}function a(){return Math.random().toString().replace("0.","TK")}function r(){var t=e.ActiveXObject;if(!t)return-1;try{var n,i=new t("ShockwaveFlash.ShockwaveFlash");return i?(n=i.GetVariable("$version"),parseInt(/([0-9]+)/.exec(n)[1])):-1}catch(o){return-1}}function s(e){return/^\s*(file\:|[a-zA-Z]\:).*/.test(e)}function _(e){var t;return e?""==e.length?null:s(e)?"file:":(t=e.split("//"),t.length>1?t[0]+"//"+t[1].split("/")[0]:t[0]):null}function l(n,i){var o,a,r=Math.floor(99999*Math.random()).toString(),s=t.createElement("span"),_="framesocket"+r,l="framesocket"+r,c=t.getElementsByTagName("body")[0],d=!1,h="try{window."+l+"()}catch(e){"+l+"()}";return c?a=function(){c.appendChild(s)}:(c=t.getElementsByTagName("script")[0],a=function(){c.parentNode.insertBefore(s,c)}),e[l]=function(){i&&!d&&(d=!0,i(o))},s.style.display="none",/(Firefox)/.test(navigator.userAgent)?(s.innerHTML='<iframe style="display: none !important" id="'+_+'" onload="'+h+'"></iframe>',a(),o=t.getElementById(_),o.src=n):(s.innerHTML='<iframe style="display: none !important" id="'+_+'" src="'+n+'" onload="'+h+'"></iframe>',a(),o=t.getElementById(_)),o}function c(e){setTimeout(e,0)}function d(e){return _("file:"==e?null:e)}function h(e,t){function n(){if(e()){var i=o.shift();a=!1,"undefined"!=typeof i&&t(i),o.length>0&&!a&&(a=!0,c(n))}}function i(e){o.push(e),n()}var o=[],a=!1,r=null;return r={queuedSend:i,attemptDequeue:n}}function u(){function n(){function t(t,n){e.postMessage?l.postMessage(t,n):l.document.postMessage(t,n)}function n(e){null==c||s(c)?t(e,"*"):t(e,_(c))}function i(){return"undefined"!=typeof l&&"undefined"!=typeof c?!0:!1}function o(e){l=e,d.attemptDequeue()}function a(e){c=e,d.attemptDequeue()}function r(e){d.queuedSend(e)}var l,c,d,u;return d=h(i,n),u={setPostMessageTargetWindow:o,setPostMessageTargetOrigin:a,send:r}}function r(n){function i(e){var i,r=_(e.origin||e.uri),l=null;"null"==e.origin&&(r="file:"),r&&!s(r)&&(e.uri&&0==e.uri.toString().indexOf(r)?l=e.uri.toString().slice(r.length):t.referrer&&0==t.referrer.toString().indexOf(r)&&(l=t.referrer.toString().slice(r.length))),i=d(r),("undefined"==typeof o||o==i)&&("undefined"==typeof a||a==e.source)&&n({data:e.data,origin:i})}var o,a,r={};return e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),r.setExpectedOrigin=function(e){o=d(e)},r.setExpectedWindow=function(e){a=e},r}m.connect=function(e,t){function i(e){h.send(u+v+e)}var s,c=e.server||e,d=null,h=n(),u=a(),p=c.replace(/\#[^?]*/,"")+"#"+u;return t=t||function(){},h.setPostMessageTargetOrigin(c),l(p,function(e){var n=o(e);s=r(t),s.setExpectedOrigin(_(p)),s.setExpectedWindow(n),h.setPostMessageTargetWindow(n)}),i(b),d={send:i}},m.accept=function(t){function o(e){var n=e.data.split(v),o=n[0],r=n[1];o==l?r==b?d||(d=!0,a.setExpectedOrigin(e.origin),_.setPostMessageTargetOrigin(e.origin)):c(function(){t({data:r,origin:e.origin})}):i("[framesocket] received a message from an origin with an invalid identity")}var a,s=null,_=n(),l=(e.location.hash||"").slice(1),d=!1;return t=t||function(){},_.setPostMessageTargetWindow(e.parent),a=r(o),a.setExpectedWindow(e.parent),s={send:_.send}}}function p(){m.connect=function(t,n){function i(){return g}function o(e){u.frameElementContext.sendToChild(e,m)}function r(e){_.queuedSend(e)}function s(t,n){return t!=m?(e.console&&e.console.warn&&e.console.warn("[framesocket] invalid security token given to client in frameElement transport"),null):void n()}var _,u,p,f=t.server||t,g=!1,m=a(),v=f.replace(/\#[^?]*/,"")+"#"+m;return n=n||function(){},_=h(i,o),u=l(v),u.frameElementContext=function(){},u.frameElementContext.markChildAsReady=function(e){s(e,function(){c(function(){g=!0,_.attemptDequeue()})})},u.frameElementContext.sendToParent=function(e,t){s(t,function(){n({data:e,origin:d(f)})})},p={send:r}},m.accept=function(n){function i(){return!0}function o(t){e.frameElement.frameElementContext.sendToParent(t,l)}function a(e){s.queuedSend(e)}function r(t,n){return t!=l?(e.console&&e.console.warn&&e.console.warn("[framesocket] invalid security token given to server in frameElement transport"),null):void n()}var s,_,l=(e.location.hash||"").slice(1);return n=n||function(){},e.frameElement.frameElementContext(),e.frameElement.frameElementContext.sendToChild=function(e,i){r(i,function(){n({data:e,origin:d(t.referrer)})})},e.frameElement.frameElementContext.markChildAsReady(l),s=h(i,o),_={send:a}}}function f(){function n(){for(;l.length;)l.shift()(o())}function i(e){var n=t.getElementsByTagName("script")[0],i=t.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,n.parentNode.insertBefore(i,n)}function o(){var t=null;return e.minixdm&&(t=e.minixdm.easyXDM),t||e.easyXDM}function a(e,t){l.push(t),o()?n():r||(r=!0,i(e),s=setInterval(function(){o()&&(n(),clearInterval(s))},100))}var r=!1,s=null,l=[];m.connect=function(t,n){var i,o=t.server||t,r=o.replace(/(\/[^\/]+)$/,""),s=r+"/minixdm.swf",l=r+"/minixdm.js";"http:"==e.location.protocol&&(s=s.replace("https","http")),a(l,function(e){i=new e.Socket({protocol:y,lazy:!1,swf:s,remote:o.replace(/\#[^?]*/,"")+"#basepath="+encodeURIComponent(r),onMessage:function(e,t){n({data:e,origin:_(t)})}})});var c={send:function(e){a(l,function(){i.postMessage(e)})}};return c},m.accept=function(t){var n,i=decodeURIComponent(/basepath=([^?&]+)/.exec(e.location.href.slice(1))[1]),o=i+"/minixdm.swf",r=i+"/minixdm.js";"http:"==e.location.protocol&&(o=o.replace("https","http")),a(r,function(e){n=new e.Socket({protocol:y,swf:o,onMessage:function(e,n){t({data:e,origin:_(n)})}})});var s={send:function(e){a(r,function(){n.postMessage(e)})}};return s}}function g(){n("[framesocket] unsupported browser")}var m={},v="~:DATA:~",b="~:INIT:~",y="6";return e.postMessage||t.postMessage?u():"Gecko"==navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?p():r()>6?f():(m.connect=function(){return g(),{send:g}},m.accept=function(){return g(),{send:g}},m.isCompatible=function(){return!1}),m.isCompatible=m.isCompatible||function(){return!0},m}(window,document),o=function(e,t,n,i,o){function a(){if(e.console&&e.console.error)try{e.console.error.apply(e.console,arguments)}catch(t){try{e.console.error(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function r(){if(e.console&&e.console.warn)try{e.console.warn.apply(e.console.warn,arguments)}catch(t){try{e.console.warn(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function s(){this.name="ReadTimeoutError"}function _(){this.name="WriteTimeoutError"}function l(){return(new Date).getTime()}function c(e,t){for(var i=Array.prototype.slice.call(arguments||[]).slice(2),o=t.toString(),a=0;a<i.length;a++)o+="undefined"==typeof i[a]?k+escape(x):k+escape(n.encode(i[a]));
e.send(o)}function d(e,t){for(var i,o=e.split(k),a=o[0],s=o.slice(1),_=t[a],l=[],c=0;c<s.length;c++)i=unescape(s[c]),l.push(i==x?{}.undefinedValue:n.decode(i));_?_.apply(_,l):r("[framestore] unknown command type:",a)}function h(e,t){try{i.remove("__framestore__.locks."+e)}catch(n){}t(function(){})}function u(e){var t=f(),n=null,i=l(),o=null;for(var a in t)a!=e&&t.hasOwnProperty(a)&&(o=t[a],(null===n||o===!0||i>o)&&(n=a,i=o===!0?0:o));n&&m(n)}function p(e,t){for(;e;)e--,u(t)}function f(){var e="__framestore__.index";try{return i.get(e)||{}}catch(t){return r("[framestore] index capture failed, resetting"),i.set(e,{}),{}}}function g(e){var t="__framestore__.index";try{return i.set(t,e)}catch(n){r("[framestore] index capture failed, clearing entire storage"),i.clear(),i.set(t,e)}}function m(e){var t=f();i.remove(b(e)),delete t[e],g(t)}function v(e){var t=f();t[e]=l(),g(t)}function b(e){return"__framestore__.stores."+e}function y(e,n,o){v(e),h("stores."+e,function(a){function r(e,t){(e||t)&&(e&&(s.data=e),t&&(s.metadata=t),s.metadata.lastUpdated=l(),i.set(_,s)),a()}var s,_=b(e),c={metadata:{creator:t.referrer,lastUpdated:l()},data:{}};try{s=i.get(_)||c}catch(d){if(!o)throw d;s=c}n(s.data,s.metadata,r)})}var w={},k=",",x="~UNDEFINED",S="~DELETEDKEY",I=100,C=2100;return w.connect=function(t,n,i){function a(){k||(k=setTimeout(l,I))}function l(){f.flush()}function h(e){22===e.code||/QUOTA/.test(e.name||"")?v?M&&M():P&&P():e instanceof _?E&&E():e instanceof s?A&&A():v||b?T&&T(e):(r("[framestore] failed to boot, trying to dump storage"),b=!0,f.dump(),f.pull())}function u(e){x=!1,h(e)}var p,f={},g=t.server,m=t.key,v=!1,b=!1,y={},w=[],k=null,x=!1,T=t.onFailure,P=t.onDisabled,M=t.onOverflow,A=t.onReadTimeout,E=t.onWriteTimeout,O=!1,N=null,j=null,V=null,F=t.maxMillisecondsForResponse||C;return p=o.connect(g,function(t){d(t.data,{DOWNLOADED:function(){i&&i.onDownloaded()},FLUSHDONE:function(e){N==e&&(x=!1,w=[],O&&l())},FLUSHFAIL:function(e,t){N==e&&u(t)},PULLFAIL:function(e){V&&(clearTimeout(V),V=null),h(e)},PUSH:function(t,o,a){i&&!v&&i.onFirstPullReceived();var r,s,_,c;if(a)r=o;else for(r=o,s=0;s<w.length;s++)_=w[s],c=y[_],r[_]=c;y=r,V&&(clearTimeout(V),V=null),t=t,v||(v=!0,e.addEventListener?e.addEventListener("beforeunload",l,!1):e.attachEvent("onbeforeunload",l),i&&i.onFirstPullParsed(),n(f))}})}),f.pull=function(){V=setTimeout(function(){r("[framesocket] timed out while pulling from persistent storage"),h(new s)},F),c(p,"PULL",m)},f.flush=function(){if(x)return void(O=!0);if(k&&(clearTimeout(k),k=null),j&&(clearTimeout(j),j=null),O=!1,v&&w.length>0){var e,t,n,i={};for(e=0;e<w.length;e++)t=w[e],n=y[t],i[t]="undefined"==typeof n?S:n;N=(+new Date).toString(),x=!0,j=setTimeout(function(){x&&(r("[framesocket] timed out while flushing to persistent storage"),u(new _))},F),c(p,"FLUSH",m,i,N)}},f.get=function(e){return y[e]},f.set=function(e,t){y[e]=t,w.push(e),a()},f.remove=function(e){try{y[e]=void 0,delete y[e]}catch(t){}w.push(e),a()},f.clear=function(){y={},k&&(clearTimeout(k),k=null),c(p,"CLEAR",m)},f.dump=function(){c(p,"DUMP",m,y)},f.reclaim=function(e){c(p,"RECLAIM",m,e)},f.reject=function(e){for(var t in y){var n;try{n=e(t)?!0:!1}catch(i){n=!1}if(y.hasOwnProperty(t)&&n){try{y[t]=void 0,delete y[t]}catch(i){}w.push(t)}}a()},f.pull(),f},w.accept=function(){function e(e){c(s,"FLUSHDONE",e)}function t(e,t){r("[framestore] unable to flush to persistent storage"),a(e),c(s,"FLUSHFAIL",t,e)}function n(e){r("[framestore] unable to pull from persistent storage"),a(e),c(s,"PULLFAIL",e)}var s,_={};s=o.accept(function(o){d(o.data,{PULL:function(e){function t(t){try{y(e,function(n,i,o){c(s,"PUSH",e,n,t),o(null,null)})}catch(i){n(i)}}_[e]?t():(_[e]=!0,i.listen(b(e),t),i.listen("__framestore__.index",function(){var n=f();for(var i in n)if(i==e)return;r("[framestore] storage reclaimed, pushing cleared contents"),t(!0)}),t())},FLUSH:function(n,i,o){try{y(n,function(n,a,r){var s,_,l={};for(s in i)if(i.hasOwnProperty(s))if(_=i[s],l[s]=n[s],_==S)try{n[s]=void 0,delete n[s]}catch(c){}else n[s]=_;try{r(n,null),e(o)}catch(c){for(var d in l)l.hasOwnProperty(d)&&(n[d]=l[d]);t(c,o)}})}catch(a){t(a,o)}},CLEAR:function(e){m(e)},DUMP:function(e,t){y(e,function(e,n,i){i(t,null)},!0)},RECLAIM:function(e,t){t&&t>0?p(t,e):r("[framestore] number of reclaimed entries must be nonzero")}})}),c(s,"DOWNLOADED")},i.serialize=function(e){return n.encode(e)},i.deserialize=function(e){return"string"!=typeof e?void 0:n.decode(e)},w}(window,document,t,n,i),a=function(e,t,n,i,o){return{framestore:n,json:i,framesocket:o}}(window,document,o,t,i)}(),function(e,t){e.wait_for(function(){return e.framestorewithjson},function(){function n(n,i){function o(){return olark._.cookieManager.get("olfsk")}function a(){olark._.cookieManager.erase("olfsk")}function r(e){olark._.cookieManager.set("olfsk",e,63072e6)}function s(){u=!1;var e=olark._.isNewConversation?!0:!1;return e||olark._.hlog("already booted once, but lost olfsk #warn #olfsk_regen"),Math.random().toString().replace("0.","olfsk")}function _(o){function s(t){d||(d=!0,e.data.forceDomain=function(e){a(),c=e,r(o)},e.data.forcePath=function(e){a(),l=e,r(o)},r(o),e.data.storejs=t,i())}function _(){var t=e.framestorewithjson.json;s({set:function(e,n){localStorage.setItem(e,t.encode(n))},get:function(e){return t.decode(localStorage.getItem(e)||"null")},remove:function(e){localStorage.removeItem(e)}})}var u=!1,p=!1,f=function(){e.data.storejs.reject(function(e){return"vsession"==e||e==olark._.identityManager.getConversationId()?!1:!0}),e.data.storejs.reclaim(1),e.data.storejs.flush()},g=!1,m=document.referrer||"";"https:"===location.protocol&&/^http\:/.test(m)&&(g=!0),"http:"===location.protocol&&/^https\:/.test(m)&&(g=!0),""===m&&"http:"===location.protocol&&(g=!0),g&&olark._.hlog("switching from HTTP to HTTPS #ssl_protocol_switch");var v={server:h,key:o,onDisabled:function(){"localStorage"in window&&(t.warn("[olark] persistent storage disabled, chat will restart when crossing over into SSL or other subdomains"),olark._.hlog("data persistence lowered due to #local_storage_disabled"),_())},onOverflow:function(){u?(olark._.hlog("storage overflow, #overflow_cleared_convo_storage"),e.data.storejs.clear()):(olark._.hlog("storage overflow, #eliminated_convo_data"),u=!0,f())},onReadTimeout:function(){olark._.hlog("reads taking too long #storage_read_timeout"),f()},onWriteTimeout:function(){olark._.hlog("writes taking too long #storage_write_timeout"),f()},onFailure:function(n){p?(olark._.hlog("storage failure, #failure_cleared_convo_storage"),e.data.storejs.clear()):(p=!0,t.warn("[olark] dumping storage cache due to unexpected issue:",n),olark._.hlog("unable to persist storage #storage_failure"),e.data.storejs.dump())}};n?_():e.data.storejs=e.framestorewithjson.framestore.connect(v,s,{onDownloaded:function(){olark._.P("storedownloaded")},onFirstPullReceived:function(){olark._.P("storereceived")},onFirstPullParsed:function(){olark._.P("storeparsed")}})}var l="/",c=null,d=!1,h=olark._&&olark._.storage?olark._.storage:"https://static.olark.com/jsclient/storage.html?v=1",u=!0;(olark._.storage?1:0)||olark._.hlog("no storage URL specified in loader, falling back #warn #no_storage_url"),_(o()||s()),setTimeout(function(){d||olark._.hlog("slow data connection (>8s) #slow_framestore_connection")},8e3)}function i(e,t,i){n(t,i)}var o="prev-",a=900,r=864e5,s=/^\s*(__.*|chatNickname|chatStatus)\s*$/,_=function(e,t){e=e||{};for(var n=t.length;n--;){var i=t[n],o=e[i];if("undefined"==typeof o)throw new Error("[olark] '"+i+"' is a required argument")}return e},l=function(e){var t=this;if(t.__key=e.key,t.__keystore=e.keystore,t.__link_to_conversation=e.link_to_conversation,t.__link_to_visitor=e.link_to_visitor,t.__initial_value=e.initial_value,t.__backup=e.backup,t.__backupTransform=e.backupTransform,t.__link_to_visitor&&t.__link_to_conversation)throw new Error("cannot link object reference to both the visitor and conversation");if(t.__event_object_string="PersistentObjectReference."+t.__key,"undefined"==typeof t.get()&&"undefined"!=typeof t.__initial_value&&t.set(t.__initial_value),t.__link_to_conversation&&t.__keystore.isLinkedToVisitor({key:t.__key}))throw new Error("this object is already linked to the visitor, cannot link it to the conversation");if(t.__link_to_visitor&&t.__keystore.isLinkedToConversation({key:t.__key}))throw new Error("this object is already linked to the conversation, cannot link it to the visitor")};l.prototype.get=function(){var t=this,n=t.__keystore.get({key:t.__key,backup:t.__backup,backupTransform:t.__backupTransform});return"undefined"==typeof n?(t.set(t.__initial_value),e.clone_object(t.__initial_value)):e.clone_object(n)},l.prototype.set=function(t){var n=this;if("undefined"==typeof t)throw new Error("'value' required for object set");var i=n.__keystore.get({key:n.__key,backup:n.__backup,backupTransform:n.__backupTransform});e.deep_equals(i,t)||(n.__keystore.set({key:n.__key,value:t,link_to_conversation:n.__link_to_conversation,link_to_visitor:n.__link_to_visitor,backup:n.__backup}),e.trigger_event({namespace:n.__event_object_string,type:"keyChange",key:n.__key,newValue:t,oldValue:i}))},l.prototype.edit=function(e){var t=this,n=t.get();e(n),t.set(n)},l.prototype.change=function(e){t.warn("[olark] 'change' is deprecated, use __SPI_onChange instead"),this.__SPI_onChange(e)},l.prototype.__SPI_onChange=function(t){var n=this;e.listen_for_event({namespace:n.__event_object_string,type:"keyChange",callback:t})};var c=function(){};c.prototype.get=function(){throw new Error},c.prototype.set=function(){throw new Error},c.prototype.clearConversationData=function(){throw new Error},c.prototype.clearVisitorData=function(){throw new Error},c.prototype.isLinkedToConversation=function(){throw new Error},c.prototype.isLinkedToVisitor=function(){throw new Error};var d=function(e){e=e||{};var t=this;t.__conversation_expiration_delta_in_days=.1,t.__visitor_expiration_delta_in_days=365;var n=f({key:"csession",defaultValue:null,expiration_access_tag:olark._.identityManager.getConversationId()});n||p({key:"csession",value:{},expiration_in_milliseconds:t.__conversation_expiration_delta_in_days*r,expiration_access_tag:olark._.identityManager.getConversationId()});var i=f({key:"vsession",defaultValue:null,expiration_access_tag:olark._.identityManager.getVisitorId()});i||p({key:"vsession",value:{},expiration_in_milliseconds:t.__visitor_expiration_delta_in_days*r,expiration_access_tag:olark._.identityManager.getVisitorId()}),t.set({key:"siteId",value:olark._.siteId,link_to_visitor:!0})};d.prototype=new c,d.prototype.constructor=d,d.prototype.get=function(e){e=e||{};{var n=e.key,i=e.backup;e.backupTransform}if("undefined"==typeof n)throw new Error("'key' required");var o,a=f({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()}),r=f({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()}),s=a[n],_=r[n];if("undefined"!=typeof _?"undefined"!=typeof s?t.warn("[olark]",n,"was stored as associated with both the visitor and conversation, falling back to the conversation value"):o=_:o=s,"undefined"==typeof o&&i){var l,c,d,h,u=(olark._.cookieManager.getAllowingNullAndUndefinedAndEmptyString("_okbk")||"").split(",");for(h=0;h<u.length;h++)l=u[h].split("="),c=l[0],d=unescape(l[1]),c==i&&(o=d)}return o},d.prototype.set=function(e){e=e||{};var t=this,n=e.key,i=e.value,o=e.link_to_visitor,a=e.link_to_conversation,s=e.backup;if("undefined"==typeof n)throw new Error("'key' required");if("undefined"==typeof i)throw new Error("'value' required for key store set");if(o&&a)throw new Error("cannot link data to both a visitor and conversation");if(!o&&!a)throw new Error("currently, you must link to either a conversation or visitor");var _=f({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()}),l=f({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()});if(o){if(l[n])throw new Error("[error] cannot link "+n+" to the visitor, it is already associated with the conversation");_[n]=i,p({key:"vsession",value:_,expiration_in_milliseconds:t.__visitor_expiration_delta_in_days*r,expiration_access_tag:olark._.identityManager.getVisitorId()})}if(a){if(_[n])throw new Error("cannot link this value to the conversation, it is already associated with the visitor");l[n]=i,p({key:"csession",value:l,expiration_in_milliseconds:t.__conversation_expiration_delta_in_days*r,expiration_access_tag:olark._.identityManager.getConversationId()})}if(s){var c,d,h,u,g=(olark._.cookieManager.get("_okbk")||"").split(","),m=[s+"="+escape(i)];for(u=0;u<g.length;u++)c=g[u].split("="),d=c[0],h=unescape(c[1]),d!=s&&m.push(g[u]);olark._.cookieManager.setAllowingNullAndUndefinedAndEmptyString("_okbk",m.join(",")||null)}},d.prototype.clearConversationData=function(){g({key:"csession"}),olark._.cookieManager.erase("_okbk")},d.prototype.clearVisitorData=function(){g({key:"vsession"})},d.prototype.isLinkedToConversation=function(e){e=e||{};var t=e.key;if("undefined"==typeof t)throw new Error("'key' required");var n=f({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()});return"undefined"!=typeof n[t]},d.prototype.isLinkedToVisitor=function(e){e=e||{};var t=e.key;if("undefined"==typeof t)throw new Error("'key' required");var n=f({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()});return"undefined"!=typeof n[t]};var h=function(e){e=e||{};var t=this;if("undefined"==typeof e.namespace)throw new Error("'namespace' required");t.__namespace=e.namespace,t.__keystore=new d};h.prototype.__SPI_clearVisitorAndConversationData=function(){var e=this;e.__keystore.clearVisitorData(),e.__keystore.clearConversationData()},h.prototype.__SPI_clearOnlyConversationData=function(){var e=this;e.__keystore.clearConversationData()},function(){var e=h.prototype;e.declareConversationObject=function(e){var n=this;return t.warn("[olark] api.data.declareConversationObject is deprecated, please use api.data.getConversationObject instead"),n.getConversationObject(e)},e.declareVisitorObject=function(e){var n=this;return t.warn("[olark] api.data.declareVisitorObject is deprecated, please use api.data.getVisitorObject instead"),n.getVisitorObject(e)}}(),h.prototype.getConversationObject=function(e){e=e||{};var t=this;if("undefined"==typeof e.key)throw new Error("'key' required for getConversationObject");if("undefined"==typeof e.initialValue&&(e.initialValue=null),s.test(e.key))throw new Error("[olark] '"+e.key+"' is a protected key name, please choose something else");var n=e.initialValue,i=(e.__SPI_forceNamespace||t.__namespace)+"."+e.key,o=new l({key:i,keystore:t.__keystore,initial_value:n,link_to_conversation:!0,backup:e.backup,backupTransform:e.backupTransform});return o},h.prototype.getVisitorObject=function(e){e=e||{};var t=this;if("undefined"==typeof e.key)throw new Error("'key' required for getVisitorObject");if("undefined"==typeof e.initialValue&&(e.initialValue=null),s.test(e.key))throw new Error("[olark] '"+e.key+"' is a protected key name, please choose something else");var n=e.initialValue,i=(e.__SPI_forceNamespace||t.__namespace)+"."+e.key,o=new l({key:i,keystore:t.__keystore,initial_value:n,link_to_visitor:!0,backup:e.backup,backupTransform:e.backupTransform});return o};var u=null;!function(){var t={},n={get:function(n){var i=(new Date).getTime(),o=t[n];if(o&&i-o.timestamp<a)return o.val;var r=e.data.storejs.get(n);return t[n]={val:r,timestamp:i},r},set:function(n,i){var o=(new Date).getTime(),a={val:i,timestamp:o};e.data.storejs.set(n,i),t[n]=a},remove:function(n){e.data.storejs.remove(n),t[n]=void 0;try{delete t[n]}catch(i){}}};u=n}();var p=function(e){e=_(e,["key","value","expiration_in_milliseconds"]);var t=e.key,n=(new Date).getTime(),i={value:e.value,unix_timestamp:n,expiration_in_milliseconds:e.expiration_in_milliseconds};if(e.expiration_access_tag){var a=u.get(o+t);a&&a.expiration_access_tag===e.expiration_access_tag&&(t="prev-"+t),i.expiration_access_tag=e.expiration_access_tag}u.set(t,i)},f=function(n){return n=_(n,["key"]),e.try_and_optionally_catch(function(){var e=u.get(n.key);if(e&&e.expiration_access_tag&&e.expiration_access_tag!==n.expiration_access_tag){var t=u.get(o+n.key);t&&t.expiration_access_tag===n.expiration_access_tag?e=t:(olark._.hlog("new session started, #returning_visitor_session"),u.set(o+n.key,e),u.remove(n.key),e=u.get(n.key))}if(e){var i=(new Date).getTime(),a=i-e.unix_timestamp;return a<e.expiration_in_milliseconds?e.value:(g({key:n.key}),n.defaultValue)}return n.defaultValue},function(e){t.error("[olark] problem retrieving '"+n.key+"' from storejs: "+e.toString()),t.showErrorBacktrace(e)})},g=function(e){e=_(e,["key"]),u.remove(e.key)};e.data={AbstractKeyStore:c,StorejsKeyStore:d,DataApi:h,prepare:i,storejs:null}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return e.data&&window.olark.__legacy_shim.legacy_post_stub_is_loaded},function(){var n=500,i=300,o=null,a=null,r=!1,s=!1,_=!1,l=function(t){var n=this;if(n.__conf=t.conf,"undefined"==typeof n.__conf)throw new Error("'conf' required");if(n.__chat_api=t.chat_api,"undefined"==typeof n.__chat_api)throw new Error("'chat_api' required");n.__initialize_legacy_event_handlers(),n.__setup_chat_history_handling(),n.__conf.box.behave_like_popout&&n.__setup_popout_behavior(),n.__keystore=new e.data.StorejsKeyStore,n.__renderWelcomeMessage(),n.__SPI_onPrechatWelcomeMessage(function(){n.__renderWelcomeMessage()}),n.__conf.system.offline_msg_mode||(n.__prevent_showing=!1,n.__pending_show=!1,n.__chat_api.__SPI_onOperatorGroupChanging(function(){n.__prevent_showing=!0}),n.__chat_api.__SPI_onOperatorGroupChanged(function(){n.__prevent_showing=!1,n.__chat_api.operatorsAreAvailable()&&n.__pending_show&&n.show()}))};l.prototype.listen=function(n,i){t.warn("[olark] api.box.listen is deprecated, please use api.box.on<METHOD> instead"),e.listen_for_event({namespace:"box",type:n,callback:i})},l.prototype.expand=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.expand()})},l.prototype.onExpand=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"expand",callback:t})},l.prototype.shrink=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.compress()})},l.prototype.onShrink=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"shrink",callback:t})},l.prototype.show=function(){var e=this;return e.__prevent_showing?void(e.__pending_show=!0):void e.__SPI_whenRendered(function(){habla_window.show()})},l.prototype.onShow=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"show",callback:t})},l.prototype.overlay=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.theme.setInline(0),habla_window.end_popout()})},l.prototype.onOverlay=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"overlay",callback:t})},l.prototype.hide=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.hide()})},l.prototype.onHide=function(t){window.olark.__legacy_shim.disable_input_focusing=!0,e.listen_for_event({namespace:"box",type:"hide",callback:t})},l.prototype.popout=function(){habla_window.popout()},l.prototype.onPopout=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"popout",callback:t})},l.prototype.dismiss=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.close()})},l.prototype.onDismiss=function(t){window.olark.__legacy_shim.disable_input_focusing=!0,e.listen_for_event({namespace:"box",type:"dismiss",callback:t})},l.prototype.__SPI_disableUserInterface=function(){var e=document.getElementById("habla_beta_container_do_not_rely_on_div_classes_or_names");e.style.visibility="hidden",e.style.display="none"},l.prototype.__SPI_inline=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.theme.setInline(1)})},l.prototype.__SPI_onInline=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"inline",callback:t})},l.prototype.__SPI_injectStyleIntoPage=function(e){function t(){var t=document.getElementsByTagName("head")[0];t.insertBefore(e,t.firstChild)}/(Chrome)/.test(navigator.userAgent)?setTimeout(t,1e3):t()},l.prototype.__clear_message_history=function(){var t=this;t.__SPI_whenRendered(function(){e.run_legacy_code(function(e){e.habla_window.setBody("")})})},l.prototype.__renderWelcomeMessage=function(){function e(){return n.__keystore.get({key:"__box.welcomeMessage"})}function t(){var t=e();t&&n.__chat_api.sendMessageToVisitor({nickname:" ",body:t,__SPI_notification:!0}),n.__keystore.set({key:"__box.welcomeMessage",value:null,link_to_conversation:!0})}var n=this;e()&&(n.__chat_api.onReady(function(){window.hbl.config.vars.show_pre_chat?n.__chat_api.__SPI_onPrechatInfoReceived(t):t()}),n.__SPI_whenRendered(function(){var t=e();t&&(window.habla_window.theme.habla_pre_chat_span.innerHTML=t)}))},l.prototype.__SPI_setPrechatWelcomeMessage=function(t){var n=this;n.__keystore.set({key:"__box.welcomeMessage",value:t,link_to_conversation:!0}),e.trigger_event({namespace:"box",type:"prechatWelcomeMessage",body:t}),n.expand()},l.prototype.__SPI_onPrechatWelcomeMessage=function(t){e.listen_for_event({namespace:"box",type:"prechatWelcomeMessage",callback:t})},l.prototype.__SPI_showMessageHistory=function(){var e=this;e.__SPI_whenRendered(function(){return habla_window.config.vars.show_pre_chat?void(habla_window.theme.habla_offline_message_div.style.display="none"):(window.olark.__legacy_shim.ignore_prechat_status=!1,void e.__toggle_divs_by_id({show:["habla_chatform_form","habla_conversation_div"],hide:["olark-api-panel","habla_pre_chat_div","habla_offline_message_div"]}))})},l.prototype.__SPI_getLegacyState=function(e){var t=this.__keystore.get({key:"__box.legacyState"})||{box_open:!1,box_visible:!0};e(t)},l.prototype.__SPI_setLegacyState=function(e){this.__keystore.set({key:"__box.legacyState",value:e,link_to_conversation:!0})},l.prototype.__hide_dom=function(e){return"string"==typeof e&&(e=document.getElementById(e)),"object"==typeof e&&null!==e?(e.style.display="none",!0):!1},l.prototype.__show_dom=function(e){return"string"==typeof e&&(e=document.getElementById(e)),"object"==typeof e&&null!==e?(e.style.display="block",!0):!1},l.prototype.__toggle_divs_by_id=function(e){var t=this,n=e.show,i=e.hide;for(var o in n)if("function"!=typeof n[o]){var a=n[o];t.__show_dom(document.getElementById(a))}for(var r in i)if("function"!=typeof i[r]){var s=i[r];t.__hide_dom(document.getElementById(s))}},l.prototype.__SPI_whenRendered=function(e){olark("api.chat.onReady",e)},l.prototype.__SPI_hideForDuration=function(t){this.hide(),e.trigger_event({namespace:"box",type:"hideForDuration",duration:t})},l.prototype.__SPI_onHideForDuration=function(t){e.listen_for_event({namespace:"box",type:"hideForDuration",callback:t})},l.prototype.__SPI_hideBoxForThisPageOnly=function(){this.__SPI_whenRendered(function(){e.run_legacy_code(function(e){try{e.habla_window.theme.habla_window_div.style.visibility="hidden"}catch(n){t.warn("[olark] unable to hide the chatbox for this page",n)}})})},l.prototype.__SPI_setThemeTextField=function(t,n){n&&olark("api.chat.onReady",function(){e.run_legacy_code(function(e){var i=e.habla_window.theme[t];i.has_typed=!0,i.value=n})})},l.prototype.__setup_popout_behavior=function(){var t=this;window.onbeforeunload=function(){return!1};var o=function(){var o=i,a=n;parseInt(navigator.appVersion,10)>3&&(-1!=navigator.appName.indexOf("Microsoft")?(o=document.body.offsetWidth,a=document.body.offsetHeight):(o=window.innerWidth,a=window.innerHeight)),o&&a&&t.__SPI_whenRendered(function(){e.run_legacy_code(function(e){e.habla_window.config.setHeight(parseInt(a,10)-85),e.habla_window.setHeight(parseInt(a,10)-85),e.habla_window.setWidth(parseInt(o,10))})})};o(),window.onresize=o},l.prototype.__initialize_legacy_event_handlers=function(){function t(){habla_window.theme.habla_wcsend_input.disabled=!0,habla_window.theme.habla_wcsend_input.style.display="none",habla_window.theme.habla_wcsend_input.has_typed&&(habla_window.theme.habla_offline_body_input.value=habla_window.theme.habla_wcsend_input.value)}function n(){habla_window.theme.habla_wcsend_input.disabled=!1,habla_window.theme.habla_wcsend_input.style.display="block",habla_window.theme.habla_offline_body_input.has_typed&&(habla_window.theme.habla_wcsend_input.value=habla_window.theme.habla_offline_body_input.value)}var i=this;s||(s=!0,i.__chat_api.onOperatorsAway(t),i.__chat_api.onOperatorsBusy(t),i.__chat_api.onOperatorsAvailable(n),i.__SPI_whenRendered(function(){olark._.P("box")}),u.eventmgr.register("chat_loaded",function(){r=!0},0),u.eventmgr.register("habla_window_changed",function(t){if(r)switch(t.type){case"popout":e.trigger_event({namespace:"box",type:"popout"});break;case"endpop_out":e.trigger_event({namespace:"box",type:"popin"});break;case"show":a||(a=!0,e.trigger_event({namespace:"box",type:"show"}));break;case"hide":a=!1,e.trigger_event({namespace:"box",type:"hide"});break;case"compress":o=!1,e.trigger_event({namespace:"box",type:"shrink"});break;case"expand":o||(o=!0,e.trigger_event({namespace:"box",type:"expand"}))}},0),u.eventmgr.register("habla_closebutton_a_onclick",function(){e.trigger_event({namespace:"box",type:"dismiss"})},0))},l.prototype.__populate_message_history_from_chat_api=function(){var t=this;t.__SPI_whenRendered(function(){var n=t.__chat_api.__SPI_getMessageHistory(),i=0;for(n.length>0&&e.run_legacy_code(function(e){e.habla_window.theme.setBody("")});i<n.length;){var o=n[i++],a=o.nickname||"you",r=o.body;e.run_legacy_code(function(e){/^\s+$/.test(r)||e.habla_window.theme.appendNiceMessage(a,r,!0,!0)})}var s=function(){var e=window.habla_window.theme.habla_conversation_div;e.scrollHeight?e.scrollTop=e.scrollHeight:setTimeout(s,100)};s()})},l.prototype.__setup_chat_history_handling=function(){var t=this;_||(_=!0,t.__chat_api.onReady(function(){t.__populate_message_history_from_chat_api(),t.__chat_api.__SPI_populatedLocalChatHistoryFromRpcServer()&&t.expand()}),t.__chat_api.__SPI_onDeliveryOfMessageFromVisitor(function(t){e.run_legacy_code(function(e){var n=e.hbl.config.vars.myname||"you";e.habla_window.theme.appendNiceMessage(n,t.message.body,!0,!0)})}),t.__chat_api.__SPI_onDeliveryOfMessageFromOperator(function(t){e.run_legacy_code(function(e){e.habla_window.theme.appendNiceMessage(t.message.nickname,t.message.body,!0,!0)})}))},olark.declare({name:"__BoxApiHelper",startup:function(t,n){var i=t.data.getConversationObject({key:"visible",initialValue:n.box.start_hidden?!1:null}),o=t.data.getConversationObject({key:"state",initialValue:null}),a=t.data.getConversationObject({key:"close_hides_window",initialValue:!1}),r=t.data.getConversationObject({key:"hidden_for_visit",initialValue:!1}),s=t.data.getVisitorObject({key:"hidden_for_visitor",initialValue:!1}),_=t.data.getConversationObject({key:"auto_messages",initialValue:[]}),l=function(){window.olark.__legacy_shim.box_visible=i.get(),window.olark.__legacy_shim.box_state=o.get()},c=!n.system.hide_not_available||n.system.offline_msg_mode;c||t.chat.onOperatorsAway(function(){t.visitor.getDetails(function(e){e.isConversing||t.box.hide()})});var d=a.get()===!0&&"closed"===o.get()||r.get()===!0||s.get()===!0;d&&(t.box.hide(),l()),t.chat.onReady(function(){e.run_legacy_code(function(e){a.set(e.hbl.config.vars.close_hides_window?!0:!1)})}),t.box.onDismiss(function(){i.set(!1),o.set("closed"),l()}),t.box.onExpand(function(){i.set(!0),o.set("expanded"),l()}),t.box.onShrink(function(){i.set(!0),o.set("compressed"),l()}),t.box.onOverlay(function(){i.set(!0),l()}),t.box.onPopout(function(){i.set(!1),o.set("closed"),l()}),t.box.onHide(function(){i.set(!1),l()}),t.chat.onOperatorsAway(function(){n.system.hide_when_offline&&t.box.hide()}),t.chat.onOperatorsAvailable(function(){n.system.hide_when_offline&&t.box.show()}),t.box.__SPI_onInline(function(){i.set(!0),l()}),t.box.__SPI_onHideForDuration(function(e){var t=e.duration;t.forVisit?r.set(!0):t.forVisitor&&s.set(!0),i.set(!1),o.set("closed"),l()});var h=function(){r.set(!1),s.set(!1)};t.box.__SPI_whenRendered(function(){t.box.onShow(h),t.box.onExpand(h),t.box.onPopout(h),t.box.onOverlay(h)}),l(),t.chat.onMessageToVisitor(function(){t.box.expand()}),t.chat.onOperatorsAvailable(function(){t.box.__SPI_showMessageHistory()}),window.olark.__legacy_shim.populate_message_history_from_chat_api=function(){t.box.__populate_message_history_from_chat_api()},t.box.__SPI_onPrechatWelcomeMessage(function(e){var t=_.get();t.push(e.body),_.set(t)}),t.chat.onBeginConversation(function(e){var n=_.get().slice(0);n.length>0&&"visitor_msg"==e.__spi_message_type&&t.chat.sendNotificationToOperator({body:["visitor is replying to these automated messages:","  >> "+n.join("\n  >> ")].join("\n")})})}}),olark.extend("__BoxApiHelper"),e.box={BoxApi:l}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return e.framestorewithjson&&e.data&&window.olark.__legacy_shim.legacy_post_stub_is_loaded},function(){function n(e){function t(e){var t=typeof e;return"object"===t&&(e?"number"!=typeof e.length||e.propertyIsEnumerable("length")||"function"!=typeof e.splice||(t="array"):t="null"),t}return"array"==t(e)}var i=.25,o=/^\s*\!\s*([^\s]+)\s*((.*)\s*)?/,a=1001,r=9999,s=250,_=260,l=270,c=300,d="INTERNAL_NOTIFICATION",h=1e3,p=3e3,f=120,g=600,m=["VisitorImportance","Shopify","CartSaver"],v=" | ",b="\n| ",y=!1,w=!1,k=!1,x=null,S=!1,I=!1,C=!1,T=!1,P={},M=function(){var t=this;t.__message_sending_failsafe_timeout=null,t.__nickname_update_pending=!1,t.__status_update_pending=!1,t.__message_queue=[],t.__notification_queue=[],t.__keystore=new e.data.StorejsKeyStore,t.__connection_wrapper=null,t.__all_extensions_have_run_their_startup_method=!1,t.__sync_pipeline=[],t.__sync_pipeline_is_draining=!1};!function(n){var i=null;M.get_instance=function(){return i||(i=new M),i};var o=!1,a=function(t){o?t():e.listen_for_event({namespace:"SessionConnection",type:"afterReady",callback:function(){o=!0,t()}})};n.get_local_data=function(e){var t=this;return t.__local_get(e)},n.put_local_data=function(e){var t=this;return t.__local_set(e)},n.send_message=function(t){var n=this;if("undefined"==typeof t.body)throw new Error("[olark] 'body' required");n.__message_queue.push(t.body),1==n.__message_queue.length&&e.do_async_call({delay:l},function(){n.__synchronize_with_jabber()})},n.send_notification=function(t){var n=this;if("undefined"==typeof t.body)throw new Error("[olark] 'body' required");n.__notification_queue.push(t.body),1==n.__notification_queue.length&&e.do_async_call({delay:c},function(){n.__synchronize_with_jabber()})},n.update_nickname_for_extension=function(e){var t=this;if("undefined"==typeof e.extension_name)throw new Error("[olark] 'extension_name' required");if("undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");var n=e.extension_name,i=e.snippet,o=e.hides_default_nickname,a=t.__local_get({key:"nickname_lookup"})||{};a[n]={snippet:i,hides_default_nickname:o,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature},t.__local_set({key:"nickname_lookup",value:a}),t.__mark_nickname_update_pending()},n.__mark_nickname_update_pending=function(t){var n=this;n.__nickname_update_pending||(n.__nickname_update_pending=!0,e.do_async_call({delay:s},function(){n.__synchronize_with_jabber(t)})),n.__mark_status_update_pending(!0)},n.update_status_for_extension=function(e){var t=this;if("undefined"==typeof e.extension_name)throw new Error("[olark] 'extension_name' required");if("undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");var n=t.__local_get({key:"status_lookup"})||{};n[e.extension_name]={snippet:e.snippet,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature},t.__local_set({key:"status_lookup",value:n}),t.__mark_status_update_pending()
},n.__mark_status_update_pending=function(t){var n=this;n.__status_update_pending||(n.__status_update_pending=!0,e.do_async_call({delay:_},function(){n.__synchronize_with_jabber(void 0,t)}))},n.disconnect=function(){var t=this;e.run_legacy_code(function(e){e.hbl.client.sendcommand&&e.hbl.client.sendcommand("disconnectchat",t.__enableMessageToBeRoutedToGroupIfNecessary(""))})},n.getGroupForThisPage=function(){return this.__groupIdString},n.lockToGroupForThisPage=function(e){var t=this;olark.__legacy_shim.currentGroupIdstring=t.__groupIdString=e},n.unlockFromGroupForThisPage=function(){var e=this;olark.__legacy_shim.currentGroupIdstring=e.__groupIdString={}.undefinedValue},n.__TMP_set_connection_wrapper=function(e){var t=this;t.__connection_wrapper=e,t.__with_open_connection(function(){t.__all_extensions_have_run_their_startup_method=!0,t.__synchronize_with_jabber()})},n.__TMP_get_current_combined_nickname=function(){var t=this,n=t.__local_get({key:"nickname_lookup"})||{},i=[],o=!0,a=function(e){return{v:e.snippet,t:e.secureTimestamp,s:e.secureSignature}};return e.for_each_extension_name_starting_with_most_recent(function(e){var t=n[e],r=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1},s=function(t){r(m,e)?i.unshift(t):i.push(t)};t&&"function"!=typeof t&&t.snippet&&t.snippet.length>0&&(t.hides_default_nickname&&(o=!1),s(a(t)))}),(o||0===i.length)&&i.push(a({snippet:t.__get_default_nickname_snippet()})),e.framestorewithjson.json.encode(i)},n.__TMP_get_current_combined_status=function(){var n=this,i=n.__local_get({key:"status_lookup"})||{},o=[],a=function(e){return{v:e.snippet,t:e.secureTimestamp,s:e.secureSignature}};return e.for_each_extension_name_starting_with_most_recent(function(e){try{var n=i[e];n&&"function"!=typeof n&&o.unshift(a(n))}catch(r){t.error("[olark] problem setting status: "+r.toString()),t.showErrorBacktrace(r)}}),0===o.length&&(o=[{v:"There is no status information available right now.\n Add custom information using the Javascript API (www.olark.com/docs)."}]),o.unshift({v:"{{nickname}}"}),e.framestorewithjson.json.encode(o)},n.__enableMessageToBeRoutedToGroupIfNecessary=function(e){if("string"!=typeof e)throw new Error("[olark] message must be a string");return e},n.__get_default_nickname_snippet=function(){var e=this,t=e.__local_get({key:"default_nickname"})||null;return t||(t="{{geolocation}} #"+Math.floor(1e4*Math.random()).toString(),e.__local_set({key:"default_nickname",value:t})),t},n.__local_get=function(e){var t=this;if("undefined"==typeof e.key)throw new Error("'key' required");var n=t.__keystore.get({key:"sessconn"})||{};return n[e.key]||null},n.__local_set=function(e){var t=this;if("undefined"==typeof e.key)throw new Error("'key' required");var n=t.__keystore.get({key:"sessconn"})||{};n[e.key]=e.value,t.__keystore.set({key:"sessconn",value:n,link_to_conversation:!0})},n.__update_nickname_in_jabber=function(t){var n=this;a(function(){n.__local_set({key:"has_sent_initial_nickname",value:!0}),n.__nickname_update_pending=!1;var i=n.__TMP_get_current_combined_nickname(),o=n.__local_get({key:"previous_nickname"})!=i;n.__local_set({key:"previous_nickname",value:i}),(o||t)&&e.run_legacy_code(function(e){e.hbl.client.setnickname(n.__enableMessageToBeRoutedToGroupIfNecessary(i))})})},n.__update_status_in_jabber=function(t){var n=this;a(function(){n.__local_set({key:"has_sent_initial_status",value:!0}),n.__status_update_pending=!1;var i=n.__TMP_get_current_combined_status(),o=n.__local_get({key:"previous_status"})!=i;n.__local_set({key:"previous_status",value:i}),(o||t)&&e.run_legacy_code(function(e){var t="chat";e.hbl.client.sendpresence(n.__enableMessageToBeRoutedToGroupIfNecessary(i),t)})})};var r=function(e){if("undefined"==typeof e.list)throw new Error("'list' required");for(var t={},n=e.list,i=[],o=0;o<n.length;o++){var a=n[o];t[a]||(t[a]=!0,i.push(a))}return i};n.__dequeue_messages_into_jabber=function(){var n=this;a(function(){var i=n.__message_queue;n.__message_queue=[];var o=r({list:i});o.length!=i.length&&t.warn("[olark] message batch contains",i.length-o.length,"duplicate messages");var a=null;i.length>0&&(a=e.join_string_list({list:o,separator:"\n"})),a&&n.__sendmessage(a,!1)})},n.__dequeue_notifications_into_jabber=function(){var n=this,i=n.__notification_queue;n.__notification_queue=[],e.run_legacy_code(function(){var o=r({list:i});o.length!=i.length&&t.warn("[olark] notification batch contains",i.length-o.length,"duplicate notifications");var a=null;i.length>1?a="[info]\n  - "+e.join_string_list({list:o,separator:"\n  - "}):1==i.length&&(a="[info] "+i[0]),a&&n.__sendmessage(a,!0)})},n.__sendmessage=function(t,n){var i=this,o=i.__local_get({key:"sentmessage"})?!1:!0;e.run_legacy_code(function(e){e.hbl.client.sendmessage(i.__enableMessageToBeRoutedToGroupIfNecessary(t),n?!0:!1,n?!0:{}.undefinedValue,o,i.__TMP_get_current_combined_nickname(),i.__TMP_get_current_combined_status())}),i.__local_set({key:"sentmessage",value:!0})},n.__synchronize_with_jabber=function(e,t){var n=this,i=n.__nickname_update_pending,o=n.__status_update_pending,a=n.__notification_queue.length>0?!0:!1,r=n.__message_queue.length>0?!0:!1,s=n.__local_get({key:"has_sent_initial_nickname"}),_=n.__local_get({key:"has_sent_initial_status"});n.__all_extensions_have_run_their_startup_method&&(s||(i=!0),_||(o=!0));var l=s,c=_;n.__force_nickname_update=n.__force_nickname_update||e,n.__force_status_update=n.__force_status_update||t;var d=n.__sync_pipeline;i&&!n.__nickname_update_queued&&(l=!0,n.__nickname_update_queued=!0,d.push(function(){var e=n.__force_nickname_update;n.__nickname_update_queued=!1,n.__force_nickname_update=!1,n.__update_nickname_in_jabber(e)})),o&&!n.__status_update_queued&&(l?(c=!0,n.__status_update_queued=!0,d.push(function(){var e=n.__force_status_update;n.__status_update_queued=!1,n.__force_status_update=!1,n.__update_status_in_jabber(e)})):n.__trigger_message_sending_failsafe()),a&&(c?d.push(function(){n.__dequeue_notifications_into_jabber()}):n.__trigger_message_sending_failsafe()),r&&(c?d.push(function(){n.__dequeue_messages_into_jabber()}):n.__trigger_message_sending_failsafe()),n.__drain_sync_pipeline()},n.__drain_sync_pipeline=function(){var n=this,i=n.__sync_pipeline,o=function(){if(i.length>0){var a=i.shift();e.try_and_optionally_catch(function(){a()},function(e){t.error("[olark] problem servicing SessionConnection pipeline: "+e.toString()),t.showErrorBacktrace(e)})}i.length>0?e.do_async_call({delay:h},o):n.__sync_pipeline_is_draining=!1};n.__sync_pipeline_is_draining===!1&&(n.__sync_pipeline_is_draining=!0,o())},n.__with_open_connection=function(e){var t=this;t.__connection_wrapper(e)},n.__trigger_message_sending_failsafe=function(){var t=this,n=t.__local_get({key:"has_sent_initial_nickname"}),i=t.__local_get({key:"has_sent_initial_status"});t.__message_sending_failsafe_timeout||(t.__message_sending_failsafe_timeout=e.do_async_call({delay:p},function(){n&&i||(n=!0,i=!0,t.__synchronize_with_jabber())}))}}(M.prototype);var A=function(e){var n=this;if(n.__legacy_message_tuple=e.legacy_message_tuple,"undefined"==typeof n.__legacy_message_tuple)throw new Error("'legacy_message_tuple' required");if("undefined"==typeof e.send_event_type)throw new Error("'send_event_type' required");if("undefined"==typeof e.deliver_event_type)throw new Error("'send_event_type' required");if("undefined"==typeof e.final_delivery_action)throw new Error("'final_delivery_action' required");n.__send_event_type=e.send_event_type,n.__deliver_event_type=e.deliver_event_type,n.__final_delivery_action=e.final_delivery_action,n.__delivered=!1,n.__predelivery_actions=[],n.__new_body=null,n.__SPI_notification=e.__SPI_notification,n.__message_event={namespace:"chat",type:n.__send_event_type,automated:e.is_automated?!0:!1,__SPI_notification:e.__SPI_notification,nickname:n.__legacy_message_tuple[0],body:n.__legacy_message_tuple[1],__legacy_sequence_id:parseFloat(n.__legacy_message_tuple[2]),__SPI_deferMessageDelivery:function(e){n.__predelivery_actions.push(e)},updateBody:function(e){n.__new_body&&t.warn("[olark] two handlers tried to modify the body of the same message, allowing the second one to override"),n.__new_body=e}},n.__original_body=window.olark.__core.clone_object(n.__message_event.body)};!function(n){n.get_processed_body=function(){var e=this;return e.__new_body||e.__message_event.body},n.send=function(){var t=this;e.trigger_event(t.__message_event)},n.deliver=function(){for(var t=this,n=[],i=function(){n[o]=!0;for(var e=n.length,i=!0;e--;)n[e]||(i=!1);i&&t.__trigger_delivery()},o=t.__predelivery_actions.length;o--;)n.push(!1);for(o=t.__predelivery_actions.length,e.listen_for_event({namespace:"chat::Message",type:"doneDeferringMessageDelivery",callback:i});o--;)!function(t,i){i({deliverMessage:function(){n[t]=!0,e.trigger_event({namespace:"chat::Message",type:"doneDeferringMessageDelivery"})}})}(o,t.__predelivery_actions[o]);i()},n.__trigger_delivery=function(){var n=this;n.__delivered||(n.__delivered=!0,n.__original_body!=n.__message_event.body&&t.warn("[olark] you cannot modify the 'body' attribute of messages directly, please use message.updateBody() to modify the body"),e.trigger_event({namespace:"chat",type:n.__deliver_event_type,automated:n.__message_event.automated,nickname:n.__message_event.nickname,body:n.get_processed_body(),__legacy_sequence_id:parseFloat(n.__message_event.__legacy_sequence_id)}),n.__final_delivery_action())}}(A.prototype);var E=function(e){function t(e){return"true"==e?!0:!1}function n(e){return"null"==e?null:e}var i=this;if(i.__conf=e.conf,"undefined"==typeof i.__conf)throw new Error("'conf' required");if(i.__extension_name=e.extension_name,"undefined"==typeof i.__extension_name)throw new Error("'extension_name' required");i.__data=new window.olark.__core.data.DataApi({namespace:"__chatd"}),i.__last_incr_seq_id=i.__data.getConversationObject({key:"last_incr_seq_id",initialValue:0,backup:"cd1",backupTransform:parseFloat}),i.__last_leg_seq_id=i.__data.getConversationObject({key:"last_leg_seq_id",initialValue:0,backup:"cd2",backupTransform:parseFloat}),i.__is_conversing=i.__data.getConversationObject({key:"is_conversing",initialValue:!1,backup:"cd3",backupTransform:t}),i.__hasconnected=i.__data.getConversationObject({key:"hasconnected",initialValue:!1,backup:"cd4",backupTransform:t}),i.__data_history=i.__data.getConversationObject({key:"data_history",initialValue:!1}),i.__last_op_presence=i.__data.getConversationObject({key:"last_op_presence",initialValue:"away",backup:"cd5",backupTransform:n}),i.__last_cmd_seq_id=i.__data.getConversationObject({key:"last_cmd_seq_id",initialValue:0,backup:"cd6",backupTransform:parseFloat}),i.__last_presence=i.__data.getConversationObject({key:"last_presence",initialValue:"chat",backup:"cd8",backupTransform:n}),i.__is_connection_upgraded=i.__data.getConversationObject({key:"is_connection_upgraded",initialValue:!1}),i.__is_ended=i.__data.getConversationObject({key:"is_ended",initialValue:!1}),i.__next_conversation_id=i.__data.getConversationObject({key:"next_conversation_id",initialValue:null}),i.__needsToDoPrechat=i.__data.getConversationObject({key:"needs_prechat",initialValue:null}),i.__SPI_onPrechatInfoReceived(function(){i.__needsToDoPrechat.set(!1)}),i.onReady(function(){null===i.__needsToDoPrechat.get()&&i.__needsToDoPrechat.set(u.config.vars.show_pre_chat?!0:!1)}),i.onBeginConversation(function(){i.__needsToDoPrechat.set(!1)}),i.__initialize_legacy_connection_and_messaging_handlers(),i.__initialize_legacy_history_tracking(),i.__initialize_conversation_tracking(),i.__has_local_history=!0,i.__conversation_message_history=[],i.__session_connection=M.get_instance(),i.__session_connection.__TMP_set_connection_wrapper(function(e){i.__wait_for_chat_to_connect(e)})};!function(){var n=E.prototype;E.prototype.listen=function(n,i){t.warn("[olark] api.chat.listen is deprecated, please use api.chat.on<METHOD> instead"),e.listen_for_event({namespace:"chat",type:n,callback:i})},n.onMessageFromVisitor=function(e){var n=this;return t.warn("[olark] api.chat.onMessageFromVisitor is deprecated, please use api.chat.onMessageToOperator instead"),n.onMessageToOperator(e)},n.onMessageFromOperator=function(e){var n=this;return t.warn("[olark] api.chat.onMessageFromOperator is deprecated, please use api.chat.onMessageToVisitor instead"),n.onMessageToVisitor(e)},n.getNickname=function(){var e=this;return t.warn("[olark] api.chat.getNickname is deprecated, please use api.chat.getVisitorNickname instead"),e.getVisitorNickname()},n.sendAutomatedMessageToVisitor=function(e){var n=this;return t.warn("[olark] api.chat.sendAutomatedMessageToVisitor is deprecated, please use api.chat.sendMessageToVisitor instead"),n.sendMessageToVisitor(e)},n.updateNickname=function(e){var n=this;return t.warn("[olark] api.chat.updateNickname is deprecated, please use api.chat.updateVisitorNickname instead"),n.updateVisitorNickname(e)},n.onConnectComplete=function(e){var n=this;return t.warn("[olark] api.chat.onConnectComplete is deprecated, please use api.chat.onReady instead"),n.onReady(e)}}(),E.prototype.updateVisitorNickname=function(e){e=e||{};var i=this;if(e.nickname&&(e.snippet=e.nickname,t.warn("[olark] giving 'nickname' as an argument to updateVisitorNickname is now deprecated, use 'snippet' instead")),"string"==typeof e&&(e={snippet:e}),"undefined"==typeof e.snippet)return t.warn("[olark] 'snippet' required"),!1;if(n(e.snippet)){if(e.secureTimestamp||e.secureSignature)throw new Error("[olark] you cannot give a list of snippets and also security information, please join the snippets yourself before signing them");e.snippet=e.snippet.join(v)}i.__session_connection.update_nickname_for_extension({extension_name:e.source||i.__extension_name,snippet:e.snippet,hides_default_nickname:e.hidesDefault?!0:!1,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature})},E.prototype.getVisitorNickname=function(n){n=n||{};var i=this;n.other&&t.warn("[olark] giving 'other' as an argument to getVisitorNickname is now deprecated, this method only returns the entire nickname"),n.combined&&t.warn("[olark] giving 'combined' as an argument to getVisitorNickname is now deprecated, this method only returns the entire nickname");for(var o=i.__session_connection.__TMP_get_current_combined_nickname(),a=e.framestorewithjson.json.decode(o),r=[],s=0;s<a.length;s++)r.push(a[s].v);return r.length?r.join(v):null},E.prototype.updateVisitorStatus=function(e){e=e||{};var i=this;if(e.status&&(e.snippet=e.status,t.warn("[olark] giving 'status' as an argument to updateVisitorStatus is now deprecated, use 'snippet' instead")),"string"==typeof e&&(e={snippet:e}),"undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");if(n(e.snippet)){if(e.secureTimestamp||e.secureSignature)throw new Error("[olark] you cannot give a list of snippets and also security information, please join the snippets yourself before signing them");e.snippet=e.snippet.join(b)}i.__session_connection.update_status_for_extension({extension_name:i.__extension_name,snippet:e.snippet,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature})},E.prototype.getVisitorStatus=function(n){n=n||{};var i=this;n.other&&t.warn("[olark] giving 'other' as an argument to getVisitorStatus is now deprecated, this method only returns the entire status"),n.combined&&t.warn("[olark] giving 'combined' as an argument to getVisitorStatus is now deprecated, this method only returns the entire status");for(var o=i.__session_connection.__TMP_get_current_combined_status(),a=e.framestorewithjson.json.decode(o),r=[],s=0;s<a.length;s++)r.push(a[s].v);return r.length?r.join(b):null},E.prototype.sendNotificationToOperator=function(t){var n=this,i=null;if(i="string"==typeof t?t:t.body,!i)throw new Error("body required");n.__wait_for_chat_to_connect(function(){e.trigger_event({namespace:"chat",type:"notificationToOperator",body:i,after:function(){n.__session_connection.send_notification({body:i})}})})},E.prototype.sendMessageFromVisitor=function(t){var n=this,i=null;if(i="string"==typeof t?t:t.body,!i)throw new Error("body required");n.__wait_for_chat_to_connect(function(){e.trigger_event({namespace:"chat",type:"messageFromVisitor",body:i,after:function(){n.__session_connection.send_message({body:i})}})})},E.prototype.onNotificationToOperator=function(t){e.listen_for_event({namespace:"chat",type:"notificationToOperator",callback:function(e){t({notification:{body:e.body}})}})},E.prototype.sendNotificationToVisitor=function(e){var t=this;t.sendMessageToVisitor({nickname:d,body:e.body,__SPI_notification:!0})},E.prototype.__SPI_sendInterfaceElementToVisitor=function(e){var t=this,n=d+"-"+t.__extension_name+"-"+e.key;t.sendMessageToVisitor({nickname:n,body:"...",__SPI_notification:!0})},E.prototype.__SPI_onInterfaceElementReady=function(t){var n=this;e.listen_for_event({namespace:"chat",type:"interfaceElementReady",callback:function(e){e.extensionName===n.__extension_name&&t({key:e.key,dom:e.dom})}})},E.prototype.__get_next_message_sequence_id_that_is_server_safe=function(){var e=this,t=e.__last_leg_seq_id.get(),n=parseFloat(t),o=e.__last_incr_seq_id.get(),a=parseFloat(o),r=null;return t!=n&&(olark._.hlog("last_legacy_sequence_id was not a float:",t,"#non_int_legseq_id #warn"),t=n||0),o!=a&&(olark._.hlog("last_incremented_sequence_id was not a float:",o,"#non_int_incrseq_id #warn"),o=a||0),r=t>=o?t+i:o+i,e.__last_incr_seq_id.set(r),r},E.prototype.onNotificationToVisitor=function(t){e.listen_for_event({namespace:"chat",type:"messageFromOperator",callback:function(e){e.nickname==d&&t({notification:{body:e.body}})}})},E.prototype.sendMessageToVisitor=function(t){var n=this,i=t.nickname,o=t.body,a=t.skipPrechatSurvey?!0:!1;if(!o)throw new Error("body required");var r=t.automated===!1?!1:!0;a||n.__needsToDoPrechat.get()!==!0?n.__wait_for_chat_to_connect(function(){e.run_legacy_code(function(e){i||(i=e.hbl.client.current_operator()||" "),n.__send_and_deliver_message_from_operator({legacy_message_tuple:[i,o,n.__get_next_message_sequence_id_that_is_server_safe()],is_automated:r,__SPI_notification:t.__SPI_notification})})}):olark("api.box.__SPI_setPrechatWelcomeMessage",o)},E.prototype.onMessageToVisitor=function(t){e.listen_for_event({namespace:"chat",type:"messageFromOperator",callback:function(e){t({message:{nickname:e.nickname,body:e.body,updateBody:function(t){e.updateBody(t)},__SPI_deferMessageDelivery:function(t){e.__SPI_deferMessageDelivery(t)},automated:e.automated,__SPI_notification:e.__SPI_notification}})}})},E.prototype.onMessageToOperator=function(t){e.listen_for_event({namespace:"chat",type:"messageFromVisitor",callback:function(e){t({message:{nickname:e.nickname,body:e.body,updateBody:function(t){e.updateBody(t)},__SPI_deferMessageDelivery:function(t){e.__SPI_deferMessageDelivery(t)}}})}})},E.prototype.onOfflineMessageToOperator=function(t){e.listen_for_event({namespace:"chat",type:"offlineMessageToOperator",callback:function(e){t({message:{nickname:e.message.nickname,body:e.message.body}})}})},E.prototype.onCommandFromOperator=function(t){e.listen_for_event({namespace:"chat",type:"commandFromOperator",callback:function(e){t({command:{name:e.name,body:e.body,nickname:e.nickname}})}})},E.prototype.__SPI_onDeliveryOfMessageFromVisitor=function(t){e.listen_for_event({namespace:"chat",type:"deliveryOfMessageFromVisitor",callback:function(e){t({__legacy_sequence_id:parseFloat(e.__legacy_sequence_id),message:{nickname:e.nickname,body:e.body}})}})},E.prototype.__SPI_onDeliveryOfMessageFromOperator=function(t){e.listen_for_event({namespace:"chat",type:"deliveryOfMessageFromOperator",callback:function(e){t({__legacy_sequence_id:parseFloat(e.__legacy_sequence_id),message:{nickname:e.nickname,body:e.body}})}})},E.prototype.operatorsAreAvailable=function(){return"available"==x},E.prototype.onOperatorsAvailable=function(t){e.listen_for_event({namespace:"chat",type:"operatorsAvailable",callback:t})},E.prototype.operatorsAreBusy=function(){return"busy"==x},E.prototype.onOperatorsBusy=function(t){e.listen_for_event({namespace:"chat",type:"operatorsBusy",callback:t})},E.prototype.operatorsAreAway=function(){return"away"==x},E.prototype.onOperatorsAway=function(t){e.listen_for_event({namespace:"chat",type:"operatorsAway",callback:t})},E.prototype.__SPI_onConnectBegin=function(t){e.listen_for_event({namespace:"chat",type:"connectBegin",callback:t})},E.prototype.setOperatorGroup=function(t){this.__SPI_lockToOperatorGroup(t.group||t),e.trigger_event({namespace:"chat",type:"operatorGroupChanging"}),this.onReady(function(){u.client.eventmgr.register("handled_nrpc_response",function(){e.trigger_event({namespace:"chat",type:"operatorGroupChanged"}),u.client.eventmgr.unregister_all("handled_nrpc_response")}),u.client.sendcommand("return_long_poll_now","")})},E.prototype.__SPI_onOperatorGroupChanging=function(t){e.listen_for_event({namespace:"chat",type:"operatorGroupChanging",callback:t})},E.prototype.__SPI_onOperatorGroupChanged=function(t){e.listen_for_event({namespace:"chat",type:"operatorGroupChanged",callback:t})},E.prototype.__SPI_lockToOperatorGroup=function(e){olark._.cookieManager.setAllowingNullAndUndefinedAndEmptyString("_okgid",e),this.__session_connection.lockToGroupForThisPage(e)},E.prototype.__SPI_lockToExistingOperatorGroupIfGiven=function(e){var t=olark._.cookieManager.getAllowingNullAndUndefinedAndEmptyString("_okgid");this.__session_connection.lockToGroupForThisPage(t||null===t?t:e)},E.prototype.__SPI_unlockFromCurrentGroup=function(){olark._.cookieManager.erase("_okgid"),this.__session_connection.unlockFromGroupForThisPage()},E.prototype.onReady=function(e){this.__wait_for_chat_to_connect(e)},E.prototype.whenDataReady=function(t){S?t():e.listen_for_event({namespace:"chat",type:"dataReady",callback:t})},E.prototype.connect=function(){var e=this;e.__SPI_connectToRpcServers()},E.prototype.__SPI_onConnectFailure=function(t){e.listen_for_event({namespace:"chat",type:"connectFailure",callback:t})},E.prototype.__wait_for_chat_to_connect=function(t){if(w)t();else{var n=e.create_idempotent_callback(t);e.listen_for_event({namespace:"chat",type:"onReady",callback:n})}},E.prototype.__SPI_visitorIsAvailable=function(){var e=this,t=e.__last_presence.get();return"chat"==t},E.prototype.__SPI_visitorIsBusy=function(){var e=this,t=e.__last_presence.get();return"dnd"==t},E.prototype.__SPI_visitorIsAway=function(){var e=this,t=e.__last_presence.get();return"away"==t},E.prototype.__SPI_isConversing=function(){var e=this;return e.__is_conversing.get()===!0?!0:!1},E.prototype.__SPI_beginConversation=function(t){var n=this;n.__is_conversing.get()!==!0&&(n.__is_conversing.set(!0),e.trigger_event({namespace:"chat",type:"beginConversation",__spi_message_type:t}))},E.prototype.__SPI_onConversationBegin=function(t){e.listen_for_event({namespace:"chat",type:"beginConversation",callback:t})},E.prototype.__SPI_endConversation=function(){var e=this;e.__is_conversing.set(!1)},E.prototype.__SPI_onConversationEnd=function(t){e.listen_for_event({namespace:"chat",type:"endConversation",callback:t})},E.prototype.__SPI_onEndedStateChanged=function(t){var n=this;e.listen_for_event({namespace:"chat",type:"endedStateChange",callback:function(){n.__SPI_getEndedState(t)}})},E.prototype.__SPI_getEndedState=function(e){e({is_ended:this.__is_ended.get(),next_conversation_id:this.__next_conversation_id.get(),is_conversing:this.__SPI_isConversing()})},E.prototype.onBeginConversation=function(t){e.listen_for_event({namespace:"chat",type:"beginConversation",callback:t})},E.prototype.__initialize_conversation_tracking=function(){var e=this;e.onMessageToOperator(function(t){t.message.__SPI_notification!==!0&&e.__SPI_beginConversation("visitor_msg")}),e.onMessageToVisitor(function(t){t.message.__SPI_notification!==!0&&e.__SPI_beginConversation("operator_msg")})},E.prototype.__SPI_getConversationUUID=function(){return olark._.identityManager.getConversationId()},E.prototype.__SPI_getVisitorUUID=function(){return olark._.identityManager.getVisitorId()},E.prototype.__SPI_getLegacyConfig=function(){return e.run_legacy_code(function(e){return e.hbl.config})},E.prototype.__SPI_queryCurrentGroup=function(e){e({group:this.__session_connection.getGroupForThisPage()})},E.prototype.__SPI_disableEventConnection=function(){T=!0},E.prototype.__SPI_enableEventConnection=function(){T=!1},E.prototype.__SPI_getLegacySiteId=function(){return olark._.identityManager.getSiteId()},E.prototype.__SPI_sendRawMessageToVisitor=function(t){var n=this,i=t.body,o=t.nickname,a=[o,i,n.__get_next_message_sequence_id_that_is_server_safe()];e.run_legacy_code(function(e){e.hbl.client.incoming_pipeline.run(a)})},E.prototype.__SPI_sendRawMessageToOperator=function(e){var t=this,n=e.body;t.__send_and_deliver_message_from_visitor({legacy_message_tuple:[null,n,0]})},E.prototype.__handleHighTrafficConfiguration=function(e){var t=this;if(t.__is_connection_upgraded.get()!==!0&&e.system&&e.system.forced_polling_in_seconds_when_online_but_not_chatting){var n=e.system.forced_polling_in_seconds_when_online_but_not_chatting,i=u.client.pollingmanager.getMinAvailablePollTime();u.client.pollingmanager.setMinAvailablePollTime(1e3*n);var o=function(){t.__is_connection_upgraded.get()||(t.__is_connection_upgraded.set(!0),u.client.pollingmanager.setMinAvailablePollTime(i),u.client.pollingmanager.startNextPollNow())};u.eventmgr.register("habla_window_changed",function(e){"expand"===e.type&&o()}),olark("api.box.onExpand",o)}},E.prototype.__SPI_connectToRpcServers=function(e){e=e||{};var n=this,i=n.__conf;if(k!==!0)if(k=!0,n.__hasconnected.set(!0),olark._.P("getconnection"),n.onReady(function(){olark._.P("connection")}),T);else{window.hblJavaScriptVersion="api-1.2.1",window.hbl_hostname=i.system.legacy_rpc_server||window.hbl_hostname||"olark.com/rpc",window.hbl.config=window.wc_config();var o=window.hbl.config;o.vars.no_system_messages=!0,o.vars.disable_rpc_state=!0,"chatting"==i.system.show_in_buddy_list&&"undefined"==typeof i.system.forced_polling_in_seconds_when_online_but_not_chatting&&(i.system.forced_polling_in_seconds_when_online_but_not_chatting=300),n.__handleHighTrafficConfiguration(i),i.system.path&&(o.vars.cookie_path=i.system.path,o.vars.hbl_cookie_path=i.system.path),i.system.disable_offline_messaging_fallback&&olark._.hlog("used #disable_offline_messaging_fallback flag");for(var a in i.system)"function"!=typeof i.system[a]&&(o.vars[a]=i.system[a]);for(var r in i.box)"function"!=typeof i.box[r]&&(o.vars[r]=i.box[r]);if(/AppleWebKit/.test(navigator.appVersion))for(var s=document.getElementsByTagName("object"),_=0;_<s.length;_++){var l=s[_].data||"";if(/\.swf/.test(l)){o.vars.disable_expand_text_input=!0;break}}var c=function(e,t){return"undefined"==typeof e?t:e};o.vars.top_margin=c(i.box.vertical_offset,o.vars.top_margin),o.vars.bottom_margin=c(i.box.vertical_offset,o.vars.bottom_margin),o.vars.right_margin=c(i.box.horizontal_offset,o.vars.right_margin),o.vars.left_margin=c(i.box.horizontal_offset,o.vars.left_margin);var d=function(e,t){o.vars[e]=t||i.system[e]};if(d("before_chat_text",i.locale.welcome_title||i.box.welcome_title),d("in_chat_text",i.locale.chatting_title),d("not_available_text",i.locale.unavailable_title||i.box.unavailable_title),d("busy_text",i.locale.busy_title),d("away_text",i.locale.unavailable_title),d("offline_message",i.locale.away_message),d("welcome_msg",i.locale.welcome_message||i.box.welcome_message),d("busy_message",i.locale.busy_message),d("say_text",i.locale.chat_input_text),d("habla_name_input_text",i.locale.name_input_text||i.system.field_text_for_name),d("habla_offline_email_text",i.locale.email_input_text||i.system.field_text_for_email),d("habla_offline_phone_text",i.locale.phone_input_text),d("habla_offline_body_text",i.locale.offline_note_message||i.system.field_for_offline_message_body||i.system.information_text_when_offline),d("habla_offline_submit_value",i.locale.send_button_text||i.system.button_text_for_send),d("habla_offline_sent_text",i.locale.offline_note_thankyou_text||i.system.offline_message_thankyou_text),d("email_body_error_text",i.locale.offline_note_error_text||i.system.offline_message_validation_error_text),d("sending_text",i.locale.offline_note_sending_text||i.system.offline_message_sending_text),d("operator_is_typing_text",i.locale.operator_is_typing_text),d("operator_has_stopped_typing_text",i.locale.operator_has_stopped_typing_text),d("pre_chat_error_text",i.locale.introduction_error_text),d("pre_chat_message",i.locale.introduction_messages),d("pre_chat_submit",i.locale.introduction_submit_button_text),d("check_for_status",i.locale.loading_title),d("send_text",i.locale.send_button_text),i.system.always_create_new_session&&(o.vars.disable_set_cookies=!0,o.vars.disable_get_cookies=!0),o.vars.start_passive&&t.warn("[olark] start_passive mode is not enabled in the new Javascript"),o.vars.max_milliseconds_conversation_can_be_idle=o.vars.max_milliseconds_conversation_can_be_idle||olark._.maxMillisecondsConversationCanBeIdle,i.box.inline){o.setInline(1),o.vars.start_expanded="undefined"==typeof i.box.start_expanded?1:i.box.start_expanded,o.vars.enable_buttons=!1;var h=document.getElementById("olark-box-container");h&&(h.id="habla_window_div")}var u=function(){function t(e,t){i.locale[e]=i.locale[e]||t}var a=function(){var e=olark._.identityManager.getSiteId(),t=olark._.cookieManager.get("_ok"),o=n.__SPI_isConversing(),a=i.system.high_priority_site?!0:!1;t?t!=e&&(o&&!a||(window.hbl.config.vars.disable_get_cookies=!0,olark._.cookieManager.set("_ok",e))):olark._.cookieManager.set("_ok",e)},r=e.__legacy_site_id||n.__conf.system.olark_key;window.hblHasinit=1,window.hbl.post_started=void 0,r&&olark._.identityManager.setSiteId(r),window.hbl.config=window.hbl.config||window.wc_config();var s=["expand_on_receive_message"];i.Notify&&s.push("incoming_notification"),(i.StatusElements||i.CalloutBubble)&&s.push("away_div_handler"),a(),window.wc_init_post(s),t("ended_chat_message",o.vars.ended_chat_message),t("in_chat_text",o.vars.in_chat_text)};n.__conf.system.disable_visitor_composing&&(olark.__legacy_shim.disableComposing=!0),y||w?n.__wait_for_chat_to_connect(function(){n.__SPI_disconnect(),u()}):u()}},E.prototype.__get_message_history=function(){var e=this;return e.__data_history.get()||e.__conversation_message_history},E.prototype.__SPI_setMessageHistory=function(t){var n=this;n.__conversation_message_history=t,e.run_legacy_code(function(e){0===e.hbl.client.buffer.length&&(e.hbl.client.buffer=[[null,"",.2]])}),n.__data_history.set(t)},E.prototype.__SPI_disableChatConnection=function(){u.util.append_script=function(){},u.client.jsonproxy.prototype.do_nrpc_call=function(){}},E.prototype.__SPI_disconnect=function(){var t=this;t.__session_connection.disconnect(),t.__SPI_setMessageHistory([]),window.hblHasinit=void 0,window.hbl.client.messageq=[],window.hbl.client.jsonthrottle_locked=!1,olark._.identityManager.deleteConversationId(),window.hbl.client.pollingmanager.stop(),window.hbl.client.pollingmanager.reset(),window.hbl.config=window.wc_config(),window.hbl.config.merge({vars:{habla_sizebutton_text_expanded:"_",habla_sizebutton_text_compressed:"^",habla_closebutton_text:"x",habla_popout_text:">",habla_end_popout_text:"&lt;&lt;",corner_position:"BR",bottom_margin:10,right_margin:10,left_margin:10,top_margin:10}}),window.hbl.config.vars.poll=!0,window.habla_window.config=u.config,window.habla_window.theme.config=u.config,y=!1,w=!1,e.trigger_event({namespace:"chat",type:"disconnect"})},E.prototype.__SPI_getVisitorGeolocation=function(){return P.geolocation||null},E.prototype.__SPI_getVisitorIP=function(){return P.browser_ip||null},E.prototype.__SPI_isPremiumUser=function(){return u.client.ssl?!0:!1},E.prototype.__SPI_hasConnectedAlready=function(){var e=this;return e.__hasconnected.get()?!0:!1},E.prototype.__SPI_getLastOperatorPresence=function(e){var t=this;t.whenDataReady(function(){var n=t.__last_op_presence.get();e(n)})},E.prototype.__send_and_deliver_message_from_visitor=function(e){var t=this,n=e.legacy_message_tuple;
if("undefined"==typeof n)throw new Error("'legacy_message_tuple' required");n[2]=n[2]||t.__get_next_message_sequence_id_that_is_server_safe();var i=new A({legacy_message_tuple:n,send_event_type:"messageFromVisitor",deliver_event_type:"deliveryOfMessageFromVisitor",final_delivery_action:function(){t.__session_connection.send_message({body:i.get_processed_body()})}});i.send(),i.deliver()},E.prototype.__send_and_deliver_message_from_operator=function(t){var n=this,i=t.legacy_message_tuple,o=t.is_automated,a=i&&i[1]&&/^\s*$/.test(i[1])?!0:!1;if("undefined"==typeof i)throw new Error("'legacy_message_tuple' required");if("undefined"==typeof o)throw new Error("'is_automated' required");if(!a){i[2]=i[2]||n.__get_next_message_sequence_id_that_is_server_safe();var r=new A({legacy_message_tuple:i,is_automated:o,__SPI_notification:t.__SPI_notification,send_event_type:"messageFromOperator",deliver_event_type:"deliveryOfMessageFromOperator",final_delivery_action:function(){e.run_legacy_code(function(e){var t=[i[0],r.get_processed_body(),i[2]];e.hbl.client.append([t])})}});r.send(),r.deliver()}},E.prototype.__determine_presence_from_nrpc_event=function(e){var t=e.opavailable?!0:!1,n=null;if(t)switch(e.status){case"available":case"chat":n="available";break;case"busy":case"dnd":case"offline":case"away":case"xa":n="away";break;default:n="away"}else n="away";return n},E.prototype.__initialize_legacy_connection_and_messaging_handlers=function(){var t=this;if(!C){x=t.__last_op_presence.get()||"away",C=!0,u.eventmgr.register("chat_started",function(t){y=!0,e.trigger_event({namespace:"chat",type:"connectBegin"}),P={browser_ip:t.browser_ip,geolocation:t.geolocation}},0),u.eventmgr.register("resend_nickname",function(){t.__session_connection.__mark_nickname_update_pending(!0)},0),u.eventmgr.register("resend_status",function(){t.__session_connection.__mark_status_update_pending(!0)},0),u.eventmgr.register("offlineMessageToOperator",function(t){e.trigger_event({namespace:"chat",type:"offlineMessageToOperator",message:t})});var n=t.__is_ended.get();u.eventmgr.register("conversation_ended",function(i){n||(n=!0,t.__is_ended.set(!0),t.__next_conversation_id.set(i.next_conversation_id),e.trigger_event({namespace:"chat",type:"endedStateChange"}))},0),u.eventmgr.register("operator_composing",function(e){function n(e){this.composingMessage&&i();var t=document.createElement("p");t.className="habla_conversation_p_item hbl_pal_main_fg",t.innerHTML='<span class="olark-composing-message habla_conversation_person2 hbl_pal_local_fg">'+e+"</span>",t.children&&(t.children[0].style.color="rgb(200,200,200)",this.composingMessage=t,o.appendChild(this.composingMessage)),o.scrollTop=o.scrollHeight}function i(){if(this.composingMessage){clearTimeout(this.composingMessageRemovalTimeout);var e=this.composingMessage.parentNode||this.composingMessage.parent;e&&e.removeChild(this.composingMessage),this.composingMessage=!1}}var o=document.getElementById("habla_conversation_div");this.composingMessage=this.composingMessage||!1,(this.composingMessageRemovalHandlerSet?1:0)||(t.__SPI_onDeliveryOfMessageFromOperator(function(){i()}),this.composingMessageRemovalHandlerSet=!0),t.__SPI_onEndedStateChanged(function(e){e.is_ended&&i()});var a=u.config.vars.local_name_override||e.operator_nickname||"operator",r={active:function(){i()},composing:function(){n(a+" "+u.config.vars.operator_is_typing_text)},paused:function(){n(a+" "+u.config.vars.operator_has_stopped_typing_text),this.composingMessageRemovalTimeout=setTimeout(i,3e4)}};r.hasOwnProperty(e.composing_type)&&(clearTimeout(this.composingMessageRemovalTimeout),r[e.composing_type]())}),u.eventmgr.register("nrpc_data_ready",function(n){var i=t.__determine_presence_from_nrpc_event(n);t.__last_op_presence.set(i),S=!0,e.trigger_event({namespace:"chat",type:"dataReady"})}),u.eventmgr.register("operator_status_change",function(n){var i=t.__determine_presence_from_nrpc_event(n);switch(i){case"available":e.trigger_event({namespace:"chat",type:"operatorsAvailable",previously:x});break;case"away":e.trigger_event({namespace:"chat",type:"operatorsAway",previously:x})}x=i,t.__last_op_presence.set(x),w||(y=!1,w=!0,e.trigger_event({namespace:"chat",type:"onReady",after:function(){e.trigger_event({namespace:"SessionConnection",type:"afterReady"})}}))},r),t.__wait_for_chat_to_connect(function(){e.run_legacy_code(function(){window.habla_window.send_pipeline.add(function(e){return void t.__send_and_deliver_message_from_visitor({legacy_message_tuple:[null,e,null]})},a)})}),window.olark.__legacy_shim.pipeline_disabler=function(){return void 0},t.__wait_for_chat_to_connect(function(){window.hbl.client.incoming_pipeline.add(function(n){var i=n[0],a=n[1],r=parseFloat(n[2]||-1),s=t.__last_cmd_seq_id.get(),_=o.exec(a);if(_)if(parseFloat(s)!=s&&(olark._.hlog("resetting last_command_index to 0, found a string instead #reset_string_command_index #warn"),s=0,t.__last_cmd_seq_id.set(s)),r>s){t.__last_cmd_seq_id.set(r);var l=_[1],c=_[2];c&&0===c.length&&(c=null),e.trigger_event({namespace:"chat",type:"commandFromOperator",nickname:i,name:l,body:c})}else olark._.hlog("dropping command",_[1],"due to sequence ID mismatch",r,"<=",s,"#warn #dropped_command");else t.__send_and_deliver_message_from_operator({legacy_message_tuple:n,is_automated:!1});return n},a)})}},E.prototype.__SPI_getMessageHistory=function(e){var t=this.__get_message_history();return e&&e(t),t},E.prototype.__SPI_populatedLocalChatHistoryFromRpcServer=function(){var e=this;return!e.__has_local_history},E.prototype.__SPI_onPrechatInfoReceived=function(t){e.listen_for_event({namespace:"chat",type:"prechatInfoReceived",callback:t})},E.prototype.__initialize_legacy_history_tracking=function(){var i=this;if(!I){I=!0;var a=function(e){var a=parseFloat(i.__last_leg_seq_id.get());if(e.__legacy_sequence_id||(e.__legacy_sequence_id=i.__get_next_message_sequence_id_that_is_server_safe()),a<e.__legacy_sequence_id){i.__last_leg_seq_id.set(e.__legacy_sequence_id);var r=i.__get_message_history();n(r)||(t.error("[olark] expected message_history to be a list:",r),r=[]),o.test(e.message.body)||r.push({nickname:e.message.nickname,body:e.message.body});var s=function(){r=r.slice(1,r.length),t.warn("[olark] trying to shrink message history, now has",r.length,"entries"),r.length>0?i.__SPI_setMessageHistory(r,s):i.__SPI_setMessageHistory([])};i.__SPI_setMessageHistory(r,s)}};i.__SPI_onDeliveryOfMessageFromOperator(a),i.__SPI_onDeliveryOfMessageFromVisitor(a),u.eventmgr.register("chat_loaded",e.create_idempotent_callback(function(){e.trigger_event({namespace:"chat",type:"legacyChatLoaded"})}));window.olark.__legacy_shim.load_missed_messages=e.create_idempotent_callback(function(e){i.__has_local_history=0!==e.length&&i.__last_leg_seq_id.get();for(var t=0;t<e.length;){var n=e[t],r=n[0],s=n[1],_=n[2],l=i.__last_leg_seq_id.get(),c=o.test(n[1]);c||(i.__has_local_history?_>l&&i.__send_and_deliver_message_from_operator({legacy_message_tuple:n,is_automated:!1}):a({__legacy_sequence_id:parseFloat(_),message:{nickname:r,body:s}})),t++}});var r=i.__SPI_getMessageHistory();window.olark.__legacy_shim.has_messages_in_history=r&&r.length>0?!0:!1}},olark.declare({name:"__ChatApiHelper",startup:function(t,n){function i(){setTimeout(function(){try{var e=window.hbl.client.buffer.length>0,t=habla_window.getHeader()==n.system.before_chat_text;e&&t&&habla_window.setHeader(n.locale.in_chat_text)}catch(i){}},900)}var o=!1;window.olark.__legacy_shim.send_prechat_info=function(n){if(!o){o=!0;var i="";n.name&&n.name.length&&"undefined"!=n.name&&(t.visitor.addFullName(n.name),i+="\n    name: "+n.name),n.email&&n.email.length&&"undefined"!=n.email&&(t.visitor.addEmailAddress(n.email),i+="\n    email: "+n.email),n.phone&&n.phone.length&&"undefined"!=n.phone&&(t.visitor.updatePhoneNumber(n.phone),i+="\n    phone: "+n.phone),i||(i="Prechat survey left blank."),t.chat.sendNotificationToOperator({body:i}),e.trigger_event({namespace:"chat",type:"prechatInfoReceived"})}},t.chat.onMessageToVisitor(i),t.chat.onMessageToOperator(i);var a=t.data.getConversationObject({key:"lock",initialValue:!1}),r=null,s=null,_=t.data.getConversationObject({key:"isFirstBusyCommand",initialValue:!0}),l=function(){r||(r=setInterval(function(){d()},1e3*f),s=setInterval(function(){t.chat.sendNotificationToOperator({body:"this visitor is still locked into chat, to unlock this visitor type !unlock"})},1e3*g))},c=function(){r&&(clearInterval(r),clearInterval(s),r=null,s=null)},d=function(){e.run_legacy_code(function(e){e.hbl.client.sendcommand("return_long_poll_now","")})};t.chat.onReady(function(){a.get()===!0?l():c()}),t.chat.onCommandFromOperator(function(i){switch(i.command.name){case"lock":a.set(!0),t.chat.sendNotificationToOperator({body:"visitor has been locked into this chat, to unlock this visitor type !unlock"}),l();break;case"unlock":a.set(!1),t.chat.sendNotificationToOperator({body:"visitor has been unlocked from this chat"}),c();break;case"busy":var o=n.locale.operator_busy_message_update||"Just checking in - I'm still busy chatting with {{ active_conversation_count }} other customers. I'll be with you as soon as I can.";_.get()&&(o=n.locale.operator_busy_message||"Sorry, I'm currently a bit busy at the moment with {{ active_conversation_count }} other customers. I'll be with you as soon as I can.",t.chat.sendNotificationToOperator({body:"Visitor has been queued. Simply send a message to start chatting and remove them from the queue."}),_.set(!1));var r=parseInt(i.command.body);t.chat.sendNotificationToVisitor({body:o.replace(/\{\{\s*active_conversation_count\s*\}\}/g,r)}),e.trigger_event({namespace:"chat",type:"operatorIsBusy"})}}),t.chat.onCommandFromOperator(function(i){switch(i.command.name){case"transfer":t.chat.__SPI_unlockFromCurrentGroup();break;case"name":var o=i.command.body;t.visitor.updateFullName({fullName:o}),t.chat.sendNotificationToOperator({body:"remembering visitor name as "+o});break;case"email":var a=i.command.body;t.visitor.updateEmailAddress({emailAddress:a}),t.chat.sendNotificationToOperator({body:"remembering visitor email as "+a});break;case"phone":var r=i.command.body;t.visitor.updatePhoneNumber({phoneNumber:r}),t.chat.sendNotificationToOperator({body:"remembering visitor phone number as "+r});break;case"end":olark("api.visitor.getDetails",function(i){var o=i.messageCountForThisVisit>0;o&&(t.chat.sendNotificationToVisitor({body:n.locale.ended_chat_message}),e.trigger_event({namespace:"chat",type:"endConversation"}))})}}),t.chat.onCommandFromOperator(function(e){"help"==e.command.name&&t.chat.sendNotificationToOperator({body:["quick reference for the commands you can type at any time...","\n!tag","     tag this conversation, like '!tag followup' or '!tag important'","\n!transfer","     transfer this visitor to another operator.  Optionally give a note, like '!transfer This guy needs help with billing'","\n!unfollow","     stop receiving page-change notifications for this visitor","\n!push","     push this visitor to a URL, like '!push www.google.com'","\n!block","     block this visitor","For more commands, check out http://www.olark.com/help/olark-commands",""].join("\n")})}),t.box.onDismiss(function(){t.chat.__SPI_endConversation()}),t.chat.onBeginConversation(function(){t.chat.__SPI_lockToOperatorGroup(n.system.group||n.system.olark_group||null)}),t.chat.__SPI_lockToExistingOperatorGroupIfGiven(n.system.group||n.system.olark_group||null),n.system.forced_rpc_server&&(window.hbl_hostname=n.system.forced_rpc_server,window.hblrpcTrick=0)}}),olark.extend("__ChatApiHelper"),e.chat={ChatApi:E,SessionConnection:M}})}(window.olark.__core,window.olark.__core.logger),function(e){e.wait_for(function(){return!0},function(){var t={},n=function(e){var n=this;if(n.__namespace=e.namespace,"undefined"==typeof n.__namespace)throw new Error("'namespace' required");n.__methods=t[n.__namespace]={}};n.prototype.exportMethods=function(e){var t=this;e(t.__methods)},n.prototype.importMethods=function(n,i){var o=this;if(!e.is_extension_required({extension_name:n}))throw new Error("extension '"+n+"' is required for "+o.__namespace);var a=t[n];if(a)i(a);else{var r=!1;e.listen_for_event({namespace:"Extension",type:"extensionActivated",callback:function(){a=t[n],a&&!r&&(r=!0,i(a))}})}},e.extensions={ExtensionsApi:n}})}(window.olark.__core,window.olark.__core.logger),function(e){e.wait_for(function(){return e.chat},function(){var t={encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},decode:function(e){var t,n,i,o,a="",r=0;for(t=n=i=0;r<e.length;)t=e.charCodeAt(r),128>t?(a+=String.fromCharCode(t),r++):t>191&&224>t?(i=e.charCodeAt(r+1),a+=String.fromCharCode((31&t)<<6|63&i),r+=2):(i=e.charCodeAt(r+1),o=e.charCodeAt(r+2),a+=String.fromCharCode((15&t)<<12|(63&i)<<6|63&o),r+=3);return a}},n=!1,i=function(t){var i=this;if(i.__namespace=t.namespace,i.__conf=t.conf,"undefined"==typeof i.__namespace)throw new Error("'namespace' required");i.__session_connection=e.chat.SessionConnection.get_instance();var o=function(){var t=i.__session_connection.get_local_data({key:"BrowserApi::last_page_visited"}),n=olark._.overrideWindowHref||document.location.href.toString();t!==n&&(e.trigger_event({namespace:"BrowserApi",type:"locationChange",previousUrl:t,currentUrl:n}),i.__session_connection.put_local_data({key:"BrowserApi::last_page_visited",value:n}))};if(!n){if(n=!0,e.after_extensions_are_activated(o),i.__conf.system.hashchange_events_trigger_page_change)try{e.listen_for_browser_event(window,"hashchange",o)}catch(a){}var r=window.history&&window.history.pushState;if(i.__conf.system.history_events_trigger_page_change!==!1&&r)try{var s=window.history.pushState;window.history.pushState=function(){s.apply(window.history,arguments),e.trigger_event({namespace:"BrowserApi",type:"pushstateChanged"})};var _=window.history.replaceState;window.history.replaceState=function(){_.apply(window.history,arguments),e.trigger_event({namespace:"BrowserApi",type:"pushstateChanged"})},e.listen_for_event({namespace:"BrowserApi",type:"pushstateChanged",callback:o}),e.listen_for_browser_event(window.history,"popstate",o)}catch(a){}}};i.prototype.onPageChange=function(t){e.listen_for_event({namespace:"BrowserApi",type:"locationChange",callback:function(e){t({newPage:e.currentUrl,oldPage:e.previousUrl})}})},i.prototype.__SPI_getSafeUrl=function(e){return/webkit/.test(navigator.userAgent.toString().toLowerCase())&&(e=t.decode(unescape(e))),e.replace(/ /g,"%20")},e.browser={BrowserApi:i}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return e.data},function(){function n(e){e=e||function(){};var t="olark_"+Math.random().toString().replace(".","");return window[t]=function(n){e(n),window[t]=void 0;try{delete window[t]}catch(i){}},t}function i(e){try{for(var t,n=/(q|p|query|queryTerms?)\=([^&\#]+)/i.exec(e)[2],i=decodeURIComponent(n).replace(/\+/g," "),o=/(?:\((.+?)\)|"(.+?)"|'(.+?)'|([^\s]+))/g,a=[];t=o.exec(i);)a.push(t[2]||t[3]||t[4]);return{text:/^\s*$/.test(i)?null:i,terms:a}}catch(r){return{text:null,terms:[]}}}function o(e){try{for(var t,n=/(?:utm_(\w+))\=([^&\#]+)/gi,i={};t=n.exec(e);)try{var o=t[1],a=t[2];i[o]=decodeURIComponent(a).replace(/\+/g," ")}catch(r){}return i}catch(r){return{}}}var a=9e3,r=10,s=1e4,_=14,l=!1,c=function(t){function n(){o.__SPI_bumpVisitHistoryTimestamp(),setTimeout(n,a)}function i(){var e=o.__visitHistory.get(),t=e[e.length-1]||{};t.messageCount=t.messageCount||0,t.messageCount++,o.__visitHistory.set(e)}var o=this;if(o.__namespace=t.namespace,"undefined"==typeof o.__namespace)throw new Error("'namespace' required");var s=t.data,_=t.browser;if(o.__fullNameObject=s.getVisitorObject({key:"visFullName",initialValue:null,__SPI_forceNamespace:"__api"}),o.__emailAddressObject=s.getVisitorObject({key:"visEmailAddress",initialValue:null,__SPI_forceNamespace:"__api"}),o.__phoneNumberObject=s.getVisitorObject({key:"visPhoneNumber",initialValue:null,__SPI_forceNamespace:"__api"}),o.__recentPageHistory=s.getVisitorObject({key:"rph",initialValue:[],__SPI_forceNamespace:"__vis"}),o.__visitHistory=s.getVisitorObject({key:"vh",initialValue:[],__SPI_forceNamespace:"__vis"}),o.__isNewVisit=s.getConversationObject({key:"inv",initialValue:!0,__SPI_forceNamespace:"__vis"}),o.__importance=s.getVisitorObject({key:"imp",initialValue:0,__SPI_forceNamespace:"__vis"}),o.__notes=s.getVisitorObject({key:"nts",initialValue:[],__SPI_forceNamespace:"__vis"}),o.__mostRecentMessage=s.getConversationObject({key:"mrcm",initialValue:void 0,__SPI_forceNamespace:"__vis"}),o.__mostRecentNotificationToOperator=s.getConversationObject({key:"mrno",initialValue:void 0,__SPI_forceNamespace:"__vis"}),o.__mostRecentMessageToOperator=s.getConversationObject({key:"mrcmo",initialValue:void 0,__SPI_forceNamespace:"__vis"}),o.__mostRecentMessageToVisitor=s.getConversationObject({key:"mrcmv",initialValue:void 0,__SPI_forceNamespace:"__vis"}),o.__visitFields=s.getConversationObject({key:"vf",initialValue:{},__SPI_forceNamespace:"__vis"}),o.__didSyncName=s.getConversationObject({key:"dsn",initialValue:!1,__SPI_forceNamespace:"__vis"}),o.__didSyncEmail=s.getConversationObject({key:"dse",initialValue:!1,__SPI_forceNamespace:"__vis"}),o.__didSyncPhone=s.getConversationObject({key:"dsp",initialValue:!1,__SPI_forceNamespace:"__vis"}),o.__conversationBeginPage=s.getConversationObject({key:"cbp",initialValue:void 0,__SPI_forceNamespace:"__vis"}),o.__visitEventSent=s.getConversationObject({key:"ves",initialValue:!1,__SPI_forceNamespace:"__vis"}),o.__landedOnPageTimestamp=+new Date,_.onPageChange(function(){o.__landedOnPageTimestamp=+new Date}),!l){l=!0;var c=o.__recentPageHistory.get(),d=function(){var e=c[c.length-1],t=e?e.url:null;(0===c.length||document.location.href!==t)&&(c.push({title:document.title.length?document.title:null,url:document.location.href,timestamp:+new Date}),c.length>r&&(c=c.slice(c.length-r)),o.__recentPageHistory.set(c))};d(),_.onPageChange(d),o.__visitEventSent.set(!0);var h=e.xdhttp.post("/2.0/sites/"+olark._.siteId+"/visits");h.send({conversation_id:olark._.conversationId}),h.end(function(e){e&&o.__visitEventSent.set(!1)});var u,p=0===o.__visitHistory.get().length,f=o.__isNewVisit.get();(f||p)&&(f||olark._.hlog("got #empty_history, treating as new visit for visit history"),o.__isNewVisit.set(!1),u=o.__visitHistory.get(),u.push({didChat:!1,pageCount:0,messageCount:0,referrer:document.referrer.toString(),createdAt:+new Date,updatedAt:+new Date}),o.__visitHistory.set(u)),n(),u=o.__visitHistory.get(),u=o.__updateMostRecentTimestampOnHistory(u),u[u.length-1].pageCount+=1,o.__visitHistory.set(u),olark("api.chat.onBeginConversation",function(){var e=o.__visitHistory.get(),t=e[e.length-1];t&&t.didChat!==!0&&(t.didChat=!0,o.__visitHistory.set(e),o.__conversationBeginPage.set(document.location.href))}),olark("api.chat.onMessageToOperator",function(){o.__mostRecentMessage.set(+new Date),o.__mostRecentMessageToOperator.set(+new Date),i()}),olark("api.chat.onMessageToVisitor",function(){o.__mostRecentMessage.set(+new Date),o.__mostRecentMessageToVisitor.set(+new Date),i()}),olark("api.chat.onNotificationToOperator",function(){o.__mostRecentNotificationToOperator.set(+new Date)}),o.__SPI_prepopulateEmailFields(),o.__SPI_prepopulateFullNameFields(),o.__SPI_prepopulatePhoneNumberFields(),o.__SPI_prepopulateChatNicknameFromBestVisitorInformation(),this.__emailAddressObject.__SPI_onChange(function(){o.__didSyncEmail.set(!1),o.__ensureVisitorDataSynced({emailAddress:!0}),o.__SPI_prepopulateEmailFields(),o.__SPI_prepopulateChatNicknameFromBestVisitorInformation()}),this.__fullNameObject.__SPI_onChange(function(){o.__didSyncName.set(!1),o.__ensureVisitorDataSynced({fullName:!0}),o.__SPI_prepopulateFullNameFields(),o.__SPI_prepopulateChatNicknameFromBestVisitorInformation()}),this.__phoneNumberObject.__SPI_onChange(function(){o.__didSyncPhone.set(!1),o.__ensureVisitorDataSynced({phoneNumber:!0}),o.__SPI_prepopulatePhoneNumberFields()}),o.__ensureVisitorDataSynced({fullName:!0,emailAddress:!0,phoneNumber:!0})}};!function(a){function r(e,t){var n=olark;return c?t&&t(c[e]):n("api.chat.whenDataReady",function(){c=olark._.geoip,t&&t((c||{})[e])}),(c||{})[e]}function l(e,t){var n=t();return e&&e(n),n}var c=null,h=0,p=null;a.__ensureVisitorDataSynced=function(t){var i=this,o=!1;if(!(t.retry&&h>=_)){var a=function(t,i,a,r){if(!i.get()&&t.get()){var s=["site_id="+encodeURIComponent(olark._.identityManager.getSiteId()),"visitor_id="+encodeURIComponent(olark._.identityManager.getVisitorId()),a+"="+encodeURIComponent(t.get()),"cache="+encodeURIComponent(Math.random()),"jsonp="+n(function(e){e.success&&(h=0,i.set(!0))})];o=!0,i.set(!1),e.async_script_load({url:olark._.apiHost+"/1.0/visitor/"+r+"?"+s.join("&")})}};if(t.fullName&&a(i.__fullNameObject,i.__didSyncName,"full_name","addFullName"),t.emailAddress&&a(i.__emailAddressObject,i.__didSyncEmail,"email_address","addEmailAddress"),t.phoneNumber&&a(i.__phoneNumberObject,i.__didSyncPhone,"phone_number","addPhoneNumber"),o){t.retry&&h++,p||(p={},e.do_async_call({delay:s},function(){var e=p;e.retry=!0,p=null,i.__ensureVisitorDataSynced(e)}));for(var r in t)t.hasOwnProperty(r)&&(p[r]=t[r])}}},a.__SPI_getBrowser=function(){var e=d.parse(window.navigator.userAgent);return e.family+" "+e.toVersionString()},a.__SPI_getOs=function(){var e=navigator.platform;return/Mac/.test(e)?"Mac OSX":/Linux/.test(e)?"Linux":/Win/.test(e)?"Windows":void 0},a.__SPI_getIp=function(){return olark._.ipaddress},a.__SPI_getRecentPageHistory=function(){return this.__recentPageHistory.get()||[]},a.__SPI_prepopulateEmailFields=function(){var e=this.__emailAddressObject.get();olark("api.box.__SPI_setThemeTextField","habla_pre_chat_email_input",e),olark("api.box.__SPI_setThemeTextField","habla_offline_email_input",e)},a.__SPI_prepopulateFullNameFields=function(){var e=this.__fullNameObject.get();olark("api.box.__SPI_setThemeTextField","habla_pre_chat_name_input",e),olark("api.box.__SPI_setThemeTextField","habla_name_input",e)},a.__SPI_prepopulatePhoneNumberFields=function(){var e=this.__phoneNumberObject.get();olark("api.box.__SPI_setThemeTextField","habla_pre_chat_phone_input",e),olark("api.box.__SPI_setThemeTextField","habla_offline_phone_input",e)},a.__SPI_prepopulateChatNicknameFromBestVisitorInformation=function(){var e,t=this.__fullNameObject.get(),n=this.__emailAddressObject.get();t&&n?e=t+" ("+n+")":t?e=t:n&&(e=n),e&&olark("api.chat.updateVisitorNickname",{snippet:e,hidesDefault:!0})},a.__SPI_getIsInspecting=function(e){return l(e,function(){return olark._.cookieManager.get("_okinspect")?!0:!1})},a.__SPI_setIsInspecting=function(e){e?olark._.cookieManager.set("_okinspect",e):olark._.cookieManager.erase("_okinspect")},a.__SPI_bumpVisitHistoryTimestamp=function(){var e=this,t=e.__visitHistory.get();t=e.__updateMostRecentTimestampOnHistory(t),e.__visitHistory.set(t)},a.__updateMostRecentTimestampOnHistory=function(e){var t=e[e.length-1];return t&&(t.updatedAt=+new Date),e},a.addEmailAddress=function(e){this.updateEmailAddress(e)},a.updateEmailAddress=function(e){var t=e.emailAddress||e;if("string"!=typeof t)throw new Error("[olark] emailAddress string expected");var n=u.util.strip_whitespace(u.util.decode_html_entities(t));if(n=n.split(" ")[0],!u.util.is_valid_email(n))throw new Error("[olark] invalid email address: '"+n+"'");this.__emailAddressObject.set(n)},a.addFullName=function(e){this.updateFullName(e)},a.updateFullName=function(e){var t=e.fullName||e;if("string"!=typeof t)throw new Error("[olark] fullName string expected");t=u.util.strip_whitespace(u.util.decode_html_entities(t)),this.__fullNameObject.set(t)},a.updatePhoneNumber=function(e){var t=e.phoneNumber||e;if("string"!=typeof t)throw new Error("[olark] phoneNumber string expected");t=u.util.strip_whitespace(u.util.decode_html_entities(t)),this.__phoneNumberObject.set(t)},a.getFullName=function(e){var t=this;return l(e,function(){return t.__fullNameObject.get()})},a.getEmailAddress=function(e){var t=this;return l(e,function(){return t.__emailAddressObject.get()})},a.getPhoneNumber=function(e){var t=this;return l(e,function(){return t.__phoneNumberObject.get()})},a.onChange=function(e){this.__fullNameObject.__SPI_onChange(e),this.__emailAddressObject.__SPI_onChange(e),this.__phoneNumberObject.__SPI_onChange(e),this.__visitHistory.__SPI_onChange(e),this.__recentPageHistory.__SPI_onChange(e),this.__importance.__SPI_onChange(e),this.__notes.__SPI_onChange(e)},a.getCity=function(e){return r("city",e)},a.getRegion=function(e){return r("state",e)},a.getCountry=function(e){return r("country",e)},a.getCountryCode=function(e){return r("country_code",e)},a.getOrganization=function(e){var t;return r("isp",function(n){r("organization",function(i){t=n!=i?i:{}.undefinedValue,e&&e(t)})}),t},a.updateImportance=function(e){var t;try{t=parseInt(e.value||e)}catch(n){t=-1}if(0>t||t>3)throw new Error("[olark] visitor importance must be an integer between 0-3");this.__importance.set(t)},a.addNote=function(e){var t=e.body||e,n=this.__notes.get();if("string"!=typeof t)throw new Error("[olark] visitor notes must be strings");for(var i=!1,o=0;o<n.length;o++)if(n[o]==t){i=!0;break}i||(n.push(t),this.__notes.set(n))},a.updateCustomFields=function(t){var i=e.framestorewithjson.json,o=i.encode(this.__visitFields.get()),a=i.encode(t);if(o!=a){this.__visitFields.set(t);var r=["conversation_id="+encodeURIComponent(olark._.identityManager.getConversationId()),"site_id="+encodeURIComponent(olark._.identityManager.getSiteId()),"custom_fields_json="+encodeURIComponent(a),"cache="+encodeURIComponent(Math.random()),"jsonp="+n()];e.async_script_load({url:olark._.apiHost+"/1.0/visitor/updateDetailsForThisVisit?"+r.join("&")})}},a.updateDetailsForThisVisit=function(e){this.updateCustomFields(e)},a.getDetailsForThisVisit=function(e){e(this.__visitFields.get())},a.trackConversion=function(){var t=["conversation_id="+encodeURIComponent(olark._.identityManager.getConversationId()),"site_id="+encodeURIComponent(olark._.identityManager.getSiteId()),"cache="+encodeURIComponent(Math.random()),"jsonp="+n()];e.async_script_load({url:olark._.apiHost+"/1.0/visitor/trackConversion?"+t.join("&")})},a.getDetails=function(e){var n=this,a=null;return n.getCity(function(s){function _(e){return e?(+new Date-e)/1e3:{}.undefinedValue}try{var l=function(){var e=r("domain"),t=n.getOrganization();return/(gov|edu|ibm|microsoft)/i.test(e)||t?e:void 0},c=n.getRegion(),d=n.getCountry(),h=n.getCountryCode(),u=n.getOrganization(),p=l(),f=n.__recentPageHistory.get(),g=n.__visitHistory.get(),m=n.__conversationBeginPage.get();0==g.length&&(g.push({}),olark._.hlog("#history_is_empty in getDetails")),0==f.length&&(f.push({}),olark._.hlog("#page_history_is_empty in getDetails"));var v=g[g.length-1].referrer;v&&v.indexOf(" ")>0&&(v=encodeURI(v));for(var b=0,y=0,w=0,k=0,x=!1,S=!1,I=!1,C=!1,T="",P=[],M=0;M<g.length;M++){var A=M==g.length-1;b+=g[M].pageCount,y+=g[M].messageCount||0,g[M].didChat&&w++,k+=g[M].updatedAt-g[M].createdAt;var E=o(g[M].referrer);E.campaign&&(I=!0,A&&(C=!0));var O=/(cpc|ppc)/i.test(E.medium||""),N=E.term,j=/gclid\=/.test(g[M].referrer);(N||j||O)&&(x=!0,A&&(S=!0));var V=i(g[M].referrer);V.text&&(A?T=V.text:P.push(V.text))}var F;try{F=n.__visitFields.get()}catch(B){F={}}a={recentPageHistory:f,currentPage:f[f.length-1],conversationBeginPage:m,referrer:v,referredByPaidAdvertisingEver:x,referredByPaidAdvertisingThisVisit:S,referredByCampaignEver:I,referredByCampaignThisVisit:C,searchTextForThisVisit:T,searchTextForPreviousVisits:P,pageCountForThisVisit:g[g.length-1].pageCount,pageCountAcrossAllVisits:b,messageCountForThisVisit:g[g.length-1].messageCount||0,messageCountAcrossAllVisits:y,visitCount:g.length,conversationCount:w,isConversing:g[g.length-1].didChat,secondsSpentOnCurrentPage:Math.round((+new Date-n.__landedOnPageTimestamp)/1e3),secondsSpentForThisVisit:Math.round((+new Date-g[g.length-1].createdAt)/1e3),secondsSpentAcrossAllVisits:Math.round(k/1e3),city:s,region:c,country:d,countryCode:h,organization:u,domain:p,fullName:n.getFullName(),emailAddress:n.getEmailAddress(),phoneNumber:n.getPhoneNumber(),importance:n.__importance.get(),notes:n.__notes.get(),browser:n.__SPI_getBrowser(),operatingSystem:n.__SPI_getOs(),ip:n.__SPI_getIp(),secondsSinceLastMessage:_(n.__mostRecentMessage.get()),secondsSinceLastNotificationToOperator:_(n.__mostRecentNotificationToOperator.get()),secondsSinceLastMessageToOperator:_(n.__mostRecentMessageToOperator.get()),secondsSinceLastMessageToVisitor:_(n.__mostRecentMessageToVisitor.get()),customFields:F}}catch(B){t.error("#error - getDetails",B.message),a={}}e&&e(a)}),a},a.__SPI_getNotes=function(e){var t=this;return l(e,function(){return t.__notes.get()})},a.__SPI_getVisitHistory=function(e){var t=this;return l(e,function(){return t.__visitHistory.get()})}}(c.prototype);var d=function(){function e(e){var n,i;for(n=0;n<o.length;n++)if(i=o[n](e))return i;return new t}function t(e){this.family=e||"Other"}var n,i=[{p:"Trident(.*)rv.(\\d+)\\.(\\d+)",f:"Internet Explorer"},{p:"^(Opera)/(\\d+)\\.(\\d+) \\(Nintendo Wii",f:"Wii"},{p:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?)",f:"Firefox ($1)"},{p:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?",f:"Firefox ($1)"},{p:"(SeaMonkey|Fennec|Camino)/(\\d+)\\.(\\d+)([ab]?\\d+[a-z]*)"},{p:"(Flock)/(\\d+)\\.(\\d+)(b\\d+?)"},{p:"(Fennec)/(\\d+)\\.(\\d+)(pre)"},{p:"(Navigator)/(\\d+)\\.(\\d+)\\.(\\d+)",f:"Netscape"},{p:"(Navigator)/(\\d+)\\.(\\d+)([ab]\\d+)",f:"Netscape"},{p:"(Netscape6)/(\\d+)\\.(\\d+)\\.(\\d+)",f:"Netscape"},{p:"(MyIBrow)/(\\d+)\\.(\\d+)",f:"My Internet Browser"},{p:"(Firefox).*Tablet browser (\\d+)\\.(\\d+)\\.(\\d+)",f:"MicroB"},{p:"(Opera)/9.80.*Version\\/(\\d+)\\.(\\d+)(?:\\.(\\d+))?"},{p:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?) \\(Swiftfox\\)",f:"Swiftfox"},{p:"(Firefox)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)? \\(Swiftfox\\)",f:"Swiftfox"},{p:"(konqueror)/(\\d+)\\.(\\d+)\\.(\\d+)",f:"Konqueror"},{p:"(Jasmine|ANTGalio|Midori|Fresco|Lobo|Maxthon|Lynx|OmniWeb|Dillo|Camino|Demeter|Fluid|Fennec|Shiira|Sunrise|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Vodafone|NetFront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|Opera Mini|iCab|NetNewsWire|Iron|Iris)/(\\d+)\\.(\\d+)\\.(\\d+)"},{p:"(Bolt|Jasmine|Maxthon|Lynx|Arora|IBrowse|Dillo|Camino|Shiira|Fennec|Phoenix|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Opera Mini|Opera|Vodafone|NetFront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|iCab|NetNewsWire|Iron|Space Bison|Stainless|Orca)/(\\d+)\\.(\\d+)"},{p:"(iRider|Crazy Browser|SkipStone|iCab|Lunascape|Sleipnir|Maemo Browser) (\\d+)\\.(\\d+)\\.(\\d+)"},{p:"(iCab|Lunascape|Opera|Android) (\\d+)\\.(\\d+)"},{p:"(IEMobile) (\\d+)\\.(\\d+)",f:"IE Mobile"},{p:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"},{p:"(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?"},{p:"(Obigo|OBIGO)[^\\d]*(\\d+)(?:.(\\d+))?",f:"Obigo"},{p:"(MAXTHON|Maxthon) (\\d+)\\.(\\d+)",f:"Maxthon"},{p:"(Maxthon|MyIE2|Uzbl|Shiira)",r:"0"},{p:"(PLAYSTATION) (\\d+)",f:"PlayStation"},{p:"(PlayStation Portable)[^\\d]+(\\d+).(\\d+)"},{p:"(BrowseX) \\((\\d+)\\.(\\d+)\\.(\\d+)"},{p:"(Opera)/(\\d+)\\.(\\d+).*Opera Mobi",f:"Opera Mobile"},{p:"(POLARIS)/(\\d+)\\.(\\d+)",f:"Polaris"},{p:"(BonEcho)/(\\d+)\\.(\\d+)\\.(\\d+)",f:"Bon Echo"},{p:"(iPhone) OS (\\d+)_(\\d+)(?:_(\\d+))?"},{p:"(Avant)",r:"1"},{p:"(Nokia)[EN]?(\\d+)"},{p:"(Black[bB]erry)(\\d+)",f:"Blackberry"},{p:"(OmniWeb)/v(\\d+)\\.(\\d+)"},{p:"(Blazer)/(\\d+)\\.(\\d+)",f:"Palm Blazer"},{p:"(Pre)/(\\d+)\\.(\\d+)",f:"Palm Pre"},{p:"(Links) \\((\\d+)\\.(\\d+)"},{p:"(QtWeb) Internet Browser/(\\d+)\\.(\\d+)"},{p:"(Version)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari/",f:"Safari"},{p:"(OLPC)/Update(\\d+)\\.(\\d+)"},{p:"(OLPC)/Update()\\.(\\d+)",r:"0"},{p:"(SamsungSGHi560)",f:"Samsung SGHi560"},{p:"^(SonyEricssonK800i)",f:"Sony Ericsson K800i"},{p:"(Teleca Q7)"},{p:"[MS]?IE 7+\\.\\d+.*(Trident)\\/(\\d+)\\.(\\d+)",f:"Internet Explorer Compatibility Mode"},{p:"([MS]?IE) (\\d+)\\.(\\d+)",f:"Internet Explorer"}],o=[];
for(n=0;n<i.length;n++)!function(e){function n(e){var n,o,s=e.match(i);return s?(n=a?a.replace("$1",s[1]):s[1],o=new t(n),o.major=parseInt(r?r:s[2]),o.minor=s[3]?parseInt(s[3]):null,o.patch=s[4]?parseInt(s[4]):null,n.match(/Compatibility Mode$/)&&(o.major+=4),o):null}var i=new RegExp(e.p),a=e.f||null,r=e.r||null;o.push(n)}(i[n]);return t.prototype.toVersionString=function(){var e="";return null!=this.major&&(e+=this.major,null!=this.minor&&(e+="."+this.minor,null!=this.patch&&(e+="."+this.patch))),e},t.prototype.toString=function(){var e=this.toVersionString();return e&&(e=" "+e),this.family+e},{parse:e}}();e.visitor={VisitorApi:c}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return e.data},function(){var n=900,i=function(e){var t=this,n=e.data;t.__browserApi=e.browser,t.__didActionForVisitor=n.getVisitorObject({key:"dafv",initialValue:{},__SPI_forceNamespace:"__rul"}),t.__didActionForConversation=n.getConversationObject({key:"dafc",initialValue:{},__SPI_forceNamespace:"__rul"})};!function(e){function i(e,n,i,o){function a(){"undefined"!=typeof o?o.get()||(o.set(!0),i()):t.warn("[olark] cannot execute rule with didAction undefined.")}"undefined"!=typeof o?o.get()||n(a):t.warn("[olark] cannot execute rule with didAction undefined.")}e.defineRule=function(e){function t(){0===h?i(a,r,s,d):u||(u=setTimeout(function(){u=null,i(a,r,s,d)},n))}var o=this,a=e.id,r=(e.description,e.condition),s=e.action,_=e.perVisit,l=e.perVisitor,c=e.perPage,d={get:function(){if(_||l){var e=_?o.__didActionForConversation:o.__didActionForVisitor;return e.get()[a]}return c?d.value:!1},set:function(e){if(_||l){var t=_?o.__didActionForConversation:o.__didActionForVisitor,n=t.get();n[a]=e,t.set(n)}else c&&(d.value=e)}},h=0,u=null;olark("api.boot.onIdentityReady",t),olark("api.visitor.onChange",t),olark("api.chat.onReady",t),olark("api.chat.onOperatorsAway",t),olark("api.chat.onOperatorsBusy",t),olark("api.chat.onOperatorsAvailable",t),o.__browserApi.onPageChange(function(){c&&d.set(!1),t()})}}(i.prototype),e.rules={RulesApi:i}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return!0},function(){var n=["callback"],i=function(e){for(var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_.!~*'()",i="0123456789ABCDEF",o="",a=0;a<e.length;a++){var r=e.charAt(a);if(" "==r)o+="+";else if(-1!=n.indexOf(r))o+=r;else{var s=r.charCodeAt(0);s>255?(t.error("[olark] unicode character cannot be URL encoded, attempting to substitute plus sign"),o+="+"):(o+="%",o+=i.charAt(s>>4&15),o+=i.charAt(15&s))}}return o},o=function(e){e=e||{}};o.prototype.requestJson=function(e,t){var o=this,a=e.url;if("string"!=typeof a)throw new Error("[olark] string 'url' is required");var r=e.params;if(typeof r!=typeof{})throw new Error("[olark] dictionary 'params' is required");var s=n,_=t,l="cb"+Math.floor(1e6*Math.random());r[s]=l;var c="",d=!0;for(var h in r)if("function"!=typeof r[h]){var u=r[h];d||(c+="&"),c+=h+"="+i(u),d=!1}a=a.replace("http://",""),a=a.replace("https://",""),a+="?"+c,a=("https:"==document.location.protocol?"https://":"http://")+a;var p=document.createElement("script");p.type="text/javascript",p.src=a;var f=document.getElementsByTagName("head")[0]||document.documentElement;window[l]=function(){_.apply(_,arguments),window[l]=void 0;try{delete window[l]}catch(e){}f.removeChild(p)},o.withConnectionCompatibility(function(){f.insertBefore(p,f.firstChild)})},o.prototype.withConnectionCompatibility=function(t){e.run_legacy_code(function(e){e.hbl.client.sendcommand("return_long_poll_now",""),t()})},e.remote={RemoteApi:o}})}(window.olark.__core,window.olark.__core.logger),function(e){e.wait_for(function(){return!0},function(){function t(t){this._path=t.path||"/",this._method=t.method||"GET",this._host=t.host||window.olark._.apiHost,this._data={},this._window=t.window||window,this._loadScript=t.loadScript||function(t){e.async_script_load({url:t})}}var n=e.logger,i={stringify:e.framestorewithjson.json.encode,parse:e.framestorewithjson.decode};t.prototype.send=function(e){this._data=e},t.prototype.end=function(e){var t=this,o="_olark_callback_"+(new Date).getTime();this._window[o]=function(i){t._window[o]=void 0;try{delete t._window[o]}catch(r){}if(i.code<200||i.code>399)return n.warn(["[olark]",i.code,i.body,a].join(" ")),e(i.code);var s={status:i.code,body:i.body};return e(null,s)};var a=[this._host,this._path,"?_method="+encodeURIComponent(this._method),"&_data="+encodeURIComponent(i.stringify(this._data)),"&_callback="+o].join("");this._loadScript(a)},e.xdhttp={post:function(e,n){n=n||{},n.path=e,n.method="POST";var i=new t(n);return i}}})}(window.olark.__core),function(e,t){e.wait_for(function(){return window.olark.__core.box&&window.olark.__core.chat&&window.olark.__core.data&&window.olark.__core.visitor&&window.olark.__core.rules&&window.olark.__core.extensions&&window.olark.__core.browser&&window.olark.__core.remote},function(){var n=function(e){e=e||{};var n=this,i=e.namespace;if("undefined"==typeof i)throw new Error("'namespace' is required");var o=e.conf;if("undefined"==typeof o)throw new Error("'conf' is required");var a=e.extension_name;if("undefined"==typeof a)throw new Error("'extension_name' is required");n.__SPI_browser=new window.olark.__core.browser.BrowserApi({namespace:i,conf:o}),n.__SPI_extensions=new window.olark.__core.extensions.ExtensionsApi({namespace:i}),n.chat=new window.olark.__core.chat.ChatApi({conf:o,extension_name:a}),n.box=new window.olark.__core.box.BoxApi({conf:o,chat_api:n.chat}),n.data=new window.olark.__core.data.DataApi({namespace:i}),n.visitor=new window.olark.__core.visitor.VisitorApi({namespace:i,data:n.data,browser:n.__SPI_browser}),n.rules=new window.olark.__core.rules.RulesApi({data:n.data,browser:n.__SPI_browser}),n.logger=t,n.__SPI_remote=new window.olark.__core.remote.RemoteApi,n.boot={onIdentityReady:function(e){olark._.identityManager.triggerIfIdentityIsReady(e)},onWindowLoad:function(e){e()}}};e.api={ApiInstance:n}})}(window.olark.__core,window.olark.__core.logger),olark("api.boot.onIdentityReady",function(){function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function t(){var e=document.location.href,t=e.split("#"),n="__olarkpg__="+Math.random(),i=/__olarkpg__=[^&]+/;return i.test(e)?e.replace(i,n):/\?/.test(e)?t[0]+"&"+n+(t[1]||""):t[0]+"?"+n+(t[1]||"")}function n(t){var n=document.createElement("a");return n.style.display="block",n.id="olark-inspector-"+t.id,n.href=t.href||"#",e(n,"click",t.onclick),n.innerHTML=t.content,n}function i(e,t){var n=document.createElement("div");return n.id="olark-inspector-"+e,n.innerHTML=t,n}function o(){olark("api.visitor.__SPI_setIsInspecting",!1),r.style.display="none",r=null}function a(){function a(){s(function(t){_.innerHTML="";for(var n=0;n<t.length;n++)_.appendChild(t[n]);var i=document.createElement("a");i.innerHTML="close",function(e){e.display="block",e.position="absolute",e.top="0px",e.right="0px",e["text-decoration"]="none",e.color="#ccc"}(i.style),i.href="#",e(i,"click",function(){return o(),!1}),_.appendChild(i)})}function s(e){olark("api.visitor.getDetails",function(o){e([i("olark-header","<strong style='color: #aaa'>OLARK INSPECTOR</strong>"),i("olark-page-count",["visitor from <strong>"+o.city+", "+o.region+", "+o.country+"</strong>","viewed <strong>"+o.pageCountForThisVisit+"</strong> pages","in <strong>"+o.secondsSpentForThisVisit+"</strong> seconds,","and has chatted <strong>"+o.conversationCount+"</strong> times in the past,","and <strong>"+(o.isConversing?"is conversing now":"has not conversed")+"</strong>"].join(" ")),n({id:"start-new-visitor",content:"pretend to be a brand-new visitor",href:t(),onclick:function(){olark._.cookieManager.erase("hblid"),olark._.cookieManager.erase("olfsk"),olark._.cookieManager.erase("wcsid"),olark._.cookieManager.erase("_okgid")}}),n({id:"start-new-conversation",content:"pretend this is a new visit to the site",href:t(),onclick:function(){olark._.cookieManager.erase("wcsid"),olark._.cookieManager.erase("_okgid")}}),n({id:"visit-another-page",content:"pretend to change pages",href:t()})])})}if(!r){r=document.createElement("div");var _=document.createElement("ul");!function(e){e.position="relative",e.width="400px",e.margin="0px",e.marginLeft=e.marginRight="auto",e.padding="10px",e.fontFamily="monospace",e.color="black",e.background="white",e.opacity="0.90",e["list-style-type"]="none",e["-moz-box-shadow"]=e["-webkit-box-shadow"]=e["box-shadow"]="0px 2px 25px #999"}(_.style),function(e){e.position="fixed",e.bottom="0px",e.width="98%"}(r.style),r.appendChild(_),document.body.appendChild(r),a(),olark("api.visitor.onChange",a)}}var r=null;olark("api.visitor.__SPI_getIsInspecting",function(e){e?a():olark("api.chat.onCommandFromOperator",function(e){"develop"==e.command.name&&(olark("api.visitor.__SPI_setIsInspecting",!0),a())})})}),olark.declare({name:"GoogleAnalytics",version:"1.1",startup:function(e,t){function n(e,t){O&&window.console&&window.console[e]&&window.console[e](t)}function i(e){return e.replace(/[^\w\)\(\d]/g,"_").replace(/\_[\_]*/,"_")}function o(e){window.console&&window.console.warn&&window.console.warn(e)}function a(e,t){if(n("log",arguments),T){if("send"==e)if("pageview"==t)s([B+"_trackPageview"]);else if("event"==t){var i=[B+"_trackEvent"].concat(Array.prototype.slice.call(arguments,2));s(i)}else n("log","unknown command: "+t)}else{var o=Array.prototype.slice.call(arguments,0),a="";S&&(a=S+"."),o[0]=a+o[0],k.apply(k,o)}}function r(e){if(!k)return void n("error","GA_OBJECT not found");var t=k,i=function(){var i=S;if(t.getByName(i))return void n("debug","trackingId already found, using it");var o=t.getAll();if(!e&&o.length>0){var a=o[0];e=a.get("trackingId")}e?(n("debug","creating tracking ID for prefix "+i),t.create(e,{name:i})):n("error","GA trackingId couldn't be found")};t(i)}function s(e){n("log",e);try{window._gaq.push(e)}catch(t){}}function _(e){window._gaq=window._gaq||[],e&&(s([B+"_setAccount",e]),null!=m&&s([B+"_setAllowLinker",m]),null!=v&&s([B+"_setAllowHash",v]),null!=b&&s([B+"_setDomainName",b]),null!=y&&s(y))}function l(e){if(e._getAccount)return e._getAccount();var t=void 0;for(var n in e)"string"==typeof e[n]&&e[n].match(/UA\-/)&&(t=e[n]);return t}function c(){var e=["_getTracker","ByName"].join(""),t=window._gat&&window._gat[e],i=window.pageTracker,a=!t&&window._gaq,c=u&&!t&&!a&&T;if(h&&(B="olark."),c)g?(!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}(),_(g),s([B+"_trackPageview"])):n("error","Cannot load Google Analytics Tracking without Tracking ID");else if(T)if(h)g?_(g):n("error","Cannot create Custom Google Analytics Tracker without Tracking ID");else if(i){var d=l(window.pageTracker);"UA-XXXXX-X"!=d&&d&&p?_(d):n("error","Cannot determine Tracking ID for Google Analytics legacy tracker id is: "+d)}else if(t){var f=l(window._gat[e]()),m="UA-XXXXX-X"==f;m&&n("error","Cannot determine Tracking ID for Google Analytics, _gat is loaded")}else if(a){for(var v=!1,b=0;b<window._gaq.length;b++){var y=window._gaq[b];if(y&&"_setAccount"==y[0]){v=y[1];break}}v||n("error","Cannot determine Tracking ID for Google Analytics _gaq")}else o("Olark Google Analytics Integration is unable to detect Google Analytics on this page");else x||r(I||g),n("log","using new analytics.js api")}function d(){var e=U.get(),t=D.get(),n=q.get(),r=t>n?!0:!1,_="automated"==L.get(),l="";l=r?e+" initiated":_?"Olark Targeted Chat initiated":"Visitor initiated with "+e,P&&(T?(null!=E&&s([B+"_setCustomVar",E,i(i(R)+":(Visitor) Had Conversation"),i(l),N]),null!=M&&s([B+"_setCustomVar",M,i(i(R)+":(Session)_Had_Conversation"),i(l),j]),null!=A&&s([B+"_setCustomVar",A,i(i(R)+":(Page) Had Conversation"),i(l),V]),f&&a("send","pageview")):o("Olark: Google Analytics Custom variables are not supported when using analytics.js"));var c;r||_?(c=Math.floor((t-n)/1e3),(0>c||c>F)&&(c=0),a("send","event",i(i(R)),"Conversation",i(l),w?c:0)):(c=Math.floor((n-t)/1e3),(0>c||c>F)&&(c=0),a("send","event",i(i(R)),"Conversation",i(l),w?c:0))}var h=t.GoogleAnalytics.create_custom_tracker||null,u=t.GoogleAnalytics.load_ga_if_missing||null,p=void 0===t.GoogleAnalytics.legacy_compatibility?!0:t.GoogleAnalytics.legacy_compatibility,f=t.GoogleAnalytics.track_chat_start_page||null,g=(t.GoogleAnalytics.track_widget_events||null,t.GoogleAnalytics.tracking_id||null),m=t.GoogleAnalytics.allow_linker||null,v=t.GoogleAnalytics.allow_hash||null,b=t.GoogleAnalytics.domain||null,y=t.GoogleAnalytics.custom_config||null,w=t.GoogleAnalytics.track_message_delays||null,k=t.GoogleAnalytics.google_analytics_object||window.ga,x=t.GoogleAnalytics.use_default_tracker||!1,S=x?"":"olark",I=t.GoogleAnalytics.custom_tracking_id||null,C=t.GoogleAnalytics.force_legacy_mode||!1,T=C||!k,P=t.GoogleAnalytics.enable_custom_variables||null,M=t.GoogleAnalytics.had_conversation_session_slot_number||null,A=t.GoogleAnalytics.had_conversation_page_slot_number||null,E=t.GoogleAnalytics.had_conversation_visitor_slot_number||null,O=t.GoogleAnalytics.debug||document.location.toString().match(/__debug_ga/)||null,N=1,j=2,V=3,F=1200,B="",R=window.hblName||"Olark",D=e.data.getConversationObject({key:"lastMessageToOperatorSent",initialValue:null}),q=e.data.getConversationObject({key:"lastMessageToVisitorSent",initialValue:null}),L=e.data.getConversationObject({key:"lastMessageSent",initialValue:null}),H=e.data.getConversationObject({key:"isConversation",initialValue:null}),U=e.data.getConversationObject({key:"lastOperatorNickname",initialValue:""});O&&(window.olark._.ga_debug=this),e.chat.onReady(function(){c(),e.chat.onMessageToVisitor(function(e){var t=D.get(),n=e.message.nickname,o=e.message.automated;if("visitor"==L.get()||null==q.get()){var r=0;D.get()&&(r=Math.floor((+new Date-D.get())/1e3),(0>r||r>F)&&(r=0)),o?a("send","event",i(R),i("Olark Targeted Chat Sent a Message"),i("Targeted"),w?r:0):a("send","event",i(R),i("Operator Sent a Message"),i(n),w?r:0),q.set(+new Date)}null==q.get()&&q.set(+new Date),U.set(n),t&&!H.get()&&d(),H.set(t),L.set(o?"automated":"operator")}),e.chat.onMessageToOperator(function(){var e=q.get();if("operator"==L.get()||"automated"==L.get()||null==D.get()){var t=0;D.get()&&(t=Math.floor((+new Date-D.get())/1e3),(0>t||t>F)&&(t=0)),a("send","event",i(R),i("Visitor Sent a Message"),i("true"),w?t:0),D.set(+new Date)}null==D.get()&&D.set(+new Date),e&&!H.get()&&d(),H.set(e),L.set("visitor")}),olark("api.chat.onOfflineMessageToOperator",function(){a("send","event",i(R),i("Visitor Sent an Offline Message"),i("true"),0)})})}}),olark.declare({name:"VisitorInsight",version:"1.0",startup:function(e,t){function n(e){return"true"==e?!0:!1}var i=function(t){return t?e.__SPI_browser.__SPI_getSafeUrl(t):null},o=function(e){return(t.VisitorInsight||{})[e]||t.system[e]},a=2,r=6e4,s=3e4,_=2,l=18e5,c=5,d=t.chat.visitor_nickname||t.system.force_nickname||null,h=!0;(o("prechat_contains_referrer")===!1||t.chat.notify_operator_of_referrer===!1)&&(h=!1);var u=!0;(o("prechat_contains_location")===!1||t.chat.notify_operator_of_location===!1)&&(u=!1);var p=o("disable_default_visitor_information")?!0:!1,f=o("status_contains_referrer")===!1?!1:!0,g=o("status_contains_location")===!1?!1:!0,m=o("give_location_to_operator")===!1?!1:!0,v=o("max_location_notifs_when_not_conversing")||a,b=o("max_idle_milliseconds_for_location_notifs")||r,y=o("custom_visitor_ip")||null,w="undefined"==typeof o("clickpath_entries")?c:o("clickpath_entries"),k=t.system.disable_time_based_status_updates?!0:!1,x=null,S=+new Date,I=e.data.getConversationObject({key:"didGivePrechatInsight",initialValue:!1,backup:"vi1",backupTransform:n}),C=e.data.getConversationObject({key:"isConversation",initialValue:!1,backup:"vi2",backupTransform:n}),T=e.data.getConversationObject({key:"referrer",initialValue:document.referrer&&""!==document.referrer?document.referrer:null}),P=e.data.getConversationObject({key:"locationNotificationState",initialValue:"active",backup:"vi3",backupTransform:n}),M=e.data.getConversationObject({key:"locationNotifsWithoutConversing",initialValue:0}),A=e.data.getConversationObject({key:"timestampOfLastActivity",initialValue:(new Date).getTime(),backup:"vi4",backupTransform:parseInt}),E=e.data.getConversationObject({key:"pagesCount",initialValue:0}),O=e.data.getVisitorObject({key:"visitCount",initialValue:0}),N=e.data.getConversationObject({key:"visitorMessageCount",initialValue:0}),j=e.data.getConversationObject({key:"operatorMessageCount",initialValue:0}),V=e.data.getConversationObject({key:"operatorNotificationCount",initialValue:0,backup:"vi5",backupTransform:parseInt}),F=e.data.getConversationObject({key:"initialArrivalTimestamp",initialValue:(new Date).getTime()});d&&e.chat.updateVisitorNickname({snippet:d,hidesDefault:!0}),function(){e.chat.onMessageToOperator(function(){N.set(N.get()+1)}),e.chat.onMessageToVisitor(function(){j.set(j.get()+1)}),e.chat.onNotificationToOperator(function(){V.set(V.get()+1)}),e.__SPI_browser.onPageChange(function(){E.set(E.get()+1)}),E.__SPI_onChange(function(e){1==e.newValue&&O.set(O.get()+1)})}(),function(){var e=function(){N.get()>0&&j.get()>0&&C.set(!0)};N.__SPI_onChange(e),j.__SPI_onChange(e)}(),function(){var t=function(){A.set((new Date).getTime()),M.set(0),"disabled"!=P.get()&&P.set("active")};e.chat.onMessageToVisitor(function(){t()}),e.chat.onMessageToOperator(function(){t()}),M.__SPI_onChange(function(e){e.newValue>=v&&P.set("inactive")}),e.box.onDismiss(function(){P.set("inactive")}),e.chat.onCommandFromOperator(function(e){var t=e.command;("unfollow"==t.name||"nofollow"==t.name)&&(P.set("disabled"),olark("api.chat.sendNotificationToOperator",{body:"turned off URL notifications from this visitor"})),"end"===t.name&&P.set("inactive")})}(),function(){var t=function(){var e=(new Date).getTime(),t=e-A.get();return t>b?!0:!1},n=function(){var t=i(olark._.overrideWindowHref||document.location.href);e.chat.sendNotificationToOperator({body:"looking at "+t})},o=function(){m&&!t()&&"active"==P.get()&&(n(),M.set(M.get()+1))},a=function(){if(I.get()===!1&&!p){I.set(!0);var t=e.chat.getVisitorNickname();if(e.chat.sendNotificationToOperator({body:"talking to "+t}),u&&n(),h){var o=i(T.get());o&&e.chat.sendNotificationToOperator({body:"referred from "+o})}/{\s*geolocation\s*}/.test(t)||e.chat.sendNotificationToOperator({body:"located in {{geolocation}}"});var a=B();if(a)for(var r=0;r<a.length;r++)e.chat.sendNotificationToOperator({body:a[r]});e.chat.sendNotificationToOperator({body:"to see additional options, simply type !help"})}};e.__SPI_browser.onPageChange(function(){I.get()===!0&&o()}),N.__SPI_onChange(function(e){1==e.newValue&&a()}),V.__SPI_onChange(function(e){1==e.newValue&&a()})}();var B=function(){var t=[],n=e.visitor.getOrganization();return n&&t.push("might be affiliated with "+n),t},R=function(){var t=+new Date-S;if(!(t>l)){var n=function(e){return e>=864e5?"one day":e>=36e5?Math.floor(e/36e5)+" hours":e>=6e4?Math.floor(e/6e4)+" minutes":e>=1e3?Math.floor(e/1e3)+" seconds":null},o=i(document.location.href.toString()),a=i(T.get()),r=E.get(),c=O.get(),d=y||e.visitor.__SPI_getIp()||"{{ipaddress}}",h=(new Date).getTime()-F.get(),u=n(h),p=e.visitor.getFullName(),m=e.visitor.getEmailAddress(),v=e.visitor.getPhoneNumber(),b=e.visitor.__SPI_getNotes(),I=e.visitor.__SPI_getRecentPageHistory();x=b;var C=b.slice(0)||[];if(p&&C.push("speaking with "+p),m&&C.push(m),v&&C.push("phone number is "+v),o&&g&&C.push("looking at "+o),I&&I.length>1){var P=I.length-1,M=I.length-1-w;1>M&&(M=1),C.push("already looked at:");for(var A=P;A>=M;A--){var N=I[A];N.url?C.push("  "+i(N.url)):N.title&&C.push("  "+N.title)}}if(a&&f&&C.push("referred from "+a),C.push("located in {{geolocation}}"),C.push("{num_pages} pages viewed".replace(/{num_pages}/,r)),C.push(c>1?c+" visits":"first visit"),H>1?C.push("has had "+H+" conversations"):1==H&&C.push("first conversation"),C.push("using "+e.visitor.__SPI_getBrowser()+" on "+e.visitor.__SPI_getOs()),d&&C.push(d),u&&h>s)C.push("spent at least "+u+" so far");else{var j=n(s);j&&C.push("arrived within the last "+j)}var V=B();if(V)for(var D=0;D<V.length;D++)C.push(V[D]);e.chat.updateVisitorStatus({snippet:C});var q=h*_;s>q&&(q=s),e.chat.__SPI_isConversing()||k||setTimeout(R,q)}};e.chat.onReady(R),e.__SPI_browser.onPageChange(function(){setTimeout(R,100)});var D,q,L,H;e.visitor.getDetails(function(e){D=e.fullName,q=e.emailAddress,L=e.phoneNumber,H=e.conversationCount}),e.visitor.onChange(function(){e.visitor.getDetails(function(e){var t=!1;D!==e.fullName&&(D=e.fullName,t=!0),q!==e.emailAddress&&(q=e.emailAddress,t=!0),L!==e.phoneNumber&&(L=e.phoneNumber,t=!0),H!==e.conversationCount&&(H=e.conversationCount,t=!0),t&&R()})}),e.visitor.onChange(function(){if(null!==x){var t=e.visitor.__SPI_getNotes();t.join("")!=x.join("")&&R()}})}}),olark.declare({name:"VisitorImportance",version:"1.0",startup:function(e,t){function n(){olark("api.visitor.getDetails",function(t){for(var n="",i=0;3>i;i++)n+=t.importance>i?o:a;e.chat.updateVisitorNickname({snippet:n})})}var i=1==t.system.show_importance_in_nickname?!0:!1,o=t.system.filled_icon||String.fromCharCode(9733),a=t.system.unfilled_icon||String.fromCharCode(9734);i&&(olark("api.visitor.onChange",n),n())}}),olark.declare({name:"OfflineWarning",version:"1.0",startup:function(e,t){var n=t.system.offlineResponse||"Operator has gone away try again later";e.chat.onMessageToOperator(function(){setTimeout(function(){u.client.opavailable||olark("api.chat.sendMessageToVisitor",{body:n,nickname:" "})},1)})}}),olark.declare({name:"EndConversation",version:"1.0",startup:function(e,t){function n(e,t){var n=document.createElement("input");return n.type="submit",n.value=e,n.onclick=t,n.className="habla_offline_submit_input",n}function i(){var e=document.getElementById("habla_end_convo_div");if(!e){var t=document.getElementById("habla_conversation_div");e=document.createElement("div"),e.id="habla_end_convo_div",t.appendChild(e)}var i=document.createElement("p"),o=document.createElement("em");o.innerText=_.end_conversation_placeholder,i.appendChild(o);var r=document.createElement("hr"),s=document.createElement("div"),l=n(_.restart_conversation_input_text,a);s.id="habla_pre_chat_div",e.className="hbl_panel habla_offline_message_div hbl_pal_control_border hbl_pal_main_fg",s.appendChild(l),e.appendChild(i),e.appendChild(r),e.appendChild(s),e.style.clear="both",e.style.display="block"}function o(){var e=document.getElementById("habla_end_convo_div");e&&(e.style.display="none")}function a(){olark._.identityManager.deleteConversationId(),setTimeout(function(){window.location.reload()},1)}function r(){olark._.identityManager.deleteConversationId(),e.box.hide(),olark._.hlog("disabling chatbox due to #convo_ended_before_begin"),window.console&&console.warn&&window.console.warn("[olark] conversation expired, disabling chatbox"),e.box.__SPI_disableUserInterface(),e.chat.__SPI_disableChatConnection()}function s(e){e.is_ended?e.is_conversing?(i(),olark._.identityManager.keepConversationIdAlive()):r():o()}var _={end_conversation_placeholder:t.locale.end_conversation_placeholder||"Conversation ended",restart_conversation_input_text:t.locale.restart_conversation_input_text||"Start a new chat"};t.system.allow_end_conversation&&e.chat.onReady(function(){setTimeout(function(){e.chat.__SPI_getEndedState(function(t){t.is_ended?s(t):e.chat.__SPI_onEndedStateChanged(s)})})})}}),s("hbl",u),s("hblrpcTrick",p),s("hblDEBUG",f),s("hblnoconsole",g),s("hblHideUnsupported",m),s("hblJavaScriptVersion",v),s("hblBegincall",b),s("hblJSInline",y),s("hbl_max_event",w),s("hbl_hostname_delimiter",k),s("wc_config",t),s("wc_init",n),s("habla_load_func",i),s("hbl_link",x),s("__get_element_position",S),s("PollingManager",l),s("habla_start_func",o),s("habla_error",a),s("wc_init_post",r),s("hbl_ssl",hbl_ssl),s("hbl_ext",hbl_ext),s("hblCacheConstant",hblCacheConstant),s("hbl_hostname",hbl_hostname),s("hbl_static_hostname",hbl_static_hostname),s("hblStaticPath",hblStaticPath),s("hblPostURL",hblPostURL),s("hblPopupURL",hblPopupURL),s("hblUrlHandler",hblUrlHandler),s("hblPostStub",hblPostStub),s("hblName",hblName),s("hblInstallUrl",hblInstallUrl),s("habla_window",habla_window),s("hblHasinit",hblHasinit),s("__get_olark_key",__get_olark_key),s("__ie6_float_hack",__ie6_float_hack)},{"../../chatbox/Conversation":4,"../../chatbox/PollingManager":5,"../../chatbox/TextFormatter":6,"../../chatbox/UrlFormatter":7,"../../chatbox/json":8,underscore:3}]},{},[9]);}).call(this);